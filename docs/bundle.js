/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var __webpack_modules__={394:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});const r=Object.freeze({PROMPT_ALL_PLAYERS:"PROMPT_ALL_PLAYERS",PROMPT_CURRENT_PLAYER:"PROMPT_CURRENT_PLAYER",SET_CURRENT_PLAYER_TO_SPECTATOR:"SET_CURRENT_PLAYER_TO_SPECTATOR",DISPLACE_PLAYER:"DISPLACE_PLAYER",CODE:"CODE",CUSTOM:"CUSTOM"})},632:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});const r=Object.freeze({ON_ENTER:"ON_ENTER",ON_LAND:"ON_LAND",ON_EXIT:"ON_EXIT",CODE:"CODE"})},222:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});const r=Object.freeze({CHANGE_TURN:"CHANGE_TURN",BEGIN_TURN:"BEGIN_TURN",END_TURN:"END_TURN",WAITING_FOR_MOVE:"WAITING_FOR_MOVE",PLAYER_CHOOSING_DESTINATION:"PLAYER_CHOOSING_DESTINATION",PROCESSING_MOVE:"PROCESSING_MOVE",PROCESSING_EVENTS:"PROCESSING_EVENTS",PROCESSING_EVENT:"PROCESSING_EVENT"})},89:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>Action});var _enums_ActionTypes__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(394),_enums_TurnPhases__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(222),_utils_helpers__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(459);function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var Action=function(){function Action(e,t){_classCallCheck(this,Action),this.type=e,this.payload=t||null}return _createClass(Action,[{key:"execute",value:function(e){e.gameState;var t=e.eventBus;e.peerId,this.emitEvent(t,"beforeActionExecution",e);var n=this.getHandler();n?n(e):console.warn('Action type "'.concat(this.type,'" not recognized.')),this.emitEvent(t,"afterActionExecution",e)}},{key:"emitEvent",value:function(e,t,n){e&&e.emit(t,{action:this,gameState:n.gameState,space:n.gameEventWithSpace.space,peerId:n.peerId})}},{key:"getHandler",value:function(){return _defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty({},_enums_ActionTypes__WEBPACK_IMPORTED_MODULE_0__.A.CODE,this.handleCode.bind(this)),_enums_ActionTypes__WEBPACK_IMPORTED_MODULE_0__.A.PROMPT_ALL_PLAYERS,this.handlePromptAllPlayers.bind(this)),_enums_ActionTypes__WEBPACK_IMPORTED_MODULE_0__.A.PROMPT_CURRENT_PLAYER,this.handlePromptCurrentPlayer.bind(this)),_enums_ActionTypes__WEBPACK_IMPORTED_MODULE_0__.A.SET_CURRENT_PLAYER_TO_SPECTATOR,this.handleSetCurrentPlayerToSpectator.bind(this)),_enums_ActionTypes__WEBPACK_IMPORTED_MODULE_0__.A.DISPLACE_PLAYER,this.handleDisplacePlayer.bind(this)),_enums_ActionTypes__WEBPACK_IMPORTED_MODULE_0__.A.CUSTOM,this.handleCustom.bind(this))[this.type]}},{key:"handleCode",value:function handleCode(gameEngine){this.payload?eval(this.payload):console.warn("No payload provided for CODE action.")}},{key:"handlePromptAllPlayers",value:function(e){var t=this.payload;null!=t&&t.message&&e.peerId?(console.log("Prompting all players: ".concat(t.message)),e.showPromptModal(t.message)):this.logMissingParams(["payload","payload.message","peerId"])}},{key:"handlePromptCurrentPlayer",value:function(e){var t=this.payload;if(null!=t&&t.message&&e.peerId){var n=e.gameState.getCurrentPlayer();console.log("Prompting ".concat(n.nickname,": ").concat(t.message)),n.peerId===e.peerId&&e.showPromptModal(t.message)}else this.logMissingParams(["payload","payload.message","peerId"])}},{key:"handleSetCurrentPlayerToSpectator",value:function(e){e.gameState.getCurrentPlayer().isSpectator=!0,e.changePhase({newTurnPhase:_enums_TurnPhases__WEBPACK_IMPORTED_MODULE_1__.A.PROCESSING_EVENTS,delay:0})}},{key:"handleDisplacePlayer",value:function(e){var t=(this.payload||{}).steps;if(void 0!==t){var n=e.gameState.getCurrentPlayer();if(n)if(t>0)console.log("Adding ".concat(t," moves to ").concat(n.nickname,"'s remaining moves.")),e.gameState.setRemainingMoves(gameState.remainingMoves+t);else if(t<0){var r=Math.abs(t),i=n.movementHistory.getHistoryForTurn(gameState.getTurnNumber());if(0===i.length)return void console.warn("".concat(n.nickname," has no movement history to move back."));var o=Math.max(0,i.length-r-1),a=i[o].spaceId;console.log("Moving ".concat(n.nickname," back ").concat(r," steps to position ").concat(a,".")),n.setCurrentSpaceId(a),n.movementHistory.history=i.slice(0,o+1),e.changePhase({newTurnPhase:_enums_TurnPhases__WEBPACK_IMPORTED_MODULE_1__.A.PROCESSING_EVENTS,delay:0})}else console.warn("Displacement of 0 steps has no effect.");else console.warn("No active player found in the game state.")}else this.logMissingParams(["payload.steps"])}},{key:"handleCustom",value:function(){console.log("Executing custom action...")}},{key:"logMissingParams",value:function(e){console.warn('Action "'.concat(this.type,'" missing parameters: ').concat(e.join(", ")))}},{key:"toJSON",value:function(){return{type:this.type,payload:this.payload}}}],[{key:"fromJSON",value:function(e){return new Action((0,_utils_helpers__WEBPACK_IMPORTED_MODULE_2__.Z3)(e.type),e.payload||null)}}])}()},775:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>Trigger});var _utils_helpers__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(459),_enums_TriggerTypes__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(632);function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var Trigger=function(){function Trigger(e,t){_classCallCheck(this,Trigger),this.type=e,this.payload=t}return _createClass(Trigger,[{key:"isTriggered",value:function isTriggered(context){var gameState=context.gameState,space=context.space,eventBus=context.eventBus,peerId=context.peerId,player=gameState.getCurrentPlayer();eventBus&&eventBus.emit("triggerCheckStarted",{trigger:this,gameState,space});var isTriggered=!1;switch(this.type){case _enums_TriggerTypes__WEBPACK_IMPORTED_MODULE_0__.A.CODE:this.payload&&(isTriggered=eval(this.payload));break;case _enums_TriggerTypes__WEBPACK_IMPORTED_MODULE_0__.A.ON_ENTER:isTriggered=player.currentSpaceId===space.id;break;case _enums_TriggerTypes__WEBPACK_IMPORTED_MODULE_0__.A.ON_LAND:isTriggered=player.currentSpaceId===space.id&&!gameState.hasMovesLeft();break;case _enums_TriggerTypes__WEBPACK_IMPORTED_MODULE_0__.A.ON_EXIT:var movementHistory=player.movementHistory.getFullHistory(),allMoves=Object.values(movementHistory).flat(),lastMove=allMoves[allMoves.length-2];isTriggered=lastMove&&lastMove.spaceId===space.id;break;default:isTriggered=!1}return eventBus&&eventBus.emit("triggerCheckEnded",{trigger:this,result:isTriggered,gameState,space}),isTriggered&&console.log("Trigger of type ".concat(this.type," was activated for space ID ").concat(space.id," by player ").concat(player.nickname,".")),isTriggered}},{key:"toJSON",value:function(){return{type:this.type,payload:this.payload||null}}}],[{key:"fromJSON",value:function(e){return new Trigger((0,_utils_helpers__WEBPACK_IMPORTED_MODULE_1__.Z3)(e.type),void 0!==e.payload?e.payload:null)}}])}()},942:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,o(r.key),r)}}function o(e){var t=function(e){if("object"!=r(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==r(t)?t:t+""}n.d(t,{A:()=>a});var a=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},(t=[{key:"initialize",value:function(e,t){throw new Error("initialize() method must be implemented by the plugin.")}},{key:"setPeer",value:function(e){this.peer=e}},{key:"setHost",value:function(e){this.isHost=e}},{key:"cleanup",value:function(){}}])&&i(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}()},302:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,o(r.key),r)}}function o(e){var t=function(e){if("object"!=r(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==r(t)?t:t+""}function a(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(a=function(){return!!e})()}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}function c(e,t){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},c(e,t)}n.r(t),n.d(t,{default:()=>u});var u=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t,n){return t=s(t),function(e,t){if(t&&("object"==r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,a()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}(this,t,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}(t,e),n=t,(o=[{key:"initialize",value:function(e,t){console.log("Example Plugin initialized!",{eventBus:e,registryManager:t}),e.on("settingsUpdated",this.handleSettingsUpdate.bind(this)),e.on("boardUpdated",this.handleBoardUpdate.bind(this)),e.on("piecesUpdated",this.handlePiecesUpdate.bind(this)),e.on("playerListUpdated",this.handlePlayerListUpdate.bind(this)),e.on("gameStateUpdated",this.handleGameStateUpdate.bind(this))}},{key:"handleSettingsUpdate",value:function(e){}},{key:"handleBoardUpdate",value:function(e){}},{key:"handlePiecesUpdate",value:function(e){}},{key:"handlePlayerListUpdate",value:function(e){}},{key:"handleGameStateUpdate",value:function(e){}},{key:"cleanup",value:function(){console.log("Cleaning up ExamplePlugin..."),this.eventBus.off("settingsUpdated",this.handleSettingsUpdate.bind(this)),this.eventBus.off("boardUpdated",this.handleBoardUpdate.bind(this)),this.eventBus.off("piecesUpdated",this.handlePiecesUpdate.bind(this)),this.eventBus.off("playerListUpdated",this.handlePlayerListUpdate.bind(this)),this.eventBus.off("gameStateUpdated",this.handleGameStateUpdate.bind(this))}}])&&i(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,o}(n(942).A)},459:(e,t,n)=>{"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function i(e,t){return e.startsWith("hsl")?function(e,t){var n=e.r,r=e.g,i=e.b,a=Math.floor(n*t),s=Math.floor(r*t),c=Math.floor(i*t);return"#".concat(o(a)).concat(o(s)).concat(o(c))}((n=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],c=!0,u=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){u=!0,i=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw i}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return r(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e.match(/\d+/g).map(Number),3),i=n[0],a=n[1],s=n[2]/100,c=a/100,u=(1-Math.abs(2*s-1))*c,l=u*(1-Math.abs(i/60%2-1)),h=s-u/2,p=0,f=0,d=0,i>=0&&i<60?(p=u,f=l,d=0):i>=60&&i<120?(p=l,f=u,d=0):i>=120&&i<180?(p=0,f=u,d=l):i>=180&&i<240?(p=0,f=l,d=u):i>=240&&i<300?(p=l,f=0,d=u):i>=300&&i<360&&(p=u,f=0,d=l),{r:Math.round(255*(p+h)),g:Math.round(255*(f+h)),b:Math.round(255*(d+h))}),t):function(e,t){var n=e.replace("#",""),r=parseInt(n.substring(0,2),16),i=parseInt(n.substring(2,4),16),a=parseInt(n.substring(4,6),16),s=Math.floor(r*t),c=Math.floor(i*t),u=Math.floor(a*t);return"#".concat(o(s)).concat(o(c)).concat(o(u))}(e,t);var n,i,a,s,c,u,l,h,p,f,d}function o(e){var t=e.toString(16);return 1===t.length?"0"+t:t}function a(e,t,n){n=Math.min(Math.max(n,0),1);var r=parseInt(e.slice(1),16),i=parseInt(t.slice(1),16),a=r>>16&255,s=r>>8&255,c=255&r,u=i>>16&255,l=i>>8&255,h=255&i,p=Math.round(a+n*(u-a)),f=Math.round(s+n*(l-s)),d=Math.round(c+n*(h-c));return"#".concat(o(p)).concat(o(f)).concat(o(d))}function s(e){return e.toUpperCase().replace(/\s+/g,"_").replace(/[^\w]/g,"")}n.d(t,{De:()=>a,Z3:()=>s,nV:()=>i})},963:e=>{"use strict";const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((e=>e.trim()))},t.splitSections=function(e){return e.split("\nm=").map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"))},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((e=>0===e.indexOf(n)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":n.relatedAddress=t[e+1];break;case"rport":n.relatedPort=parseInt(t[e+1],10);break;case"tcptype":n.tcpType=t[e+1];break;case"ufrag":n.ufrag=t[e+1],n.usernameFragment=t[e+1];break;default:void 0===n[t[e]]&&(n[t[e]]=t[e+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let n;const r=e.substring(e.indexOf(" ")+1).split(";");for(let e=0;e<r.length;e++)n=r[e].trim().split("="),t[n[0].trim()]=n[1];return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const r=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)})),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substring(t+1,r),n.value=e.substring(r+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const r=t.matchPrefix(e+n,"a=ice-ufrag:")[0],i=t.matchPrefix(e+n,"a=ice-pwd:")[0];return r&&i?{usernameFragment:r.substring(12),password:i.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(e)[0].split(" ");n.profile=r[2];for(let i=3;i<r.length;i++){const o=r[i],a=t.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){const r=t.parseRtpMap(a),i=t.matchPrefix(e,"a=fmtp:"+o+" ");switch(r.parameters=i.length?t.parseFmtp(i[0]):{},r.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(t.parseRtcpFb),n.codecs.push(r),r.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(r.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach((e=>{n.headerExtensions.push(t.parseExtmap(e))}));const i=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach((e=>{i.forEach((t=>{e.rtcpFeedback.find((e=>e.type===t.type&&e.parameter===t.parameter))||e.rtcpFeedback.push(t)}))})),n},t.writeRtpDescription=function(e,n){let r="";r+="m="+e+" ",r+=n.codecs.length>0?"9":"0",r+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=n.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((e=>{r+=t.writeRtpMap(e),r+=t.writeFmtp(e),r+=t.writeRtcpFb(e)}));let i=0;return n.codecs.forEach((e=>{e.maxptime>i&&(i=e.maxptime)})),i>0&&(r+="a=maxptime:"+i+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach((e=>{r+=t.writeExtmap(e)})),r},t.parseRtpEncodingParameters=function(e){const n=[],r=t.parseRtpParameters(e),i=-1!==r.fecMechanisms.indexOf("RED"),o=-1!==r.fecMechanisms.indexOf("ULPFEC"),a=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),s=a.length>0&&a[0].ssrc;let c;const u=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>e.substring(17).split(" ").map((e=>parseInt(e,10)))));u.length>0&&u[0].length>1&&u[0][0]===s&&(c=u[0][1]),r.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10)};s&&c&&(t.rtx={ssrc:c}),n.push(t),i&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:s,mechanism:o?"red+ulpfec":"red"},n.push(t))}})),0===n.length&&s&&n.push({ssrc:s});let l=t.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substring(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substring(5),10)*.95-16e3:void 0,n.forEach((e=>{e.maxBitrate=l}))),n},t.parseRtcpParameters=function(e){const n={},r=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];r&&(n.cname=r.value,n.ssrc=r.ssrc);const i=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=i.length>0,n.compound=0===i.length;const o=t.matchPrefix(e,"a=rtcp-mux");return n.mux=o.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const r=t.matchPrefix(e,"a=msid:");if(1===r.length)return n=r[0].substring(7).split(" "),{stream:n[0],track:n[1]};const i=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return i.length>0?(n=i[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),r=t.matchPrefix(e,"a=max-message-size:");let i;r.length>0&&(i=parseInt(r[0].substring(19),10)),isNaN(i)&&(i=65536);const o=t.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:n.fmt,maxMessageSize:i};const a=t.matchPrefix(e,"a=sctpmap:");if(a.length>0){const e=a[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:i}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,r){let i;const o=void 0!==n?n:2;return i=e||t.generateSessionId(),"v=0\r\no="+(r||"thisisadapterortc")+" "+i+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const r=t.splitLines(e);for(let e=0;e<r.length;e++)switch(r[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[e].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let e=0;e<n.length;e++)if(n[e].length<2||"="!==n[e].charAt(1))return!1;return!0},e.exports=t},247:(e,t,n)=>{var r={"./ExamplePlugin.js":302};function i(e){var t=o(e);return n(t)}function o(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}i.keys=function(){return Object.keys(r)},i.resolve=o,e.exports=i,i.id=247}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](n,n.exports,__webpack_require__),n.exports}__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};(()=>{"use strict";var e={};__webpack_require__.r(e),__webpack_require__.d(e,{fixNegotiationNeeded:()=>pt,shimAddTrackRemoveTrack:()=>lt,shimAddTrackRemoveTrackWithNative:()=>ut,shimGetSendersWithDtmf:()=>st,shimGetUserMedia:()=>it,shimMediaStream:()=>ot,shimOnTrack:()=>at,shimPeerConnection:()=>ht,shimSenderReceiverGetStats:()=>ct});var t={};__webpack_require__.r(t),__webpack_require__.d(t,{shimAddTransceiver:()=>_t,shimCreateAnswer:()=>kt,shimCreateOffer:()=>Pt,shimGetDisplayMedia:()=>dt,shimGetParameters:()=>St,shimGetUserMedia:()=>ft,shimOnTrack:()=>yt,shimPeerConnection:()=>mt,shimRTCDataChannel:()=>wt,shimReceiverGetStats:()=>gt,shimRemoveStream:()=>bt,shimSenderGetStats:()=>vt});var n={};__webpack_require__.r(n),__webpack_require__.d(n,{shimAudioContext:()=>jt,shimCallbacksAPI:()=>Tt,shimConstraints:()=>It,shimCreateOfferLegacy:()=>Lt,shimGetUserMedia:()=>Ot,shimLocalStreamsAPI:()=>Et,shimRTCIceServerUrls:()=>xt,shimRemoteStreamsAPI:()=>Ct,shimTrackEventTransceiver:()=>Rt});var r,i={};__webpack_require__.r(i),__webpack_require__.d(i,{removeExtmapAllowMixed:()=>Ft,shimAddIceCandidateNullOrEmpty:()=>Ht,shimConnectionState:()=>Gt,shimMaxMessageSize:()=>Nt,shimParameterlessSetLocalDescription:()=>zt,shimRTCIceCandidate:()=>Dt,shimRTCIceCandidateRelayProtocol:()=>Bt,shimSendThrowTypeError:()=>Ut});var o=new Uint8Array(16);function a(){if(!r&&!(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(o)}const s=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var c=[],u=0;u<256;++u)c.push((u+256).toString(16).substr(1));const l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]).toLowerCase();if(!function(e){return"string"==typeof e&&s.test(e)}(n))throw TypeError("Stringified UUID is invalid");return n},h=function(e,t,n){var r=(e=e||{}).random||(e.rng||a)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=r[i];return t}return l(r)};function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,d(r.key),r)}}function d(e){var t=function(e){if("object"!=p(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=p(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==p(t)?t:t+""}var y=function(){return e=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.colorPalette=this.generateColorPalette(t)},t=[{key:"generateColorPalette",value:function(e){for(var t=[],n=0;n<e;n++){var r=360*n/e%360;t.push("hsl(".concat(r,", ").concat(70,"%, ").concat(80,"%)"))}return t}},{key:"assignColor",value:function(e){for(var t=0,n=0;n<e.length;n++)t=(31*t+e.charCodeAt(n))%1e3;var r=Math.abs(t)%this.colorPalette.length;return this.colorPalette[r]}}],t&&f(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function m(e){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(e)}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,g(r.key),r)}}function g(e){var t=function(e){if("object"!=m(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=m(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==m(t)?t:t+""}var b=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.seed=t||this.generateSeed(),this.originalSeed=this.seed}return t=e,n=[{key:"generateSeed",value:function(){return Math.floor(1e6*Math.random())}},{key:"roll",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=this.seededRandom(this.seed);return e=r?r(i):Math.floor(i*(n-t+1))+t,this.updateSeed(),e}},{key:"updateSeed",value:function(){this.seed=(9301*this.seed+49297)%233280}},{key:"seededRandom",value:function(e){var t=1e4*Math.sin(e);return t-Math.floor(t)}},{key:"resetSeed",value:function(){this.seed=this.originalSeed}},{key:"setSeed",value:function(e){this.seed=e}},{key:"toJSON",value:function(){return{seed:this.seed}}}],r=[{key:"fromJSON",value:function(t){return new e(t.seed)}}],n&&v(t.prototype,n),r&&v(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,r}();function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,S(r.key),r)}}function S(e){var t=function(e){if("object"!=w(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=w(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==w(t)?t:t+""}var P=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.spaceId=t,this.remainingMoves=n}return t=e,r=[{key:"fromJSON",value:function(t){return new e(t.spaceId,t.remainingMoves)}}],(n=[{key:"toJSON",value:function(){return{spaceId:this.spaceId,remainingMoves:this.remainingMoves}}}])&&_(t.prototype,n),r&&_(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,r}();function k(e){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k(e)}function E(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],c=!0,u=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){u=!0,i=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw i}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return C(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?C(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function T(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,O(r.key),r)}}function O(e){var t=function(e){if("object"!=k(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=k(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==k(t)?t:t+""}var I=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.history={}}return t=e,r=[{key:"fromJSON",value:function(t){var n=new e;return n.history=Object.fromEntries(Object.entries(t.history||{}).map((function(e){var t=E(e,2);return[t[0],t[1].map((function(e){return P.fromJSON(e)}))]}))),n}}],(n=[{key:"addMove",value:function(e,t,n){this.history[e]||(this.history[e]=[]);var r=new P(t,n);this.history[e].push(r)}},{key:"getHistoryForTurn",value:function(e){return this.history[e]||[]}},{key:"getFullHistory",value:function(){return this.history}},{key:"toJSON",value:function(){return{history:Object.fromEntries(Object.entries(this.history).map((function(e){var t=E(e,2);return[t[0],t[1].map((function(e){return e.toJSON()}))]})))}}}])&&T(t.prototype,n),r&&T(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,r}();function x(e){return x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},x(e)}function R(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,L(r.key),r)}}function L(e){var t=function(e){if("object"!=x(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=x(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==x(t)?t:t+""}var j=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.peerId=t,this.nickname=n,this.isHost=r,this.stats={},this.playerId=i||this.generatePlayerId(),this.id=this.playerId,this.isSpectator=o,this.currentSpaceId=1,this.playerColor=(new y).assignColor(this.playerId),this.peerColor=(new y).assignColor(this.peerId),this.rollEngine=new b(this.generateSeedFromId(this.playerId)),this.turnsTaken=0,this.movementHistory=new I}return t=e,n=[{key:"generatePlayerId",value:function(){var e=h();return console.log("Generated new Player with ID: ",e),console.log("Player attached to client: ",this.peerId),e}},{key:"generateSeedFromId",value:function(e){return e.split("").reduce((function(e,t){return e+t.charCodeAt(0)}),0)}},{key:"nickname",get:function(){return this._nickname},set:function(e){e.length>32?(console.log('Nickname "'.concat(e,'" is too long. Truncating to 32 characters.')),this._nickname=e.slice(0,32)):this._nickname=e}},{key:"rollDice",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this.rollEngine.roll(e,t,n)}},{key:"resetRollEngine",value:function(){this.rollEngine.resetSeed()}},{key:"setRollEngineSeed",value:function(e){this.rollEngine.setSeed(e)}},{key:"updateStat",value:function(e,t){this.stats[e]||(this.stats[e]=0),this.stats[e]+=t}},{key:"setStat",value:function(e,t){this.stats[e]=t}},{key:"getStat",value:function(e){return this.stats[e]||0}},{key:"removeStat",value:function(e){this.stats[e]?delete this.stats[e]:console.error('Stat "'.concat(e,'" does not exist.'))}},{key:"setCurrentSpaceId",value:function(e){this.currentSpaceId=e}},{key:"getCurrentSpaceId",value:function(){return this.currentSpaceId}},{key:"incrementTurnsTaken",value:function(){this.turnsTaken+=1}},{key:"setTurnsTaken",value:function(e){this.turnsTaken=Number(e)}},{key:"toJSON",value:function(){return{peerId:this.peerId,nickname:this.nickname,isHost:this.isHost,isSpectator:this.isSpectator,stats:this.stats,playerId:this.playerId,currentSpaceId:this.currentSpaceId,rollEngine:this.rollEngine.toJSON(),turnsTaken:this.turnsTaken,movementHistory:this.movementHistory.toJSON()}}}],r=[{key:"fromJSON",value:function(t){var n=new e(t.peerId,t.nickname,t.isHost,t.playerId,t.isSpectator);return n.stats=t.stats,n.currentSpaceId=t.currentSpaceId,n.rollEngine=b.fromJSON(t.rollEngine),n.turnsTaken=t.turnsTaken,n.movementHistory=I.fromJSON(t.movementHistory),n}}],n&&R(t.prototype,n),r&&R(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,r}(),A=__webpack_require__(775),M=__webpack_require__(89);function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var B=Object.freeze({VERY_LOW:{name:"VERY_LOW",value:1},LOW:{name:"LOW",value:2},MID:{name:"MID",value:3},HIGH:{name:"HIGH",value:4},VERY_HIGH:{name:"VERY_HIGH",value:5},CRITICAL:{name:"CRITICAL",value:6}}),N=(Object.freeze(Object.entries(B).reduce((function(e,t){var n,r,i=(r=2,function(e){if(Array.isArray(e))return e}(n=t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],c=!0,u=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){u=!0,i=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw i}}return s}}(n,r)||function(e,t){if(e){if("string"==typeof e)return D(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?D(e,t):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=(i[0],i[1]);return e[o.name]=o.value,e}),{})),__webpack_require__(459));const U=Object.freeze({READY:"READY",CHECKING_TRIGGER:"CHECKING_TRIGGER",TRIGGERED:"TRIGGERED",PROCESSING_ACTION:"PROCESSING_ACTION",COMPLETED_ACTION:"COMPLETED_ACTION",INACTIVE:"INACTIVE"});function G(e){return G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},G(e)}function F(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,H(r.key),r)}}function H(e){var t=function(e){if("object"!=G(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=G(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==G(t)?t:t+""}var z=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B.MID;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.trigger=t,this.action=n,this.priority=r,this.state=U.READY}return t=e,n=[{key:"checkTrigger",value:function(e){if(this.state===U.TRIGGERED)return!0;if(this.state!==U.READY)return!1;this.state=U.CHECKING_TRIGGER;var t=this.trigger.isTriggered(e);return this.state=t?U.TRIGGERED:U.READY,t}},{key:"executeAction",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]?this.state=U.TRIGGERED:this.checkTrigger(),this.state===U.TRIGGERED&&(this.state=U.PROCESSING_ACTION,this.action.execute(e),this.state=U.COMPLETED_ACTION)}},{key:"setState",value:function(e){if(!Object.values(U).includes(e))throw new Error("Invalid state: ".concat(e));this.state=e}},{key:"getState",value:function(){return this.state}},{key:"toJSON",value:function(){return{trigger:this.trigger.toJSON(),action:this.action.toJSON(),priority:this.priority,state:this.state}}}],r=[{key:"fromJSON",value:function(t){var n=t.priority?(0,N.Z3)(t.priority.name):"",r=B[n]||B.MID,i=new e(A.A.fromJSON(t.trigger),M.A.fromJSON(t.action),r);return i.setState(t.state||U.READY),i}}],n&&F(t.prototype,n),r&&F(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,r}();function J(e){return J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},J(e)}function V(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,W(r.key),r)}}function W(e){var t=function(e){if("object"!=J(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=J(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==J(t)?t:t+""}var Y=function(){function e(t,n,r,i,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=t,this.name=n,this.type=r,this.events=i,this.visualDetails=o,this.connections=a}return t=e,n=[{key:"addConnection",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.connections.push({target:e,condition:t,drawConnection:n})}},{key:"toJSON",value:function(){return{id:this.id,name:this.name,type:this.type,events:this.events.map((function(e){return e.toJSON()})),connections:this.connections.map((function(e){return{targetId:e.target.id,condition:e.condition,drawConnection:e.drawConnection}})),visualDetails:this.visualDetails}}}],r=[{key:"fromJSON",value:function(t){var n=t.events.map((function(e){return z.fromJSON(e)}));return new e(t.id,t.name,t.type,n,t.visualDetails,t.connections.map((function(e){return{targetId:e.targetId,condition:e.condition,drawConnection:void 0===e.drawConnection||e.drawConnection}})))}},{key:"resolveConnections",value:function(e,t){e.forEach((function(n){n.connections=t.find((function(e){return e.id===n.id})).connections.map((function(t){return{target:e.find((function(e){return e.id===t.targetId})),condition:t.condition,drawConnection:void 0===t.drawConnection||t.drawConnection}}))}))}}],n&&V(t.prototype,n),r&&V(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,r}();function $(e){return $="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$(e)}function K(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,q(r.key),r)}}function q(e){var t=function(e){if("object"!=$(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=$(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==$(t)?t:t+""}var X=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.spaces=t,this.metadata={name:n.name||"Default Board",author:n.author||"Unknown",description:n.description||"",createdDate:n.createdDate||(new Date).toISOString()}}return t=e,r=[{key:"fromJSON",value:function(t){var n=t.spaces.map((function(e){return Y.fromJSON(e)}));return Y.resolveConnections(n,t.spaces),new e(n,t.metadata)}}],(n=[{key:"addSpace",value:function(e){this.spaces.push(e)}},{key:"getSpace",value:function(e){return this.spaces.find((function(t){return t.id===e}))}},{key:"highlightSpaces",value:function(e){e.forEach((function(e){var t=document.getElementById("space-".concat(e.id));t&&t.classList.add("highlight")}))}},{key:"removeHighlightFromSpaces",value:function(e){e.forEach((function(e){var t=document.getElementById("space-".concat(e.id));t&&t.classList.remove("highlight")}))}},{key:"toJSON",value:function(){return{metadata:this.metadata,spaces:this.spaces.map((function(e){return e.toJSON()}))}}}])&&K(t.prototype,n),r&&K(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,r}(),Z=__webpack_require__(222);const Q=Object.freeze({IN_LOBBY:"IN_LOBBY",IN_GAME:"IN_GAME",GAME_ENDED:"GAME_ENDED",PAUSED:"PAUSED"});function ee(e){return ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ee(e)}function te(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ne(r.key),r)}}function ne(e){var t=function(e){if("object"!=ee(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=ee(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ee(t)?t:t+""}var re=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:150,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:300,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.playerLimitPerPeer=t,this.playerLimit=n,this.turnTimer=r,this.moveDelay=i,this.turnTimerEnabled=o}return t=e,r=[{key:"fromJSON",value:function(t){return new e(t.playerLimitPerPeer,t.playerLimit,t.turnTimer,t.moveDelay,t.turnTimerEnabled)}}],(n=[{key:"toJSON",value:function(){return{playerLimitPerPeer:this.playerLimitPerPeer,playerLimit:this.playerLimit,turnTimer:this.turnTimer,moveDelay:this.moveDelay,turnTimerEnabled:this.turnTimerEnabled}}},{key:"setTurnTimer",value:function(e){this.turnTimer=e}},{key:"getTurnTimer",value:function(){return this.turnTimer}},{key:"setMoveDelay",value:function(e){this.moveDelay=e}},{key:"getMoveDelay",value:function(){return this.moveDelay}},{key:"setTurnTimerEnabled",value:function(e){this.turnTimerEnabled=e}},{key:"isTurnTimerEnabled",value:function(){return this.turnTimerEnabled}}])&&te(t.prototype,n),r&&te(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,r}();function ie(e){return ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ie(e)}function oe(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=ae(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function ae(e,t){if(e){if("string"==typeof e)return se(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?se(e,t):void 0}}function se(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function ce(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ue(r.key),r)}}function ue(e){var t=function(e){if("object"!=ie(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=ie(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ie(t)?t:t+""}var le=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new re;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.board=t,this.players=n,this.remainingMoves=0,this.turnPhase=Z.A.BEGIN_TURN,this.gamePhase=Q.IN_LOBBY,this.settings=r,this.triggeredEvents=[]}return t=e,n=[{key:"startGame",value:function(){this.turnPhase=Z.A.CHANGE_TURN,this.gamePhase=Q.IN_GAME}},{key:"endGame",value:function(){this.gamePhase=Q.GAME_ENDED}},{key:"isGameStarted",value:function(){return this.gamePhase===Q.IN_GAME||this.gamePhase===Q.PAUSED}},{key:"isGameEnded",value:function(){return this.gamePhase===Q.GAME_ENDED}},{key:"addPlayer",value:function(e){e.setTurnsTaken(this.getTurnNumber()-1),this.players.push(e)}},{key:"removePlayer",value:function(e){this.players=this.players.filter((function(t){return t.playerId!==e}))}},{key:"removeClient",value:function(e){this.players=this.players.filter((function(t){return t.peerId!==e}))}},{key:"getCurrentPlayer",value:function(){return 0===this.players.length?null:this.players.reduce((function(e,t){return t.turnsTaken<e.turnsTaken?t:e}))}},{key:"getTurnNumber",value:function(){return 0===this.players.length?1:Math.min.apply(Math,function(e){return function(e){if(Array.isArray(e))return se(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||ae(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(this.players.map((function(e){return e.turnsTaken}))))+1}},{key:"determineTriggeredEvents",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=[],i=oe(this.board.spaces);try{for(i.s();!(e=i.n()).done;){var o,a=e.value,s={gameState:this,space:a,eventBus:t,peerId:n},c=oe(a.events);try{for(c.s();!(o=c.n()).done;){var u=o.value;u.checkTrigger(s)&&r.push({event:u,space:a})}}catch(e){c.e(e)}finally{c.f()}}}catch(e){i.e(e)}finally{i.f()}return this.triggeredEvents=r.sort((function(e,t){var n=e.event.priority.value;return t.event.priority.value-n})),this.triggeredEvents}},{key:"getTriggeredEvents",value:function(){return this.triggeredEvents}},{key:"resetEvents",value:function(){var e,t=oe(this.board.spaces);try{for(t.s();!(e=t.n()).done;){var n,r=oe(e.value.events);try{for(r.s();!(n=r.n()).done;){var i=n.value;i.state===U.COMPLETED_ACTION&&(i.state=U.READY)}}catch(e){r.e(e)}finally{r.f()}}}catch(e){t.e(e)}finally{t.f()}}},{key:"updatePlayerStats",value:function(e,t){this.getCurrentPlayer().updateStat(e,t)}},{key:"nextPlayerTurn",value:function(){var e=this.getCurrentPlayer();e&&(e.turnsTaken++,this.turnPhase=Z.A.BEGIN_TURN)}},{key:"setRemainingMoves",value:function(e){this.remainingMoves=e}},{key:"decrementMoves",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.remainingMoves=this.remainingMoves-e<0?0:this.remainingMoves-e}},{key:"movePlayer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=t?this.players.find((function(e){return e.playerId===t})):this.getCurrentPlayer();r?(r.setCurrentSpaceId(e),r.movementHistory.addMove(this.getTurnNumber(),e,this.remainingMoves),this.decrementMoves(n)):console.error("No player found with ID: ".concat(t))}},{key:"hasMovesLeft",value:function(){return this.remainingMoves>0}},{key:"setTurnPhase",value:function(e){Object.values(Z.A).includes(e)?(e===Z.A.END_TURN&&this.setRemainingMoves(0),this.turnPhase=e):console.error("Invalid turn phase: ".concat(e))}},{key:"setGamePhase",value:function(e){Object.values(Q).includes(e)?this.gamePhase=e:console.error("Invalid game phase: ".concat(e))}},{key:"toJSON",value:function(){return{board:this.board.toJSON(),players:this.players.map((function(e){return e.toJSON()})),remainingMoves:this.remainingMoves,turnPhase:this.turnPhase,gamePhase:this.gamePhase,settings:this.settings.toJSON()}}}],r=[{key:"fromJSON",value:function(t){var n=new e(X.fromJSON(t.board),t.players.map((function(e){return j.fromJSON(e)})),re.fromJSON(t.settings));return n.remainingMoves=t.remainingMoves,n.turnPhase=t.turnPhase,n.gamePhase=t.gamePhase,n}}],n&&ce(t.prototype,n),r&&ce(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,r}();function he(e){return he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},he(e)}function pe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function fe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,de(r.key),r)}}function de(e){var t=function(e){if("object"!=he(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=he(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==he(t)?t:t+""}var ye=function(){return e=function e(t,n,r,i){var o,a,s;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o=this,s=void 0,(a=de(a="AC"))in o?Object.defineProperty(o,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):o[a]=s,this.listElement=t,this.isHost=n,this.currentPlayerPeerId=r,this.hostPeerId=i,this.gameState=null},(t=[{key:"setListElement",value:function(e){this.listElement=e}},{key:"setIsHost",value:function(e){this.isHost=e}},{key:"setGameState",value:function(e){var t=le.fromJSON(e.toJSON());this.gameState=t,this.updatePlayerListUI()}},{key:"updatePlayerListUI",value:function(){var e=this;this.listElement&&(this.clearPlayerListUI(),this.gameState.players.forEach((function(t){var n=e.createPlayerElement(t);e.listElement.appendChild(n)})))}},{key:"createPlayerElement",value:function(e){var t=document.createElement("li");t.className="player-container";var n=document.createElement("div");n.className="player-name-badges";var r=e.playerColor||"#FFFFFF",i=e.peerColor||"#FFFFFF",o='<span class="player-name" style="color:'.concat(r,'; font-weight: bold;">').concat(e.nickname,"</span>");e.peerId===this.hostPeerId&&(o+='<span class="host-badge">Host</span>'),e.peerId===this.currentPlayerPeerId&&(o+='<span class="you-badge">You</span>'),n.innerHTML=o,t.style.border="2px solid ".concat(i);var a=document.createElement("div");if(a.className="player-buttons",e.peerId===this.currentPlayerPeerId){var s=document.createElement("button");s.className="edit-button",s.textContent="",s.setAttribute("data-playerId",e.playerId),s.id="".concat(this.listElement.id,"-edit-").concat(e.playerId),a.appendChild(s);var c=document.createElement("button");c.className="remove-button",c.textContent="",c.setAttribute("data-playerId",e.playerId),c.id="".concat(this.listElement.id,"-remove-").concat(e.playerId),a.appendChild(c)}if(this.isHost&&e.peerId!==this.hostPeerId){var u=document.createElement("button");u.className="kick-button",u.textContent="",u.setAttribute("data-playerId",e.playerId),u.id="".concat(this.listElement.id,"-kick-").concat(e.playerId),a.appendChild(u)}return this.gameState.getCurrentPlayer().playerId===e.playerId&&this.gameState.isGameStarted()&&t.classList.add("current-turn"),t.appendChild(n),t.appendChild(a),t}},{key:"clearPlayerListUI",value:function(){this.listElement&&(this.listElement.innerHTML="")}},{key:"shouldUpdatePlayers",value:function(e){if(!this.gameState)return!0;var t=this.gameState.players,n=e.players;if(t.length!==n.length)return!0;var r=new Map;t.forEach((function(e){r.set(e.playerId,e)}));var i,o=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return pe(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?pe(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(n);try{for(o.s();!(i=o.n()).done;){var a=i.value,s=r.get(a.playerId);if(!s)return!0;if(s.nickname!==a.nickname||s.peerId!==a.peerId||s.playerColor!==a.playerColor||s.peerColor!==a.peerColor||s.turnsTaken!==a.turnsTaken)return!0}}catch(e){o.e(e)}finally{o.f()}return this.gameState.currentPlayerId!==e.currentPlayerId}}])&&fe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function me(e){return me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},me(e)}function ve(){ve=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var o=t&&t.prototype instanceof v?t:v,a=Object.create(o.prototype),s=new x(r||[]);return i(a,"_invoke",{value:C(e,n,s)}),a}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var p="suspendedStart",f="suspendedYield",d="executing",y="completed",m={};function v(){}function g(){}function b(){}var w={};u(w,a,(function(){return this}));var _=Object.getPrototypeOf,S=_&&_(_(R([])));S&&S!==n&&r.call(S,a)&&(w=S);var P=b.prototype=v.prototype=Object.create(w);function k(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){function n(i,o,a,s){var c=h(e[i],e,o);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==me(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return n("throw",e,a,s)}))}s(c.arg)}var o;i(this,"_invoke",{value:function(e,r){function i(){return new t((function(t,i){n(e,r,t,i)}))}return o=o?o.then(i,i):i()}})}function C(t,n,r){var i=p;return function(o,a){if(i===d)throw Error("Generator is already running");if(i===y){if("throw"===o)throw a;return{value:e,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var c=T(s,r);if(c){if(c===m)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===p)throw i=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=d;var u=h(t,n,r);if("normal"===u.type){if(i=r.done?y:f,u.arg===m)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=y,r.method="throw",r.arg=u.arg)}}}function T(t,n){var r=n.method,i=t.iterator[r];if(i===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,T(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var o=h(i,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,m;var a=o.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function R(t){if(t||""===t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}throw new TypeError(me(t)+" is not iterable")}return g.prototype=b,i(P,"constructor",{value:b,configurable:!0}),i(b,"constructor",{value:g,configurable:!0}),g.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create(P),e},t.awrap=function(e){return{__await:e}},k(E.prototype),u(E.prototype,s,(function(){return this})),t.AsyncIterator=E,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new E(l(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},k(P),u(P,c,"Generator"),u(P,a,(function(){return this})),u(P,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=R,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(I),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return s.type="throw",s.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),I(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;I(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:R(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),m}},t}function ge(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function be(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){ge(o,r,i,a,s,"next",e)}function s(e){ge(o,r,i,a,s,"throw",e)}a(void 0)}))}}function we(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_e(r.key),r)}}function _e(e){var t=function(e){if("object"!=me(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=me(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==me(t)?t:t+""}var Se=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.board=null,this.boardContainer=document.getElementById("lobbyBoardContent")},t=[{key:"setBoard",value:function(e){var t=X.fromJSON(e.toJSON());this.board=t}},{key:"shouldUpdateBoard",value:function(e){return!this.board||JSON.stringify(this.board.toJSON())!==JSON.stringify(e.toJSON())}},{key:"setBoardContainer",value:function(e){this.boardContainer=e}},{key:"loadDefaultBoard",value:(r=be(ve().mark((function e(){var t,n;return ve().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Attempting to load the default board..."),e.prev=1,e.next=4,fetch("assets/maps/defaultBoard.json");case 4:return t=e.sent,e.next=7,t.json();case 7:n=e.sent,console.log("Default board data loaded:",n),this.board=X.fromJSON(n),console.log("Board object created:",this.board),this.drawBoard(),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(1),console.log(this.boardContainer),console.error("Error loading the default board:",e.t0);case 18:case"end":return e.stop()}}),e,this,[[1,14]])}))),function(){return r.apply(this,arguments)})},{key:"loadBoardFromFile",value:(n=be(ve().mark((function e(t){var n,r,i;return ve().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||"application/json"!==t.type){e.next=11;break}return e.next=3,this.readFile(t);case 3:return n=e.sent,r=JSON.parse(n),i=X.fromJSON(r),this.setBoard(i),this.drawBoard(),e.abrupt("return",i);case 11:throw new Error("File must be a valid JSON file.");case 12:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"readFile",value:function(e){return new Promise((function(t,n){var r=new FileReader;r.onload=function(e){return t(e.target.result)},r.onerror=function(e){return n(new Error("Failed to read file."))},r.readAsText(e)}))}},{key:"drawBoard",value:function(){var e=this;this.boardContainer.innerHTML="",this.board.spaces.forEach((function(e){var t="space-".concat(e.id),n=document.getElementById(t);n&&n.parentNode.removeChild(n)})),this.drawConnections(),this.board.spaces.forEach((function(t){var n=document.createElement("div");n.classList.add("board-space"),n.id="space-".concat(t.id);var r=t.visualDetails,i=r.x,o=void 0===i?0:i,a=r.y,s=void 0===a?0:a,c=r.size,u=void 0===c?60:c,l=r.color,h=void 0===l?"#000000":l,p=r.textColor,f=void 0===p?"#000000":p;n.style.position="absolute",n.style.left="".concat(o-u/2,"px"),n.style.top="".concat(s-u/2,"px"),n.style.width="".concat(u,"px"),n.style.height="".concat(u,"px"),n.style.backgroundColor=h,n.style.borderRadius="50%",n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="center",n.style.color=f,n.style.cursor="pointer",n.style.zIndex="2",n.innerText=t.name,n.addEventListener("click",(function(){return e.handleSpaceClick(t)})),e.boardContainer.appendChild(n)}))}},{key:"drawConnections",value:function(){var e=this,t=new Set;this.board.spaces.forEach((function(n){n.connections.forEach((function(r){var i=r.target;if(i&&(void 0===r.drawConnection||!0===r.drawConnection)){var o="".concat(Math.min(n.id,i.id),"-").concat(Math.max(n.id,i.id));if(!t.has(o)){var a=n.visualDetails,s=a.x,c=a.y,u=i.visualDetails,l=u.x,h=u.y;i.connections.find((function(e){return e.target.id===n.id}))?e.drawBidirectionalConnection(s,c,l,h):e.drawConnectionWithArrow(s,c,l,h),t.add(o)}}}))}))}},{key:"drawConnectionWithArrow",value:function(e,t,n,r){this.drawLine(e,t,n,r);var i=this.getPointAlongLine(e,t,n,r,.5);this.drawArrowhead(i.x,i.y,e,t,n,r)}},{key:"drawBidirectionalConnection",value:function(e,t,n,r){this.drawLine(e,t,n,r);var i=this.getPointAlongLine(e,t,n,r,.55);this.drawArrowhead(i.x,i.y,e,t,n,r);var o=this.getPointAlongLine(n,r,e,t,.55);this.drawArrowhead(o.x,o.y,n,r,e,t)}},{key:"drawLine",value:function(e,t,n,r){var i=Math.hypot(n-e,r-t),o=Math.atan2(r-t,n-e)*(180/Math.PI),a=document.createElement("div");a.classList.add("connection-line"),a.style.position="absolute",a.style.left="".concat(e,"px"),a.style.top="".concat(t,"px"),a.style.width="".concat(i,"px"),a.style.height="2px",a.style.backgroundColor="black",a.style.transformOrigin="0 0",a.style.transform="rotate(".concat(o,"deg)"),a.style.zIndex="1",this.boardContainer.appendChild(a)}},{key:"drawArrowhead",value:function(e,t,n,r,i,o){var a=Math.atan2(o-r,i-n)-Math.PI/2,s=document.createElement("div");s.classList.add("arrowhead"),s.style.position="absolute",s.style.left="".concat(e-5,"px"),s.style.top="".concat(t-5,"px"),s.style.width="0",s.style.height="0",s.style.borderLeft="".concat(5,"px solid transparent"),s.style.borderRight="".concat(5,"px solid transparent"),s.style.borderTop="".concat(10,"px solid black"),s.style.transform="rotate(".concat(a,"rad)"),s.style.transformOrigin="center center",s.style.zIndex="1",this.boardContainer.appendChild(s)}},{key:"getPointAlongLine",value:function(e,t,n,r,i){return{x:e+(n-e)*i,y:t+(r-t)*i}}},{key:"handleSpaceClick",value:function(e){console.log("Space clicked: ".concat(e.name,", id: ").concat(e.id))}},{key:"highlightSpaces",value:function(e){e.forEach((function(e){var t=document.getElementById("space-".concat(e.id));t&&t.classList.add("highlight")}))}},{key:"removeHighlightFromAll",value:function(){this.boardContainer.querySelectorAll(".highlight").forEach((function(e){e.classList.remove("highlight")}))}}],t&&we(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r}();function Pe(e){return Pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pe(e)}function ke(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Ee(r.key),r)}}function Ee(e){var t=function(e){if("object"!=Pe(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Pe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Pe(t)?t:t+""}var Ce=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.player=t,this.element=null},(t=[{key:"render",value:function(e,t,n){var r=this;if(!this.element){this.element=document.createElement("div"),this.element.classList.add("piece"),this.element.style.position="absolute",this.element.style.width="30px",this.element.style.height="30px",this.element.style.backgroundColor=this.player.playerColor,this.element.style.borderRadius="50%",this.element.style.textAlign="center",this.element.style.color="#000",this.element.style.lineHeight="30px",this.element.style.zIndex="3",this.element.style.opacity="0.75";var i=(0,N.nV)(this.player.playerColor,.75);this.element.style.border="2px solid ".concat(i),this.element.addEventListener("click",(function(){return r.handlePieceClick()}))}var o=0,a=0;if(t>1){var s=2*Math.PI*(n/t);o=10*Math.cos(s),a=10*Math.sin(s)}this.element.style.left="calc(50% + ".concat(o,"px - 15px)"),this.element.style.top="calc(50% + ".concat(a,"px - 15px)"),this.element.innerText=this.player.nickname.charAt(0).toUpperCase(),this.element.parentElement&&this.element.parentElement===e||e.appendChild(this.element)}},{key:"handlePieceClick",value:function(){console.log("Piece clicked: ".concat(this.player.nickname))}},{key:"remove",value:function(){this.element&&(this.element.remove(),this.element=null)}}])&&ke(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function Te(e){return Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Te(e)}function Oe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Ie(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,xe(r.key),r)}}function xe(e){var t=function(e){if("object"!=Te(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Te(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Te(t)?t:t+""}var Re=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pieces=[]},(t=[{key:"updatePieces",value:function(e){this.removePieces(e),this.addPieces(e),this.updatePiecePlayers(e);var t=this.getPlayersPerSpace(e);this.renderAllPieces(t)}},{key:"shouldUpdatePieces",value:function(e){var t=this.getPlayers();if(t.length!==e.length)return!0;var n=new Map;t.forEach((function(e){n.set(e.playerId,e)}));var r,i=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Oe(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Oe(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(e);try{for(i.s();!(r=i.n()).done;){var o=r.value,a=n.get(o.playerId);if(!a)return!0;if(a.currentSpaceId!==o.currentSpaceId)return!0}}catch(e){i.e(e)}finally{i.f()}return!1}},{key:"getPlayers",value:function(){return this.pieces.map((function(e){return e.player}))}},{key:"updatePiecePlayers",value:function(e){var t=this;e.players.forEach((function(e){var n=t.pieces.find((function(t){return t.player.playerId===e.playerId}));if(n){var r=j.fromJSON(e.toJSON());n.player=r}}))}},{key:"removePieces",value:function(e){var t=e.players.map((function(e){return e.playerId}));this.pieces=this.pieces.filter((function(e){return!!t.includes(e.player.playerId)||(e.remove(),!1)}))}},{key:"addPieces",value:function(e){var t=this;e.players.forEach((function(e){if(!t.pieces.find((function(t){return t.player.playerId===e.playerId}))){var n=j.fromJSON(e.toJSON()),r=new Ce(n);t.pieces.push(r)}}))}},{key:"getPlayersPerSpace",value:function(e){var t={};return e.players.forEach((function(e){var n=e.currentSpaceId;t[n]||(t[n]=[]),t[n].push(e.playerId)})),t}},{key:"renderAllPieces",value:function(e){this.pieces.forEach((function(t){var n=t.player.currentSpaceId,r=document.getElementById("space-".concat(n));if(r){var i=e[n],o=i.length,a=i.indexOf(t.player.playerId);t.render(r,o,a)}}))}}])&&Ie(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function Le(e){return Le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Le(e)}function je(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Ae(r.key),r)}}function Ae(e){var t=function(e){if("object"!=Le(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Le(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Le(t)?t:t+""}var Me=function(){return e=function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.isHost=t,this.currentSettings=null,this.settingsElements=this.initializeInputs()},(t=[{key:"initializeSettings",value:function(e){this.currentSettings=re.fromJSON(e.settings.toJSON()),this.syncUIWithSettings(this.currentSettings)}},{key:"initializeInputs",value:function(){return this.isHost?{playerLimitPerPeerInput:document.getElementById("playerLimitPerPeerHost"),totalPlayerLimitInput:document.getElementById("totalPlayerLimitHost"),turnTimerInput:document.getElementById("turnTimerHost"),moveDelayInput:document.getElementById("moveDelayHost"),turnTimerEnabledInput:document.getElementById("turnTimerEnabledHost")}:{playerLimitPerPeerDisplay:document.getElementById("playerLimitPerPeerDisplayClient"),totalPlayerLimitDisplay:document.getElementById("totalPlayerLimitDisplayClient"),turnTimerDisplay:document.getElementById("turnTimerClient"),moveDelayDisplay:document.getElementById("moveDelayClient"),turnTimerEnabledDisplay:document.getElementById("turnTimerEnabledClient")}}},{key:"getSettingsElements",value:function(){return this.settingsElements}},{key:"updateSettings",value:function(e){this.currentSettings=re.fromJSON(e.settings.toJSON()),this.syncUIWithSettings(this.currentSettings)}},{key:"shouldUpdateSettings",value:function(e){return!this.currentSettings||JSON.stringify(this.currentSettings)!==JSON.stringify(e)}},{key:"syncUIWithSettings",value:function(e){var t=this.settingsElements;this.isHost?(t.playerLimitPerPeerInput&&(t.playerLimitPerPeerInput.value=e.playerLimitPerPeer),t.totalPlayerLimitInput&&(t.totalPlayerLimitInput.value=e.playerLimit),t.turnTimerInput&&(t.turnTimerInput.value=e.turnTimer),t.moveDelayInput&&(t.moveDelayInput.value=e.moveDelay),t.turnTimerEnabledInput&&(t.turnTimerEnabledInput.checked=e.turnTimerEnabled)):(t.playerLimitPerPeerDisplay&&(t.playerLimitPerPeerDisplay.textContent=e.playerLimitPerPeer),t.totalPlayerLimitDisplay&&(t.totalPlayerLimitDisplay.textContent=e.playerLimit),t.turnTimerDisplay&&(t.turnTimerDisplay.textContent=e.turnTimer),t.turnTimerEnabledDisplay&&(t.turnTimerEnabledDisplay.checked=e.turnTimerEnabled),t.moveDelayDisplay&&(t.moveDelayDisplay.textContent=e.moveDelay))}},{key:"updateGameStateFromInputs",value:function(e){if(!this.isHost||!e)return e;var t=this.settingsElements,n=this.clampValue(parseInt(t.playerLimitPerPeerInput.value,10),t.playerLimitPerPeerInput.min,t.playerLimitPerPeerInput.max),r=this.clampValue(parseInt(t.totalPlayerLimitInput.value,10),t.totalPlayerLimitInput.min,t.totalPlayerLimitInput.max),i=this.clampValue(parseInt(t.turnTimerInput.value,10),t.turnTimerInput.min,t.turnTimerInput.max),o=this.clampValue(parseInt(t.moveDelayInput.value,10),t.moveDelayInput.min,t.moveDelayInput.max),a=t.turnTimerEnabledInput.checked;return this.currentSettings.playerLimitPerPeer=n,this.currentSettings.playerLimit=r,this.currentSettings.turnTimer=i,this.currentSettings.moveDelay=o,this.currentSettings.turnTimerEnabled=a,this.syncUIWithSettings(this.currentSettings),e.settings=re.fromJSON(this.currentSettings.toJSON()),e}},{key:"clampValue",value:function(e,t,n){return Math.min(Math.max(e,t),n)}}])&&je(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function De(e){return De="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},De(e)}function Be(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Ne(r.key),r)}}function Ne(e){var t=function(e){if("object"!=De(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=De(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==De(t)?t:t+""}var Ue=function(){return e=function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.registryManager=n,this.pageRegistry=n.getPageRegistry(),this.listenerRegistry=n.getListenerRegistry(),this.pluginManager=r,this.eventBus=i,this.isHost=t,this.inviteCode=document.getElementById("inviteCode"),this.copyMessage=document.getElementById("copyMessage"),this.boardManager=null,this.pieceManager=null,this.settingsManager=null,this.playerListManager=null,this.peer=null},t=[{key:"init",value:function(){this.setupEventListeners()}},{key:"initManagers",value:function(e,t){this.peerId=e,this.hostPeerId=t,this.boardManager=new Se,this.pieceManager=new Re,this.settingsManager=new Me(this.isHost),this.playerListManager=new ye(document.getElementById("lobbyPlayerList"),this.isHost,e,t)}},{key:"setupEventListeners",value:function(){}},{key:"hideAllPages",value:function(){this.pageRegistry.hideAllPages()}},{key:"showPage",value:function(e){this.pageRegistry.showPage(e),this.eventBus.emit("pageChanged",{pageId:e})}},{key:"displayInviteCode",value:function(e){var t=document.getElementById("inviteCode");t&&(t.textContent=e)}},{key:"copyInviteCode",value:function(){var e=this,t=this.inviteCode.textContent.trim();t&&navigator.clipboard.writeText(t).then((function(){e.showCopyMessage()})).catch((function(e){return console.error("Failed to copy invite code:",e)}))}},{key:"showCopyMessage",value:function(){var e=this;this.copyMessage.style.display="inline",setTimeout((function(){e.copyMessage.style.display="none"}),2e3)}},{key:"leaveGame",value:function(){alert("You have left the game."),location.reload()}},{key:"handlePeerError",value:function(e){alert("An error occurred: "+e),this.showPage("homePage"),location.reload()}},{key:"updateGameState",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.updateSettings(n),this.updateGameBoard(n),this.updatePieces(n),this.updatePlayerList(n),this.gameEngine&&(this.gameEngine.updateGameState(null===(e=this.peer)||void 0===e?void 0:e.gameState),this.eventBus.emit("gameStateUpdated",{gamestate:null===(t=this.peer)||void 0===t?void 0:t.gameState}))}},{key:"updateSettings",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=null===(e=this.peer)||void 0===e?void 0:e.gameState;n&&(t||this.settingsManager.shouldUpdateSettings(n.settings))&&(this.settingsManager.updateSettings(n),this.updateAddPlayerButton(),this.eventBus.emit("settingsUpdated",{gamestate:n}))}},{key:"updateGameBoard",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=null===(e=this.peer)||void 0===e?void 0:e.gameState;n&&(t||this.boardManager.shouldUpdateBoard(n.board))&&(this.boardManager.setBoard(n.board),this.boardManager.drawBoard(),this.updatePieces(!0),this.eventBus.emit("boardUpdated",{gamestate:n}))}},{key:"updatePieces",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=null===(e=this.peer)||void 0===e?void 0:e.gameState;n&&(t||this.pieceManager.shouldUpdatePieces(n.players))&&(this.pieceManager.updatePieces(n),this.eventBus.emit("piecesUpdated",{gamestate:n}))}},{key:"updatePlayerList",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=null===(e=this.peer)||void 0===e?void 0:e.gameState;n&&(t||this.playerListManager.shouldUpdatePlayers(n))&&(this.playerListManager.setGameState(n),this.addPlayerListListeners(),this.updateAddPlayerButton(),this.eventBus.emit("piecesUpdated",{gamestate:n}))}},{key:"updateAddPlayerButton",value:function(){var e,t,n,r,i=document.getElementById("addPlayerButton"),o=null===(e=this.peer)||void 0===e?void 0:e.gameState,a=null==o||null===(t=o.settings)||void 0===t?void 0:t.playerLimitPerPeer,s=null==o||null===(n=o.settings)||void 0===n?void 0:n.playerLimit,c=null===(r=this.peer)||void 0===r?void 0:r.ownedPlayers,u=null==o?void 0:o.players;c.length<a&&u.length<s?i.style.display="block":i.style.display="none"}}],t&&Be(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();class Ge{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(e){this.flush(),this._parts.push(e)}append(e){this._pieces.push(e)}flush(){if(this._pieces.length>0){const e=new Uint8Array(this._pieces);this._parts.push(e),this._pieces=[]}}toArrayBuffer(){const e=[];for(const t of this._parts)e.push(t);return function(e){let t=0;for(const n of e)t+=n.byteLength;const n=new Uint8Array(t);let r=0;for(const t of e){const e=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);n.set(e,r),r+=t.byteLength}return n}(e).buffer}}function Fe(e){return new ze(e).unpack()}function He(e){const t=new Je,n=t.pack(e);return n instanceof Promise?n.then((()=>t.getBuffer())):t.getBuffer()}class ze{constructor(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){const e=this.unpack_uint8();if(e<128)return e;if((224^e)<32)return(224^e)-32;let t;if((t=160^e)<=15)return this.unpack_raw(t);if((t=176^e)<=15)return this.unpack_string(t);if((t=144^e)<=15)return this.unpack_array(t);if((t=128^e)<=15)return this.unpack_map(t);switch(e){case 192:return null;case 193:case 212:case 213:case 214:case 215:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 216:return t=this.unpack_uint16(),this.unpack_string(t);case 217:return t=this.unpack_uint32(),this.unpack_string(t);case 218:return t=this.unpack_uint16(),this.unpack_raw(t);case 219:return t=this.unpack_uint32(),this.unpack_raw(t);case 220:return t=this.unpack_uint16(),this.unpack_array(t);case 221:return t=this.unpack_uint32(),this.unpack_array(t);case 222:return t=this.unpack_uint16(),this.unpack_map(t);case 223:return t=this.unpack_uint32(),this.unpack_map(t)}}unpack_uint8(){const e=255&this.dataView[this.index];return this.index++,e}unpack_uint16(){const e=this.read(2),t=256*(255&e[0])+(255&e[1]);return this.index+=2,t}unpack_uint32(){const e=this.read(4),t=256*(256*(256*e[0]+e[1])+e[2])+e[3];return this.index+=4,t}unpack_uint64(){const e=this.read(8),t=256*(256*(256*(256*(256*(256*(256*e[0]+e[1])+e[2])+e[3])+e[4])+e[5])+e[6])+e[7];return this.index+=8,t}unpack_int8(){const e=this.unpack_uint8();return e<128?e:e-256}unpack_int16(){const e=this.unpack_uint16();return e<32768?e:e-65536}unpack_int32(){const e=this.unpack_uint32();return e<2**31?e:e-2**32}unpack_int64(){const e=this.unpack_uint64();return e<2**63?e:e-2**64}unpack_raw(e){if(this.length<this.index+e)throw new Error(`BinaryPackFailure: index is out of range ${this.index} ${e} ${this.length}`);const t=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,t}unpack_string(e){const t=this.read(e);let n,r,i=0,o="";for(;i<e;)n=t[i],n<160?(r=n,i++):(192^n)<32?(r=(31&n)<<6|63&t[i+1],i+=2):(224^n)<16?(r=(15&n)<<12|(63&t[i+1])<<6|63&t[i+2],i+=3):(r=(7&n)<<18|(63&t[i+1])<<12|(63&t[i+2])<<6|63&t[i+3],i+=4),o+=String.fromCodePoint(r);return this.index+=e,o}unpack_array(e){const t=new Array(e);for(let n=0;n<e;n++)t[n]=this.unpack();return t}unpack_map(e){const t={};for(let n=0;n<e;n++)t[this.unpack()]=this.unpack();return t}unpack_float(){const e=this.unpack_uint32();return(e>>31?-1:1)*(8388607&e|8388608)*2**((e>>23&255)-127-23)}unpack_double(){const e=this.unpack_uint32(),t=(e>>20&2047)-1023;return(e>>31?-1:1)*((1048575&e|1048576)*2**(t-20)+this.unpack_uint32()*2**(t-52))}read(e){const t=this.index;if(t+e<=this.length)return this.dataView.subarray(t,t+e);throw new Error("BinaryPackFailure: read index out of range")}}class Je{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(e){if("string"==typeof e)this.pack_string(e);else if("number"==typeof e)Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if("boolean"==typeof e)!0===e?this._bufferBuilder.append(195):!1===e&&this._bufferBuilder.append(194);else if(void 0===e)this._bufferBuilder.append(192);else{if("object"!=typeof e)throw new Error(`Type "${typeof e}" not yet supported`);if(null===e)this._bufferBuilder.append(192);else{const t=e.constructor;if(e instanceof Array){const t=this.pack_array(e);if(t instanceof Promise)return t.then((()=>this._bufferBuilder.flush()))}else if(e instanceof ArrayBuffer)this.pack_bin(new Uint8Array(e));else if("BYTES_PER_ELEMENT"in e){const t=e;this.pack_bin(new Uint8Array(t.buffer,t.byteOffset,t.byteLength))}else if(e instanceof Date)this.pack_string(e.toString());else{if(e instanceof Blob)return e.arrayBuffer().then((e=>{this.pack_bin(new Uint8Array(e)),this._bufferBuilder.flush()}));if(t!=Object&&!t.toString().startsWith("class"))throw new Error(`Type "${t.toString()}" not yet supported`);{const t=this.pack_object(e);if(t instanceof Promise)return t.then((()=>this._bufferBuilder.flush()))}}}}this._bufferBuilder.flush()}pack_bin(e){const t=e.length;if(t<=15)this.pack_uint8(160+t);else if(t<=65535)this._bufferBuilder.append(218),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this._bufferBuilder.append(219),this.pack_uint32(t)}this._bufferBuilder.append_buffer(e)}pack_string(e){const t=this._textEncoder.encode(e),n=t.length;if(n<=15)this.pack_uint8(176+n);else if(n<=65535)this._bufferBuilder.append(216),this.pack_uint16(n);else{if(!(n<=4294967295))throw new Error("Invalid length");this._bufferBuilder.append(217),this.pack_uint32(n)}this._bufferBuilder.append_buffer(t)}pack_array(e){const t=e.length;if(t<=15)this.pack_uint8(144+t);else if(t<=65535)this._bufferBuilder.append(220),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this._bufferBuilder.append(221),this.pack_uint32(t)}const n=r=>{if(r<t){const t=this.pack(e[r]);return t instanceof Promise?t.then((()=>n(r+1))):n(r+1)}};return n(0)}pack_integer(e){if(e>=-32&&e<=127)this._bufferBuilder.append(255&e);else if(e>=0&&e<=255)this._bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this._bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this._bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this._bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this._bufferBuilder.append(210),this.pack_int32(e);else if(e>=-0x8000000000000000&&e<=0x8000000000000000)this._bufferBuilder.append(211),this.pack_int64(e);else{if(!(e>=0&&e<=0x10000000000000000))throw new Error("Invalid integer");this._bufferBuilder.append(207),this.pack_uint64(e)}}pack_double(e){let t=0;e<0&&(t=1,e=-e);const n=Math.floor(Math.log(e)/Math.LN2),r=e/2**n-1,i=Math.floor(r*2**52),o=2**32,a=t<<31|n+1023<<20|i/o&1048575,s=i%o;this._bufferBuilder.append(203),this.pack_int32(a),this.pack_int32(s)}pack_object(e){const t=Object.keys(e),n=t.length;if(n<=15)this.pack_uint8(128+n);else if(n<=65535)this._bufferBuilder.append(222),this.pack_uint16(n);else{if(!(n<=4294967295))throw new Error("Invalid length");this._bufferBuilder.append(223),this.pack_uint32(n)}const r=n=>{if(n<t.length){const i=t[n];if(e.hasOwnProperty(i)){this.pack(i);const t=this.pack(e[i]);if(t instanceof Promise)return t.then((()=>r(n+1)))}return r(n+1)}};return r(0)}pack_uint8(e){this._bufferBuilder.append(e)}pack_uint16(e){this._bufferBuilder.append(e>>8),this._bufferBuilder.append(255&e)}pack_uint32(e){const t=4294967295&e;this._bufferBuilder.append((4278190080&t)>>>24),this._bufferBuilder.append((16711680&t)>>>16),this._bufferBuilder.append((65280&t)>>>8),this._bufferBuilder.append(255&t)}pack_uint64(e){const t=e/2**32,n=e%2**32;this._bufferBuilder.append((4278190080&t)>>>24),this._bufferBuilder.append((16711680&t)>>>16),this._bufferBuilder.append((65280&t)>>>8),this._bufferBuilder.append(255&t),this._bufferBuilder.append((4278190080&n)>>>24),this._bufferBuilder.append((16711680&n)>>>16),this._bufferBuilder.append((65280&n)>>>8),this._bufferBuilder.append(255&n)}pack_int8(e){this._bufferBuilder.append(255&e)}pack_int16(e){this._bufferBuilder.append((65280&e)>>8),this._bufferBuilder.append(255&e)}pack_int32(e){this._bufferBuilder.append(e>>>24&255),this._bufferBuilder.append((16711680&e)>>>16),this._bufferBuilder.append((65280&e)>>>8),this._bufferBuilder.append(255&e)}pack_int64(e){const t=Math.floor(e/2**32),n=e%2**32;this._bufferBuilder.append((4278190080&t)>>>24),this._bufferBuilder.append((16711680&t)>>>16),this._bufferBuilder.append((65280&t)>>>8),this._bufferBuilder.append(255&t),this._bufferBuilder.append((4278190080&n)>>>24),this._bufferBuilder.append((16711680&n)>>>16),this._bufferBuilder.append((65280&n)>>>8),this._bufferBuilder.append(255&n)}constructor(){this._bufferBuilder=new Ge,this._textEncoder=new TextEncoder}}let Ve=!0,We=!0;function Ye(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function $e(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);const o=e=>{const t=n(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,o),i.apply(this,[e,o])};const o=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(n))return o.apply(this,arguments);const r=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function Ke(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(Ve=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function qe(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(We=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Xe(){if("object"==typeof window){if(Ve)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function Ze(e,t){We&&console.warn(e+" is deprecated, please use "+t+" instead.")}function Qe(e){return"[object Object]"===Object.prototype.toString.call(e)}function et(e){return Qe(e)?Object.keys(e).reduce((function(t,n){const r=Qe(e[n]),i=r?et(e[n]):e[n],o=r&&!Object.keys(i).length;return void 0===i||o?t:Object.assign(t,{[n]:i})}),{}):e}function tt(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((r=>{r.endsWith("Id")?tt(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach((t=>{tt(e,e.get(t),n)}))})))}function nt(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;const o=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)})),o.forEach((t=>{e.forEach((n=>{n.type===r&&n.trackId===t.id&&tt(e,n,i)}))})),i}const rt=Xe;function it(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);const i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];let e={};"number"==typeof r.ideal?(e[i("min",n)]=r.ideal,t.optional.push(e),e={},e[i("max",n)]=r.ideal,t.optional.push(e)):(e[i("",n)]=r.ideal,t.optional.push(e))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach((e=>{void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"==typeof e.video){let o=e.video.facingMode;o=o&&("object"==typeof o?o:{ideal:o});const a=t.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||a)){let t;if(delete e.video.facingMode,"environment"===o.exact||"environment"===o.ideal?t=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then((n=>{let a=(n=n.filter((e=>"videoinput"===e.kind))).find((e=>t.some((t=>e.label.toLowerCase().includes(t)))));return!a&&n.length&&t.includes("back")&&(a=n[n.length-1]),a&&(e.video.deviceId=o.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=r(e.video),rt("chrome: "+JSON.stringify(e)),i(e)}))}e.video=r(e.video)}return rt("chrome: "+JSON.stringify(e)),i(e)},o=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,r){i(e,(e=>{n.webkitGetUserMedia(e,t,(e=>{r&&r(o(e))}))}))}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return i(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>Promise.reject(o(e))))))}}}function ot(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function at(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.track.id)):{track:n.track};const i=new Event("track");i.track=n.track,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)})),t.stream.getTracks().forEach((n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.id)):{track:n};const i=new Event("track");i.track=n,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else $e(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function st(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){let i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function ct(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>nt(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),$e(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>nt(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,r;return this.getSenders().forEach((n=>{n.track===e&&(t?r=!0:t=n)})),this.getReceivers().forEach((t=>(t.track===e&&(n?r=!0:n=t),t.track===e))),r||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function ut(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();n.apply(this,arguments);const r=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(r)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),i.apply(this,arguments)}}function lt(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return ut(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}r.apply(this,[t])};const i=e.RTCPeerConnection.prototype.removeStream;function o(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((e=>e.track===t)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const i=this._streams[n.id];if(i)i.addTrack(t),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const r=new e.MediaStream([t]);this._streams[n.id]=r,this._reverseStreams[r.id]=n,this.addStream(r)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{const n=o(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then((e=>o(this,e)))}};e.RTCPeerConnection.prototype[t]=r[t]}));const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};const s=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=s.get.apply(this);return""===e.type?e:o(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((n=>{this._streams[n].getTracks().find((t=>e.track===t))&&(t=this._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function ht(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}))}function pt(e,t){$e(e,"negotiationneeded",(e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))}function ft(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){Ze("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},r&&r.prototype.getSettings){const t=r.prototype.getSettings;r.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(r&&r.prototype.applyConstraints){const t=r.prototype.applyConstraints;r.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function dt(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}function yt(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function mt(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}));const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,i,o]=arguments;return r.apply(this,[e||null]).then((e=>{if(t.version<53&&!i)try{e.forEach((e=>{e.type=n[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach(((t,r)=>{e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(i,o)}}function vt(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function gt(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),$e(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function bt(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){Ze("removeStream","removeTrack"),this.getSenders().forEach((t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)}))})}function wt(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function _t(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const n=e.length>0;n&&e.forEach((e=>{if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const r=t.apply(this,arguments);if(n){const{sender:t}=r,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(n).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return r})}function St(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function Pt(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function kt(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function Et(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((n=>t.call(this,n,e))),e.getVideoTracks().forEach((n=>t.call(this,n,e)))},e.RTCPeerConnection.prototype.addTrack=function(e,...n){return n&&n.forEach((e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach((e=>{n.includes(e.track)&&this.removeTrack(e)}))})}}function Ct(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}))}),t.apply(e,arguments)}}}function Tt(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){const r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i};let s=function(e,t,n){const r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=s,s=function(e,t,n){const r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=s,s=function(e,t,n){const r=a.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=s}function Ot(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(It(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))}function It(e){return e&&void 0!==e.video?Object.assign({},e,{video:et(e.video)}):e}function xt(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let r=e.iceServers[n];void 0===r.urls&&r.url?(Ze("RTCIceServer.url","RTCIceServer.urls"),r=JSON.parse(JSON.stringify(r)),r.urls=r.url,delete r.url,t.push(r)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function Rt(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Lt(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function jt(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var At=__webpack_require__(963),Mt=__webpack_require__.n(At);function Dt(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){const n=new t(e),r=Mt().parseCandidate(e.candidate);for(const e in r)e in n||Object.defineProperty(n,e,{value:r[e]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,$e(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function Bt(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||$e(e,"icecandidate",(e=>{if(e.candidate){const t=Mt().parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e}))}function Nt(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(e){if(!e||!e.sdp)return!1;const t=Mt().splitSections(e.sdp);return t.shift(),t.some((e=>{const t=Mt().parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))}(arguments[0])){const e=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n}(arguments[0]),n=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n}(e),r=function(e,n){let r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);const i=Mt().matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?r=parseInt(i[0].substring(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r}(arguments[0],e);let i;i=0===n&&0===r?Number.POSITIVE_INFINITY:0===n||0===r?Math.max(n,r):Math.min(n,r);const o={};Object.defineProperty(o,"maxMessageSize",{get:()=>i}),this._sctp=o}return n.apply(this,arguments)}}function Ut(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const r=arguments[0],i=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},$e(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function Gt(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}function Ft(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==e.trim())).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function Ht(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function zt(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}return e.sdp||"offer"!==e.type&&"answer"!==e.type?n.apply(this,[e]):("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then((e=>n.apply(this,[e])))})}const Jt=function({window:r}={},o={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const a=Xe,s=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.userAgentData&&n.userAgentData.brands){const e=n.userAgentData.brands.find((e=>"Chromium"===e.brand));if(e)return{browser:"chrome",version:parseInt(e.version,10)}}if(n.mozGetUserMedia)t.browser="firefox",t.version=Ye(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=Ye(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=Ye(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(r),c={browserDetails:s,commonShim:i,extractVersion:Ye,disableLog:Ke,disableWarnings:qe,sdp:At};switch(s.browser){case"chrome":if(!e||!ht||!o.shimChrome)return a("Chrome shim is not included in this adapter release."),c;if(null===s.version)return a("Chrome shim can not determine version, not shimming."),c;a("adapter.js shimming chrome."),c.browserShim=e,Ht(r,s),zt(r),it(r,s),ot(r),ht(r,s),at(r),lt(r,s),st(r),ct(r),pt(r,s),Dt(r),Bt(r),Gt(r),Nt(r,s),Ut(r),Ft(r,s);break;case"firefox":if(!t||!mt||!o.shimFirefox)return a("Firefox shim is not included in this adapter release."),c;a("adapter.js shimming firefox."),c.browserShim=t,Ht(r,s),zt(r),ft(r,s),mt(r,s),yt(r),bt(r),vt(r),gt(r),wt(r),_t(r),St(r),Pt(r),kt(r),Dt(r),Gt(r),Nt(r,s),Ut(r);break;case"safari":if(!n||!o.shimSafari)return a("Safari shim is not included in this adapter release."),c;a("adapter.js shimming safari."),c.browserShim=n,Ht(r,s),zt(r),xt(r),Lt(r),Tt(r),Et(r),Ct(r),Rt(r),Ot(r),jt(r),Dt(r),Bt(r),Nt(r,s),Ut(r),Ft(r,s);break;default:a("Unsupported browser!")}return c}({window:"undefined"==typeof window?void 0:window}),Vt=Jt;var Wt,Yt,$t,Kt=4294967295;function qt(e,t,n){var r=Math.floor(n/4294967296),i=n;e.setUint32(t,r),e.setUint32(t+4,i)}function Xt(e,t){return 4294967296*e.getInt32(t)+e.getUint32(t+4)}var Zt=("undefined"==typeof process||"never"!==(null===(Wt=null===process||void 0===process?void 0:process.env)||void 0===Wt?void 0:Wt.TEXT_ENCODING))&&"undefined"!=typeof TextEncoder&&"undefined"!=typeof TextDecoder;function Qt(e){for(var t=e.length,n=0,r=0;r<t;){var i=e.charCodeAt(r++);if(4294967168&i)if(4294965248&i){if(i>=55296&&i<=56319&&r<t){var o=e.charCodeAt(r);56320==(64512&o)&&(++r,i=((1023&i)<<10)+(1023&o)+65536)}n+=4294901760&i?4:3}else n+=2;else n++}return n}var en=Zt?new TextEncoder:void 0,tn=Zt?"undefined"!=typeof process&&"force"!==(null===(Yt=null===process||void 0===process?void 0:process.env)||void 0===Yt?void 0:Yt.TEXT_ENCODING)?200:0:Kt,nn=(null==en?void 0:en.encodeInto)?function(e,t,n){en.encodeInto(e,t.subarray(n))}:function(e,t,n){t.set(en.encode(e),n)};function rn(e,t,n){for(var r=t,i=r+n,o=[],a="";r<i;){var s=e[r++];if(128&s)if(192==(224&s)){var c=63&e[r++];o.push((31&s)<<6|c)}else if(224==(240&s)){c=63&e[r++];var u=63&e[r++];o.push((31&s)<<12|c<<6|u)}else if(240==(248&s)){var l=(7&s)<<18|(c=63&e[r++])<<12|(u=63&e[r++])<<6|63&e[r++];l>65535&&(l-=65536,o.push(l>>>10&1023|55296),l=56320|1023&l),o.push(l)}else o.push(s);else o.push(s);o.length>=4096&&(a+=String.fromCharCode.apply(String,o),o.length=0)}return o.length>0&&(a+=String.fromCharCode.apply(String,o)),a}var on,an=Zt?new TextDecoder:null,sn=Zt?"undefined"!=typeof process&&"force"!==(null===($t=null===process||void 0===process?void 0:process.env)||void 0===$t?void 0:$t.TEXT_DECODER)?200:0:Kt,cn=function(e,t){this.type=e,this.data=t},un=(on=function(e,t){return on=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},on(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}on(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),ln=function(e){function t(n){var r=e.call(this,n)||this,i=Object.create(t.prototype);return Object.setPrototypeOf(r,i),Object.defineProperty(r,"name",{configurable:!0,enumerable:!1,value:t.name}),r}return un(t,e),t}(Error),hn={type:-1,encode:function(e){var t,n,r,i;return e instanceof Date?function(e){var t,n=e.sec,r=e.nsec;if(n>=0&&r>=0&&n<=17179869183){if(0===r&&n<=4294967295){var i=new Uint8Array(4);return(t=new DataView(i.buffer)).setUint32(0,n),i}var o=n/4294967296,a=4294967295&n;return i=new Uint8Array(8),(t=new DataView(i.buffer)).setUint32(0,r<<2|3&o),t.setUint32(4,a),i}return i=new Uint8Array(12),(t=new DataView(i.buffer)).setUint32(0,r),qt(t,4,n),i}((r=1e6*((t=e.getTime())-1e3*(n=Math.floor(t/1e3))),{sec:n+(i=Math.floor(r/1e9)),nsec:r-1e9*i})):null},decode:function(e){var t=function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);switch(e.byteLength){case 4:return{sec:t.getUint32(0),nsec:0};case 8:var n=t.getUint32(0);return{sec:4294967296*(3&n)+t.getUint32(4),nsec:n>>>2};case 12:return{sec:Xt(t,4),nsec:t.getUint32(0)};default:throw new ln("Unrecognized data size for timestamp (expected 4, 8, or 12): ".concat(e.length))}}(e);return new Date(1e3*t.sec+t.nsec/1e6)}},pn=function(){function e(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(hn)}return e.prototype.register=function(e){var t=e.type,n=e.encode,r=e.decode;if(t>=0)this.encoders[t]=n,this.decoders[t]=r;else{var i=1+t;this.builtInEncoders[i]=n,this.builtInDecoders[i]=r}},e.prototype.tryToEncode=function(e,t){for(var n=0;n<this.builtInEncoders.length;n++)if(null!=(r=this.builtInEncoders[n])&&null!=(i=r(e,t)))return new cn(-1-n,i);for(n=0;n<this.encoders.length;n++){var r,i;if(null!=(r=this.encoders[n])&&null!=(i=r(e,t)))return new cn(n,i)}return e instanceof cn?e:null},e.prototype.decode=function(e,t,n){var r=t<0?this.builtInDecoders[-1-t]:this.decoders[t];return r?r(e,t,n):new cn(t,e)},e.defaultCodec=new e,e}();function fn(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer?new Uint8Array(e):Uint8Array.from(e)}function dn(e){return"".concat(e<0?"-":"","0x").concat(Math.abs(e).toString(16).padStart(2,"0"))}!function(){function e(e,t,n,r,i,o,a,s){void 0===e&&(e=pn.defaultCodec),void 0===t&&(t=void 0),void 0===n&&(n=100),void 0===r&&(r=2048),void 0===i&&(i=!1),void 0===o&&(o=!1),void 0===a&&(a=!1),void 0===s&&(s=!1),this.extensionCodec=e,this.context=t,this.maxDepth=n,this.initialBufferSize=r,this.sortKeys=i,this.forceFloat32=o,this.ignoreUndefined=a,this.forceIntegerToFloat=s,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}e.prototype.reinitializeState=function(){this.pos=0},e.prototype.encodeSharedRef=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)},e.prototype.encode=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)},e.prototype.doEncode=function(e,t){if(t>this.maxDepth)throw new Error("Too deep objects in depth ".concat(t));null==e?this.encodeNil():"boolean"==typeof e?this.encodeBoolean(e):"number"==typeof e?this.encodeNumber(e):"string"==typeof e?this.encodeString(e):this.encodeObject(e,t)},e.prototype.ensureBufferSizeToWrite=function(e){var t=this.pos+e;this.view.byteLength<t&&this.resizeBuffer(2*t)},e.prototype.resizeBuffer=function(e){var t=new ArrayBuffer(e),n=new Uint8Array(t),r=new DataView(t);n.set(this.bytes),this.view=r,this.bytes=n},e.prototype.encodeNil=function(){this.writeU8(192)},e.prototype.encodeBoolean=function(e){!1===e?this.writeU8(194):this.writeU8(195)},e.prototype.encodeNumber=function(e){Number.isSafeInteger(e)&&!this.forceIntegerToFloat?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):(this.writeU8(211),this.writeI64(e)):this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))},e.prototype.writeStringHeader=function(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else{if(!(e<4294967296))throw new Error("Too long string: ".concat(e," bytes in UTF-8"));this.writeU8(219),this.writeU32(e)}},e.prototype.encodeString=function(e){if(e.length>tn){var t=Qt(e);this.ensureBufferSizeToWrite(5+t),this.writeStringHeader(t),nn(e,this.bytes,this.pos),this.pos+=t}else t=Qt(e),this.ensureBufferSizeToWrite(5+t),this.writeStringHeader(t),function(e,t,n){for(var r=e.length,i=n,o=0;o<r;){var a=e.charCodeAt(o++);if(4294967168&a){if(4294965248&a){if(a>=55296&&a<=56319&&o<r){var s=e.charCodeAt(o);56320==(64512&s)&&(++o,a=((1023&a)<<10)+(1023&s)+65536)}4294901760&a?(t[i++]=a>>18&7|240,t[i++]=a>>12&63|128,t[i++]=a>>6&63|128):(t[i++]=a>>12&15|224,t[i++]=a>>6&63|128)}else t[i++]=a>>6&31|192;t[i++]=63&a|128}else t[i++]=a}}(e,this.bytes,this.pos),this.pos+=t},e.prototype.encodeObject=function(e,t){var n=this.extensionCodec.tryToEncode(e,this.context);if(null!=n)this.encodeExtension(n);else if(Array.isArray(e))this.encodeArray(e,t);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else{if("object"!=typeof e)throw new Error("Unrecognized object: ".concat(Object.prototype.toString.apply(e)));this.encodeMap(e,t)}},e.prototype.encodeBinary=function(e){var t=e.byteLength;if(t<256)this.writeU8(196),this.writeU8(t);else if(t<65536)this.writeU8(197),this.writeU16(t);else{if(!(t<4294967296))throw new Error("Too large binary: ".concat(t));this.writeU8(198),this.writeU32(t)}var n=fn(e);this.writeU8a(n)},e.prototype.encodeArray=function(e,t){var n=e.length;if(n<16)this.writeU8(144+n);else if(n<65536)this.writeU8(220),this.writeU16(n);else{if(!(n<4294967296))throw new Error("Too large array: ".concat(n));this.writeU8(221),this.writeU32(n)}for(var r=0,i=e;r<i.length;r++){var o=i[r];this.doEncode(o,t+1)}},e.prototype.countWithoutUndefined=function(e,t){for(var n=0,r=0,i=t;r<i.length;r++)void 0!==e[i[r]]&&n++;return n},e.prototype.encodeMap=function(e,t){var n=Object.keys(e);this.sortKeys&&n.sort();var r=this.ignoreUndefined?this.countWithoutUndefined(e,n):n.length;if(r<16)this.writeU8(128+r);else if(r<65536)this.writeU8(222),this.writeU16(r);else{if(!(r<4294967296))throw new Error("Too large map object: ".concat(r));this.writeU8(223),this.writeU32(r)}for(var i=0,o=n;i<o.length;i++){var a=o[i],s=e[a];this.ignoreUndefined&&void 0===s||(this.encodeString(a),this.doEncode(s,t+1))}},e.prototype.encodeExtension=function(e){var t=e.data.length;if(1===t)this.writeU8(212);else if(2===t)this.writeU8(213);else if(4===t)this.writeU8(214);else if(8===t)this.writeU8(215);else if(16===t)this.writeU8(216);else if(t<256)this.writeU8(199),this.writeU8(t);else if(t<65536)this.writeU8(200),this.writeU16(t);else{if(!(t<4294967296))throw new Error("Too large extension object: ".concat(t));this.writeU8(201),this.writeU32(t)}this.writeI8(e.type),this.writeU8a(e.data)},e.prototype.writeU8=function(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++},e.prototype.writeU8a=function(e){var t=e.length;this.ensureBufferSizeToWrite(t),this.bytes.set(e,this.pos),this.pos+=t},e.prototype.writeI8=function(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++},e.prototype.writeU16=function(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2},e.prototype.writeI16=function(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2},e.prototype.writeU32=function(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4},e.prototype.writeI32=function(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4},e.prototype.writeF32=function(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4},e.prototype.writeF64=function(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8},e.prototype.writeU64=function(e){this.ensureBufferSizeToWrite(8),function(e,t,n){var r=n/4294967296,i=n;e.setUint32(t,r),e.setUint32(t+4,i)}(this.view,this.pos,e),this.pos+=8},e.prototype.writeI64=function(e){this.ensureBufferSizeToWrite(8),qt(this.view,this.pos,e),this.pos+=8}}();var yn=function(){function e(e,t){void 0===e&&(e=16),void 0===t&&(t=16),this.maxKeyLength=e,this.maxLengthPerKey=t,this.hit=0,this.miss=0,this.caches=[];for(var n=0;n<this.maxKeyLength;n++)this.caches.push([])}return e.prototype.canBeCached=function(e){return e>0&&e<=this.maxKeyLength},e.prototype.find=function(e,t,n){e:for(var r=0,i=this.caches[n-1];r<i.length;r++){for(var o=i[r],a=o.bytes,s=0;s<n;s++)if(a[s]!==e[t+s])continue e;return o.str}return null},e.prototype.store=function(e,t){var n=this.caches[e.length-1],r={bytes:e,str:t};n.length>=this.maxLengthPerKey?n[Math.random()*n.length|0]=r:n.push(r)},e.prototype.decode=function(e,t,n){var r=this.find(e,t,n);if(null!=r)return this.hit++,r;this.miss++;var i=rn(e,t,n),o=Uint8Array.prototype.slice.call(e,t,t+n);return this.store(o,i),i},e}(),mn=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},vn=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,i){!function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)}(r,i,(t=e[n](t)).done,t.value)}))}}},gn=function(e){return this instanceof gn?(this.v=e,this):new gn(e)},bn=new DataView(new ArrayBuffer(0)),wn=new Uint8Array(bn.buffer),_n=function(){try{bn.getInt8(0)}catch(e){return e.constructor}throw new Error("never reached")}(),Sn=new _n("Insufficient data"),Pn=new yn;function kn(e,t,n,r){Object.defineProperty(e,t,{get:n,set:r,enumerable:!0,configurable:!0})}!function(){function e(e,t,n,r,i,o,a,s){void 0===e&&(e=pn.defaultCodec),void 0===t&&(t=void 0),void 0===n&&(n=Kt),void 0===r&&(r=Kt),void 0===i&&(i=Kt),void 0===o&&(o=Kt),void 0===a&&(a=Kt),void 0===s&&(s=Pn),this.extensionCodec=e,this.context=t,this.maxStrLength=n,this.maxBinLength=r,this.maxArrayLength=i,this.maxMapLength=o,this.maxExtLength=a,this.keyDecoder=s,this.totalPos=0,this.pos=0,this.view=bn,this.bytes=wn,this.headByte=-1,this.stack=[]}e.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=-1,this.stack.length=0},e.prototype.setBuffer=function(e){this.bytes=fn(e),this.view=function(e){if(e instanceof ArrayBuffer)return new DataView(e);var t=fn(e);return new DataView(t.buffer,t.byteOffset,t.byteLength)}(this.bytes),this.pos=0},e.prototype.appendBuffer=function(e){if(-1!==this.headByte||this.hasRemaining(1)){var t=this.bytes.subarray(this.pos),n=fn(e),r=new Uint8Array(t.length+n.length);r.set(t),r.set(n,t.length),this.setBuffer(r)}else this.setBuffer(e)},e.prototype.hasRemaining=function(e){return this.view.byteLength-this.pos>=e},e.prototype.createExtraByteError=function(e){var t=this.view,n=this.pos;return new RangeError("Extra ".concat(t.byteLength-n," of ").concat(t.byteLength," byte(s) found at buffer[").concat(e,"]"))},e.prototype.decode=function(e){this.reinitializeState(),this.setBuffer(e);var t=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return t},e.prototype.decodeMulti=function(e){return mn(this,(function(t){switch(t.label){case 0:this.reinitializeState(),this.setBuffer(e),t.label=1;case 1:return this.hasRemaining(1)?[4,this.doDecodeSync()]:[3,3];case 2:return t.sent(),[3,1];case 3:return[2]}}))},e.prototype.decodeAsync=function(e){var t,n,r,i,o,a,s,c;return o=this,a=void 0,c=function(){var o,a,s,c,u,l,h,p;return mn(this,(function(f){switch(f.label){case 0:o=!1,f.label=1;case 1:f.trys.push([1,6,7,12]),t=vn(e),f.label=2;case 2:return[4,t.next()];case 3:if((n=f.sent()).done)return[3,5];if(s=n.value,o)throw this.createExtraByteError(this.totalPos);this.appendBuffer(s);try{a=this.doDecodeSync(),o=!0}catch(e){if(!(e instanceof _n))throw e}this.totalPos+=this.pos,f.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return c=f.sent(),r={error:c},[3,12];case 7:return f.trys.push([7,,10,11]),n&&!n.done&&(i=t.return)?[4,i.call(t)]:[3,9];case 8:f.sent(),f.label=9;case 9:return[3,11];case 10:if(r)throw r.error;return[7];case 11:return[7];case 12:if(o){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return[2,a]}throw l=(u=this).headByte,h=u.pos,p=u.totalPos,new RangeError("Insufficient data in parsing ".concat(dn(l)," at ").concat(p," (").concat(h," in the current buffer)"))}}))},new((s=void 0)||(s=Promise))((function(e,t){function n(e){try{i(c.next(e))}catch(e){t(e)}}function r(e){try{i(c.throw(e))}catch(e){t(e)}}function i(t){var i;t.done?e(t.value):(i=t.value,i instanceof s?i:new s((function(e){e(i)}))).then(n,r)}i((c=c.apply(o,a||[])).next())}))},e.prototype.decodeArrayStream=function(e){return this.decodeMultiAsync(e,!0)},e.prototype.decodeStream=function(e){return this.decodeMultiAsync(e,!1)},e.prototype.decodeMultiAsync=function(e,t){return function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),o=[];return r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r;function a(e){i[e]&&(r[e]=function(t){return new Promise((function(n,r){o.push([e,t,n,r])>1||s(e,t)}))})}function s(e,t){try{(n=i[e](t)).value instanceof gn?Promise.resolve(n.value.v).then(c,u):l(o[0][2],n)}catch(e){l(o[0][3],e)}var n}function c(e){s("next",e)}function u(e){s("throw",e)}function l(e,t){e(t),o.shift(),o.length&&s(o[0][0],o[0][1])}}(this,arguments,(function(){var n,r,i,o,a,s,c,u,l;return mn(this,(function(h){switch(h.label){case 0:n=t,r=-1,h.label=1;case 1:h.trys.push([1,13,14,19]),i=vn(e),h.label=2;case 2:return[4,gn(i.next())];case 3:if((o=h.sent()).done)return[3,12];if(a=o.value,t&&0===r)throw this.createExtraByteError(this.totalPos);this.appendBuffer(a),n&&(r=this.readArraySize(),n=!1,this.complete()),h.label=4;case 4:h.trys.push([4,9,,10]),h.label=5;case 5:return[4,gn(this.doDecodeSync())];case 6:return[4,h.sent()];case 7:return h.sent(),0==--r?[3,8]:[3,5];case 8:return[3,10];case 9:if(!((s=h.sent())instanceof _n))throw s;return[3,10];case 10:this.totalPos+=this.pos,h.label=11;case 11:return[3,2];case 12:return[3,19];case 13:return c=h.sent(),u={error:c},[3,19];case 14:return h.trys.push([14,,17,18]),o&&!o.done&&(l=i.return)?[4,gn(l.call(i))]:[3,16];case 15:h.sent(),h.label=16;case 16:return[3,18];case 17:if(u)throw u.error;return[7];case 18:return[7];case 19:return[2]}}))}))},e.prototype.doDecodeSync=function(){e:for(;;){var e=this.readHeadByte(),t=void 0;if(e>=224)t=e-256;else if(e<192)if(e<128)t=e;else if(e<144){if(0!=(r=e-128)){this.pushMapState(r),this.complete();continue e}t={}}else if(e<160){if(0!=(r=e-144)){this.pushArrayState(r),this.complete();continue e}t=[]}else{var n=e-160;t=this.decodeUtf8String(n,0)}else if(192===e)t=null;else if(194===e)t=!1;else if(195===e)t=!0;else if(202===e)t=this.readF32();else if(203===e)t=this.readF64();else if(204===e)t=this.readU8();else if(205===e)t=this.readU16();else if(206===e)t=this.readU32();else if(207===e)t=this.readU64();else if(208===e)t=this.readI8();else if(209===e)t=this.readI16();else if(210===e)t=this.readI32();else if(211===e)t=this.readI64();else if(217===e)n=this.lookU8(),t=this.decodeUtf8String(n,1);else if(218===e)n=this.lookU16(),t=this.decodeUtf8String(n,2);else if(219===e)n=this.lookU32(),t=this.decodeUtf8String(n,4);else if(220===e){if(0!==(r=this.readU16())){this.pushArrayState(r),this.complete();continue e}t=[]}else if(221===e){if(0!==(r=this.readU32())){this.pushArrayState(r),this.complete();continue e}t=[]}else if(222===e){if(0!==(r=this.readU16())){this.pushMapState(r),this.complete();continue e}t={}}else if(223===e){if(0!==(r=this.readU32())){this.pushMapState(r),this.complete();continue e}t={}}else if(196===e){var r=this.lookU8();t=this.decodeBinary(r,1)}else if(197===e)r=this.lookU16(),t=this.decodeBinary(r,2);else if(198===e)r=this.lookU32(),t=this.decodeBinary(r,4);else if(212===e)t=this.decodeExtension(1,0);else if(213===e)t=this.decodeExtension(2,0);else if(214===e)t=this.decodeExtension(4,0);else if(215===e)t=this.decodeExtension(8,0);else if(216===e)t=this.decodeExtension(16,0);else if(199===e)r=this.lookU8(),t=this.decodeExtension(r,1);else if(200===e)r=this.lookU16(),t=this.decodeExtension(r,2);else{if(201!==e)throw new ln("Unrecognized type byte: ".concat(dn(e)));r=this.lookU32(),t=this.decodeExtension(r,4)}this.complete();for(var i=this.stack;i.length>0;){var o=i[i.length-1];if(0===o.type){if(o.array[o.position]=t,o.position++,o.position!==o.size)continue e;i.pop(),t=o.array}else{if(1===o.type){if(void 0,"string"!=(a=typeof t)&&"number"!==a)throw new ln("The type of key must be string or number but "+typeof t);if("__proto__"===t)throw new ln("The key __proto__ is not allowed");o.key=t,o.type=2;continue e}if(o.map[o.key]=t,o.readCount++,o.readCount!==o.size){o.key=null,o.type=1;continue e}i.pop(),t=o.map}}return t}var a},e.prototype.readHeadByte=function(){return-1===this.headByte&&(this.headByte=this.readU8()),this.headByte},e.prototype.complete=function(){this.headByte=-1},e.prototype.readArraySize=function(){var e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:if(e<160)return e-144;throw new ln("Unrecognized array type byte: ".concat(dn(e)))}},e.prototype.pushMapState=function(e){if(e>this.maxMapLength)throw new ln("Max length exceeded: map length (".concat(e,") > maxMapLengthLength (").concat(this.maxMapLength,")"));this.stack.push({type:1,size:e,key:null,readCount:0,map:{}})},e.prototype.pushArrayState=function(e){if(e>this.maxArrayLength)throw new ln("Max length exceeded: array length (".concat(e,") > maxArrayLength (").concat(this.maxArrayLength,")"));this.stack.push({type:0,size:e,array:new Array(e),position:0})},e.prototype.decodeUtf8String=function(e,t){var n;if(e>this.maxStrLength)throw new ln("Max length exceeded: UTF-8 byte length (".concat(e,") > maxStrLength (").concat(this.maxStrLength,")"));if(this.bytes.byteLength<this.pos+t+e)throw Sn;var r,i=this.pos+t;return r=this.stateIsMapKey()&&(null===(n=this.keyDecoder)||void 0===n?void 0:n.canBeCached(e))?this.keyDecoder.decode(this.bytes,i,e):e>sn?function(e,t,n){var r=e.subarray(t,t+n);return an.decode(r)}(this.bytes,i,e):rn(this.bytes,i,e),this.pos+=t+e,r},e.prototype.stateIsMapKey=function(){return this.stack.length>0&&1===this.stack[this.stack.length-1].type},e.prototype.decodeBinary=function(e,t){if(e>this.maxBinLength)throw new ln("Max length exceeded: bin length (".concat(e,") > maxBinLength (").concat(this.maxBinLength,")"));if(!this.hasRemaining(e+t))throw Sn;var n=this.pos+t,r=this.bytes.subarray(n,n+e);return this.pos+=t+e,r},e.prototype.decodeExtension=function(e,t){if(e>this.maxExtLength)throw new ln("Max length exceeded: ext length (".concat(e,") > maxExtLength (").concat(this.maxExtLength,")"));var n=this.view.getInt8(this.pos+t),r=this.decodeBinary(e,t+1);return this.extensionCodec.decode(r,n,this.context)},e.prototype.lookU8=function(){return this.view.getUint8(this.pos)},e.prototype.lookU16=function(){return this.view.getUint16(this.pos)},e.prototype.lookU32=function(){return this.view.getUint32(this.pos)},e.prototype.readU8=function(){var e=this.view.getUint8(this.pos);return this.pos++,e},e.prototype.readI8=function(){var e=this.view.getInt8(this.pos);return this.pos++,e},e.prototype.readU16=function(){var e=this.view.getUint16(this.pos);return this.pos+=2,e},e.prototype.readI16=function(){var e=this.view.getInt16(this.pos);return this.pos+=2,e},e.prototype.readU32=function(){var e=this.view.getUint32(this.pos);return this.pos+=4,e},e.prototype.readI32=function(){var e=this.view.getInt32(this.pos);return this.pos+=4,e},e.prototype.readU64=function(){var e,t,n=(e=this.view,t=this.pos,4294967296*e.getUint32(t)+e.getUint32(t+4));return this.pos+=8,n},e.prototype.readI64=function(){var e=Xt(this.view,this.pos);return this.pos+=8,e},e.prototype.readF32=function(){var e=this.view.getFloat32(this.pos);return this.pos+=4,e},e.prototype.readF64=function(){var e=this.view.getFloat64(this.pos);return this.pos+=8,e}}();class En{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=e=>{const t=[],n=e.byteLength,r=Math.ceil(n/this.chunkedMTU);let i=0,o=0;for(;o<n;){const a=Math.min(n,o+this.chunkedMTU),s=e.slice(o,a),c={__peerData:this._dataCount,n:i,data:s,total:r};t.push(c),o=a,i++}return this._dataCount++,t}}}const Cn=Vt.default||Vt,Tn=new class{isWebRTCSupported(){return"undefined"!=typeof RTCPeerConnection}isBrowserSupported(){const e=this.getBrowser(),t=this.getVersion();return!!this.supportedBrowsers.includes(e)&&("chrome"===e?t>=this.minChromeVersion:"firefox"===e?t>=this.minFirefoxVersion:"safari"===e&&!this.isIOS&&t>=this.minSafariVersion)}getBrowser(){return Cn.browserDetails.browser}getVersion(){return Cn.browserDetails.version||0}isUnifiedPlanSupported(){const e=this.getBrowser(),t=Cn.browserDetails.version||0;if("chrome"===e&&t<this.minChromeVersion)return!1;if("firefox"===e&&t>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let n,r=!1;try{n=new RTCPeerConnection,n.addTransceiver("audio"),r=!0}catch(e){}finally{n&&n.close()}return r}toString(){return`Supports:\n    browser:${this.getBrowser()}\n    version:${this.getVersion()}\n    isIOS:${this.isIOS}\n    isWebRTCSupported:${this.isWebRTCSupported()}\n    isBrowserSupported:${this.isBrowserSupported()}\n    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS="undefined"!=typeof navigator&&["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},On=e=>!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(e),In=()=>Math.random().toString(36).slice(2),xn={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"},Rn=new class extends En{noop(){}blobToArrayBuffer(e,t){const n=new FileReader;return n.onload=function(e){e.target&&t(e.target.result)},n.readAsArrayBuffer(e),n}binaryStringToArrayBuffer(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=255&e.charCodeAt(n);return t.buffer}isSecure(){return"https:"===location.protocol}constructor(...e){super(...e),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=xn,this.browser=Tn.getBrowser(),this.browserVersion=Tn.getVersion(),this.pack=He,this.unpack=Fe,this.supports=function(){const e={browser:Tn.isBrowserSupported(),webRTC:Tn.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!e.webRTC)return e;let t;try{let n;t=new RTCPeerConnection(xn),e.audioVideo=!0;try{n=t.createDataChannel("_PEERJSTEST",{ordered:!0}),e.data=!0,e.reliable=!!n.ordered;try{n.binaryType="blob",e.binaryBlob=!Tn.isIOS}catch(e){}}catch(e){}finally{n&&n.close()}}catch(e){}finally{t&&t.close()}return e}(),this.validateId=On,this.randomToken=In}};var Ln,jn;(jn=Ln||(Ln={}))[jn.Disabled=0]="Disabled",jn[jn.Errors=1]="Errors",jn[jn.Warnings=2]="Warnings",jn[jn.All=3]="All";var An,Mn=new class{get logLevel(){return this._logLevel}set logLevel(e){this._logLevel=e}log(...e){this._logLevel>=3&&this._print(3,...e)}warn(...e){this._logLevel>=2&&this._print(2,...e)}error(...e){this._logLevel>=1&&this._print(1,...e)}setLogFunction(e){this._print=e}_print(e,...t){const n=["PeerJS: ",...t];for(const e in n)n[e]instanceof Error&&(n[e]="("+n[e].name+") "+n[e].message);e>=3?console.log(...n):e>=2?console.warn("WARNING",...n):e>=1&&console.error("ERROR",...n)}constructor(){this._logLevel=0}},Dn=Object.prototype.hasOwnProperty,Bn="~";function Nn(){}function Un(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function Gn(e,t,n,r,i){if("function"!=typeof n)throw new TypeError("The listener must be a function");var o=new Un(n,r||e,i),a=Bn?Bn+t:t;return e._events[a]?e._events[a].fn?e._events[a]=[e._events[a],o]:e._events[a].push(o):(e._events[a]=o,e._eventsCount++),e}function Fn(e,t){0==--e._eventsCount?e._events=new Nn:delete e._events[t]}function Hn(){this._events=new Nn,this._eventsCount=0}Object.create&&(Nn.prototype=Object.create(null),(new Nn).__proto__||(Bn=!1)),Hn.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)Dn.call(e,t)&&n.push(Bn?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},Hn.prototype.listeners=function(e){var t=Bn?Bn+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,i=n.length,o=new Array(i);r<i;r++)o[r]=n[r].fn;return o},Hn.prototype.listenerCount=function(e){var t=Bn?Bn+e:e,n=this._events[t];return n?n.fn?1:n.length:0},Hn.prototype.emit=function(e,t,n,r,i,o){var a=Bn?Bn+e:e;if(!this._events[a])return!1;var s,c,u=this._events[a],l=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),l){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,n),!0;case 4:return u.fn.call(u.context,t,n,r),!0;case 5:return u.fn.call(u.context,t,n,r,i),!0;case 6:return u.fn.call(u.context,t,n,r,i,o),!0}for(c=1,s=new Array(l-1);c<l;c++)s[c-1]=arguments[c];u.fn.apply(u.context,s)}else{var h,p=u.length;for(c=0;c<p;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),l){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,n);break;case 4:u[c].fn.call(u[c].context,t,n,r);break;default:if(!s)for(h=1,s=new Array(l-1);h<l;h++)s[h-1]=arguments[h];u[c].fn.apply(u[c].context,s)}}return!0},Hn.prototype.on=function(e,t,n){return Gn(this,e,t,n,!1)},Hn.prototype.once=function(e,t,n){return Gn(this,e,t,n,!0)},Hn.prototype.removeListener=function(e,t,n,r){var i=Bn?Bn+e:e;if(!this._events[i])return this;if(!t)return Fn(this,i),this;var o=this._events[i];if(o.fn)o.fn!==t||r&&!o.once||n&&o.context!==n||Fn(this,i);else{for(var a=0,s=[],c=o.length;a<c;a++)(o[a].fn!==t||r&&!o[a].once||n&&o[a].context!==n)&&s.push(o[a]);s.length?this._events[i]=1===s.length?s[0]:s:Fn(this,i)}return this},Hn.prototype.removeAllListeners=function(e){var t;return e?(t=Bn?Bn+e:e,this._events[t]&&Fn(this,t)):(this._events=new Nn,this._eventsCount=0),this},Hn.prototype.off=Hn.prototype.removeListener,Hn.prototype.addListener=Hn.prototype.on,Hn.prefixed=Bn,Hn.EventEmitter=Hn,An=Hn;var zn,Jn,Vn,Wn,Yn,$n,Kn,qn,Xn,Zn,Qn,er,tr,nr,rr,ir={};kn(ir,"ConnectionType",(()=>zn)),kn(ir,"PeerErrorType",(()=>Vn)),kn(ir,"BaseConnectionErrorType",(()=>Yn)),kn(ir,"DataConnectionErrorType",(()=>Kn)),kn(ir,"SerializationType",(()=>Xn)),kn(ir,"SocketEventType",(()=>Qn)),kn(ir,"ServerMessageType",(()=>tr)),(Jn=zn||(zn={})).Data="data",Jn.Media="media",(Wn=Vn||(Vn={})).BrowserIncompatible="browser-incompatible",Wn.Disconnected="disconnected",Wn.InvalidID="invalid-id",Wn.InvalidKey="invalid-key",Wn.Network="network",Wn.PeerUnavailable="peer-unavailable",Wn.SslUnavailable="ssl-unavailable",Wn.ServerError="server-error",Wn.SocketError="socket-error",Wn.SocketClosed="socket-closed",Wn.UnavailableID="unavailable-id",Wn.WebRTC="webrtc",($n=Yn||(Yn={})).NegotiationFailed="negotiation-failed",$n.ConnectionClosed="connection-closed",(qn=Kn||(Kn={})).NotOpenYet="not-open-yet",qn.MessageToBig="message-too-big",(Zn=Xn||(Xn={})).Binary="binary",Zn.BinaryUTF8="binary-utf8",Zn.JSON="json",Zn.None="raw",(er=Qn||(Qn={})).Message="message",er.Disconnected="disconnected",er.Error="error",er.Close="close",(nr=tr||(tr={})).Heartbeat="HEARTBEAT",nr.Candidate="CANDIDATE",nr.Offer="OFFER",nr.Answer="ANSWER",nr.Open="OPEN",nr.Error="ERROR",nr.IdTaken="ID-TAKEN",nr.InvalidKey="INVALID-KEY",nr.Leave="LEAVE",nr.Expire="EXPIRE",rr=JSON.parse('{"name":"peerjs","version":"1.5.4","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz Stckler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","Soren Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","browser-minified-msgpack":"dist/serializer.msgpack.mjs","types":"dist/types.d.ts","engines":{"node":">= 14"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15"},"source":"lib/global.ts"},"browser-minified-msgpack":{"context":"browser","outputFormat":"esmodule","isLibrary":true,"optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 102, safari >= 15"},"source":"lib/dataconnection/StreamConnection/MsgPack.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit && tsc -p e2e/tsconfig.json --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"jest","test:watch":"jest --watch","coverage":"jest --coverage --collectCoverageFrom=\\"./lib/**\\"","format":"prettier --write .","format:check":"prettier --check .","semantic-release":"semantic-release","e2e":"wdio run e2e/wdio.local.conf.ts","e2e:bstack":"wdio run e2e/wdio.bstack.conf.ts"},"devDependencies":{"@parcel/config-default":"^2.9.3","@parcel/packager-ts":"^2.9.3","@parcel/transformer-typescript-tsc":"^2.9.3","@parcel/transformer-typescript-types":"^2.9.3","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@swc/core":"^1.3.27","@swc/jest":"^0.2.24","@types/jasmine":"^4.3.4","@wdio/browserstack-service":"^8.11.2","@wdio/cli":"^8.11.2","@wdio/globals":"^8.11.2","@wdio/jasmine-framework":"^8.11.2","@wdio/local-runner":"^8.11.2","@wdio/spec-reporter":"^8.11.2","@wdio/types":"^8.10.4","http-server":"^14.1.1","jest":"^29.3.1","jest-environment-jsdom":"^29.3.1","mock-socket":"^9.0.0","parcel":"^2.9.3","prettier":"^3.0.0","semantic-release":"^21.0.0","ts-node":"^10.9.1","typescript":"^5.0.0","wdio-geckodriver-service":"^5.0.1"},"dependencies":{"@msgpack/msgpack":"^2.8.0","eventemitter3":"^4.0.7","peerjs-js-binarypack":"^2.1.0","webrtc-adapter":"^9.0.0"},"alias":{"process":false,"buffer":false}}');class or extends An.EventEmitter{constructor(e,t,n,r,i,o=5e3){super(),this.pingInterval=o,this._disconnected=!0,this._messagesQueue=[];const a=e?"wss://":"ws://";this._baseUrl=a+t+":"+n+r+"peerjs?key="+i}start(e,t){this._id=e;const n=`${this._baseUrl}&id=${e}&token=${t}`;!this._socket&&this._disconnected&&(this._socket=new WebSocket(n+"&version="+rr.version),this._disconnected=!1,this._socket.onmessage=e=>{let t;try{t=JSON.parse(e.data),Mn.log("Server message received:",t)}catch(t){return void Mn.log("Invalid server message",e.data)}this.emit(Qn.Message,t)},this._socket.onclose=e=>{this._disconnected||(Mn.log("Socket closed.",e),this._cleanup(),this._disconnected=!0,this.emit(Qn.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),Mn.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout((()=>{this._sendHeartbeat()}),this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen())return void Mn.log("Cannot send heartbeat, because socket closed");const e=JSON.stringify({type:tr.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&1===this._socket.readyState}_sendQueuedMessages(){const e=[...this._messagesQueue];this._messagesQueue=[];for(const t of e)this.send(t)}send(e){if(this._disconnected)return;if(!this._id)return void this._messagesQueue.push(e);if(!e.type)return void this.emit(Qn.Error,"Invalid message");if(!this._wsOpen())return;const t=JSON.stringify(e);this._socket.send(t)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class ar{constructor(e){this.connection=e}startConnection(e){const t=this._startPeerConnection();if(this.connection.peerConnection=t,this.connection.type===zn.Media&&e._stream&&this._addTracksToConnection(e._stream,t),e.originator){const n=this.connection,r={ordered:!!e.reliable},i=t.createDataChannel(n.label,r);n._initializeDataChannel(i),this._makeOffer()}else this.handleSDP("OFFER",e.sdp)}_startPeerConnection(){Mn.log("Creating RTCPeerConnection.");const e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e}_setupListeners(e){const t=this.connection.peer,n=this.connection.connectionId,r=this.connection.type,i=this.connection.provider;Mn.log("Listening for ICE candidates."),e.onicecandidate=e=>{e.candidate&&e.candidate.candidate&&(Mn.log(`Received ICE candidates for ${t}:`,e.candidate),i.socket.send({type:tr.Candidate,payload:{candidate:e.candidate,type:r,connectionId:n},dst:t}))},e.oniceconnectionstatechange=()=>{switch(e.iceConnectionState){case"failed":Mn.log("iceConnectionState is failed, closing connections to "+t),this.connection.emitError(Yn.NegotiationFailed,"Negotiation of connection to "+t+" failed."),this.connection.close();break;case"closed":Mn.log("iceConnectionState is closed, closing connections to "+t),this.connection.emitError(Yn.ConnectionClosed,"Connection to "+t+" closed."),this.connection.close();break;case"disconnected":Mn.log("iceConnectionState changed to disconnected on the connection with "+t);break;case"completed":e.onicecandidate=()=>{}}this.connection.emit("iceStateChanged",e.iceConnectionState)},Mn.log("Listening for data channel"),e.ondatachannel=e=>{Mn.log("Received data channel");const r=e.channel;i.getConnection(t,n)._initializeDataChannel(r)},Mn.log("Listening for remote stream"),e.ontrack=e=>{Mn.log("Received remote stream");const r=e.streams[0],o=i.getConnection(t,n);if(o.type===zn.Media){const e=o;this._addStreamToMediaConnection(r,e)}}}cleanup(){Mn.log("Cleaning up PeerConnection to "+this.connection.peer);const e=this.connection.peerConnection;if(!e)return;this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=()=>{};const t="closed"!==e.signalingState;let n=!1;const r=this.connection.dataChannel;r&&(n=!!r.readyState&&"closed"!==r.readyState),(t||n)&&e.close()}async _makeOffer(){const e=this.connection.peerConnection,t=this.connection.provider;try{const n=await e.createOffer(this.connection.options.constraints);Mn.log("Created offer."),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp);try{await e.setLocalDescription(n),Mn.log("Set localDescription:",n,`for:${this.connection.peer}`);let r={sdp:n,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===zn.Data){const e=this.connection;r={...r,label:e.label,reliable:e.reliable,serialization:e.serialization}}t.socket.send({type:tr.Offer,payload:r,dst:this.connection.peer})}catch(e){"OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"!=e&&(t.emitError(Vn.WebRTC,e),Mn.log("Failed to setLocalDescription, ",e))}}catch(e){t.emitError(Vn.WebRTC,e),Mn.log("Failed to createOffer, ",e)}}async _makeAnswer(){const e=this.connection.peerConnection,t=this.connection.provider;try{const n=await e.createAnswer();Mn.log("Created answer."),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp);try{await e.setLocalDescription(n),Mn.log("Set localDescription:",n,`for:${this.connection.peer}`),t.socket.send({type:tr.Answer,payload:{sdp:n,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(e){t.emitError(Vn.WebRTC,e),Mn.log("Failed to setLocalDescription, ",e)}}catch(e){t.emitError(Vn.WebRTC,e),Mn.log("Failed to create answer, ",e)}}async handleSDP(e,t){t=new RTCSessionDescription(t);const n=this.connection.peerConnection,r=this.connection.provider;Mn.log("Setting remote description",t);const i=this;try{await n.setRemoteDescription(t),Mn.log(`Set remoteDescription:${e} for:${this.connection.peer}`),"OFFER"===e&&await i._makeAnswer()}catch(e){r.emitError(Vn.WebRTC,e),Mn.log("Failed to setRemoteDescription, ",e)}}async handleCandidate(e){Mn.log("handleCandidate:",e);try{await this.connection.peerConnection.addIceCandidate(e),Mn.log(`Added ICE candidate for:${this.connection.peer}`)}catch(e){this.connection.provider.emitError(Vn.WebRTC,e),Mn.log("Failed to handleCandidate, ",e)}}_addTracksToConnection(e,t){if(Mn.log(`add tracks from stream ${e.id} to peer connection`),!t.addTrack)return Mn.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach((n=>{t.addTrack(n,e)}))}_addStreamToMediaConnection(e,t){Mn.log(`add stream ${e.id} to media connection ${t.connectionId}`),t.addStream(e)}}class sr extends An.EventEmitter{emitError(e,t){Mn.error("Error:",t),this.emit("error",new cr(`${e}`,t))}}class cr extends Error{constructor(e,t){"string"==typeof t?super(t):(super(),Object.assign(this,t)),this.type=e}}class ur extends sr{get open(){return this._open}constructor(e,t,n){super(),this.peer=e,this.provider=t,this.options=n,this._open=!1,this.metadata=n.metadata}}class lr extends ur{static#e=this.ID_PREFIX="mc_";get type(){return zn.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(e,t,n){super(e,t,n),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||lr.ID_PREFIX+Rn.randomToken(),this._negotiator=new ar(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{Mn.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{Mn.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(e){Mn.log("Receiving stream",e),this._remoteStream=e,super.emit("stream",e)}handleMessage(e){const t=e.type,n=e.payload;switch(e.type){case tr.Answer:this._negotiator.handleSDP(t,n.sdp),this._open=!0;break;case tr.Candidate:this._negotiator.handleCandidate(n.candidate);break;default:Mn.warn(`Unrecognized message type:${t} from peer:${this.peer}`)}}answer(e,t={}){if(this._localStream)return void Mn.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");this._localStream=e,t&&t.sdpTransform&&(this.options.sdpTransform=t.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:e});const n=this.provider._getMessages(this.connectionId);for(const e of n)this.handleMessage(e);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}}class hr{constructor(e){this._options=e}_buildRequest(e){const t=this._options.secure?"https":"http",{host:n,port:r,path:i,key:o}=this._options,a=new URL(`${t}://${n}:${r}${i}${o}/${e}`);return a.searchParams.set("ts",`${Date.now()}${Math.random()}`),a.searchParams.set("version",rr.version),fetch(a.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{const e=await this._buildRequest("id");if(200!==e.status)throw new Error(`Error. Status:${e.status}`);return e.text()}catch(e){Mn.error("Error retrieving ID",e);let t="";throw"/"===this._options.path&&this._options.host!==Rn.CLOUD_HOST&&(t=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+t)}}async listAllPeers(){try{const e=await this._buildRequest("peers");if(200!==e.status){if(401===e.status){let e="";throw e=this._options.host===Rn.CLOUD_HOST?"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+e)}throw new Error(`Error. Status:${e.status}`)}return e.json()}catch(e){throw Mn.error("Error retrieving list peers",e),new Error("Could not get list peers from the server."+e)}}}class pr extends ur{static#e=this.ID_PREFIX="dc_";static#t=this.MAX_BUFFERED_AMOUNT=8388608;get type(){return zn.Data}constructor(e,t,n){super(e,t,n),this.connectionId=this.options.connectionId||pr.ID_PREFIX+In(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new ar(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{Mn.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=e=>{Mn.log(`DC#${this.connectionId} dc onmessage:`,e.data)},this.dataChannel.onclose=()=>{Mn.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(e){e?.flush?this.send({__peerData:{type:"close"}}):(this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close")))}send(e,t=!1){if(this.open)return this._send(e,t);this.emitError(Kn.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.")}async handleMessage(e){const t=e.payload;switch(e.type){case tr.Answer:await this._negotiator.handleSDP(e.type,t.sdp);break;case tr.Candidate:await this._negotiator.handleCandidate(t.candidate);break;default:Mn.warn("Unrecognized message type:",e.type,"from peer:",this.peer)}}}class fr extends pr{get bufferSize(){return this._bufferSize}_initializeDataChannel(e){super._initializeDataChannel(e),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",(e=>this._handleDataMessage(e)))}_bufferedSend(e){!this._buffering&&this._trySend(e)||(this._buffer.push(e),this._bufferSize=this._buffer.length)}_trySend(e){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>pr.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout((()=>{this._buffering=!1,this._tryBuffer()}),50),!1;try{this.dataChannel.send(e)}catch(e){return Mn.error(`DC#:${this.connectionId} Error when sending:`,e),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open)return;if(0===this._buffer.length)return;const e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(e){e?.flush?this.send({__peerData:{type:"close"}}):(this._buffer=[],this._bufferSize=0,super.close())}constructor(...e){super(...e),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class dr extends fr{close(e){super.close(e),this._chunkedData={}}constructor(e,t,n){super(e,t,n),this.chunker=new En,this.serialization=Xn.Binary,this._chunkedData={}}_handleDataMessage({data:e}){const t=Fe(e),n=t.__peerData;if(n)return"close"===n.type?void this.close():void this._handleChunk(t);this.emit("data",t)}_handleChunk(e){const t=e.__peerData,n=this._chunkedData[t]||{data:[],count:0,total:e.total};if(n.data[e.n]=new Uint8Array(e.data),n.count++,this._chunkedData[t]=n,n.total===n.count){delete this._chunkedData[t];const e=function(e){let t=0;for(const n of e)t+=n.byteLength;const n=new Uint8Array(t);let r=0;for(const t of e)n.set(t,r),r+=t.byteLength;return n}(n.data);this._handleDataMessage({data:e})}}_send(e,t){const n=He(e);if(n instanceof Promise)return this._send_blob(n);!t&&n.byteLength>this.chunker.chunkedMTU?this._sendChunks(n):this._bufferedSend(n)}async _send_blob(e){const t=await e;t.byteLength>this.chunker.chunkedMTU?this._sendChunks(t):this._bufferedSend(t)}_sendChunks(e){const t=this.chunker.chunk(e);Mn.log(`DC#${this.connectionId} Try to send ${t.length} chunks...`);for(const e of t)this.send(e,!0)}}class yr extends fr{_handleDataMessage({data:e}){super.emit("data",e)}_send(e,t){this._bufferedSend(e)}constructor(...e){super(...e),this.serialization=Xn.None}}class mr extends fr{_handleDataMessage({data:e}){const t=this.parse(this.decoder.decode(e)),n=t.__peerData;n&&"close"===n.type?this.close():this.emit("data",t)}_send(e,t){const n=this.encoder.encode(this.stringify(e));n.byteLength>=Rn.chunkedMTU?this.emitError(Kn.MessageToBig,"Message too big for JSON channel"):this._bufferedSend(n)}constructor(...e){super(...e),this.serialization=Xn.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}class vr extends sr{static#e=this.DEFAULT_KEY="peerjs";get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){const e=Object.create(null);for(const[t,n]of this._connections)e[t]=n;return e}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(e,t){let n;super(),this._serializers={raw:yr,json:mr,binary:dr,"binary-utf8":dr,default:dr},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map,e&&e.constructor==Object?t=e:e&&(n=e.toString()),t={debug:0,host:Rn.CLOUD_HOST,port:Rn.CLOUD_PORT,path:"/",key:vr.DEFAULT_KEY,token:Rn.randomToken(),config:Rn.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...t},this._options=t,this._serializers={...this._serializers,...this.options.serializers},"/"===this._options.host&&(this._options.host=window.location.hostname),this._options.path&&("/"!==this._options.path[0]&&(this._options.path="/"+this._options.path),"/"!==this._options.path[this._options.path.length-1]&&(this._options.path+="/")),void 0===this._options.secure&&this._options.host!==Rn.CLOUD_HOST?this._options.secure=Rn.isSecure():this._options.host==Rn.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&Mn.setLogFunction(this._options.logFunction),Mn.logLevel=this._options.debug||0,this._api=new hr(t),this._socket=this._createServerConnection(),Rn.supports.audioVideo||Rn.supports.data?!n||Rn.validateId(n)?n?this._initialize(n):this._api.retrieveId().then((e=>this._initialize(e))).catch((e=>this._abort(Vn.ServerError,e))):this._delayedAbort(Vn.InvalidID,`ID "${n}" is invalid`):this._delayedAbort(Vn.BrowserIncompatible,"The current browser does not support WebRTC")}_createServerConnection(){const e=new or(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return e.on(Qn.Message,(e=>{this._handleMessage(e)})),e.on(Qn.Error,(e=>{this._abort(Vn.SocketError,e)})),e.on(Qn.Disconnected,(()=>{this.disconnected||(this.emitError(Vn.Network,"Lost connection to server."),this.disconnect())})),e.on(Qn.Close,(()=>{this.disconnected||this._abort(Vn.SocketClosed,"Underlying socket is already closed.")})),e}_initialize(e){this._id=e,this.socket.start(e,this._options.token)}_handleMessage(e){const t=e.type,n=e.payload,r=e.src;switch(t){case tr.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case tr.Error:this._abort(Vn.ServerError,n.msg);break;case tr.IdTaken:this._abort(Vn.UnavailableID,`ID "${this.id}" is taken`);break;case tr.InvalidKey:this._abort(Vn.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case tr.Leave:Mn.log(`Received leave message from ${r}`),this._cleanupPeer(r),this._connections.delete(r);break;case tr.Expire:this.emitError(Vn.PeerUnavailable,`Could not connect to peer ${r}`);break;case tr.Offer:{const e=n.connectionId;let t=this.getConnection(r,e);if(t&&(t.close(),Mn.warn(`Offer received for existing Connection ID:${e}`)),n.type===zn.Media){const i=new lr(r,this,{connectionId:e,_payload:n,metadata:n.metadata});t=i,this._addConnection(r,t),this.emit("call",i)}else{if(n.type!==zn.Data)return void Mn.warn(`Received malformed connection type:${n.type}`);{const i=new this._serializers[n.serialization](r,this,{connectionId:e,_payload:n,metadata:n.metadata,label:n.label,serialization:n.serialization,reliable:n.reliable});t=i,this._addConnection(r,t),this.emit("connection",i)}}const i=this._getMessages(e);for(const e of i)t.handleMessage(e);break}default:{if(!n)return void Mn.warn(`You received a malformed message from ${r} of type ${t}`);const i=n.connectionId,o=this.getConnection(r,i);o&&o.peerConnection?o.handleMessage(e):i?this._storeMessage(i,e):Mn.warn("You received an unrecognized message:",e);break}}}_storeMessage(e,t){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(t)}_getMessages(e){const t=this._lostMessages.get(e);return t?(this._lostMessages.delete(e),t):[]}connect(e,t={}){if(t={serialization:"default",...t},this.disconnected)return Mn.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),void this.emitError(Vn.Disconnected,"Cannot connect to new Peer after disconnecting from server.");const n=new this._serializers[t.serialization](e,this,t);return this._addConnection(e,n),n}call(e,t,n={}){if(this.disconnected)return Mn.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),void this.emitError(Vn.Disconnected,"Cannot connect to new Peer after disconnecting from server.");if(!t)return void Mn.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");const r=new lr(e,this,{...n,_stream:t});return this._addConnection(e,r),r}_addConnection(e,t){Mn.log(`add connection ${t.type}:${t.connectionId} to peerId:${e}`),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(t)}_removeConnection(e){const t=this._connections.get(e.peer);if(t){const n=t.indexOf(e);-1!==n&&t.splice(n,1)}this._lostMessages.delete(e.connectionId)}getConnection(e,t){const n=this._connections.get(e);if(!n)return null;for(const e of n)if(e.connectionId===t)return e;return null}_delayedAbort(e,t){setTimeout((()=>{this._abort(e,t)}),0)}_abort(e,t){Mn.error("Aborting!"),this.emitError(e,t),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(Mn.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(const e of this._connections.keys())this._cleanupPeer(e),this._connections.delete(e);this.socket.removeAllListeners()}_cleanupPeer(e){const t=this._connections.get(e);if(t)for(const e of t)e.close()}disconnect(){if(this.disconnected)return;const e=this.id;Mn.log(`Disconnect peer with ID:${e}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}reconnect(){if(this.disconnected&&!this.destroyed)Mn.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(this.disconnected||this.open)throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`);Mn.error("In a hurry? We're still trying to make the initial connection!")}}listAllPeers(e=e=>{}){this._api.listAllPeers().then((t=>e(t))).catch((e=>this._abort(Vn.ServerError,e)))}}var gr=vr;function br(e){return br="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},br(e)}function wr(){wr=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var o=t&&t.prototype instanceof v?t:v,a=Object.create(o.prototype),s=new x(r||[]);return i(a,"_invoke",{value:C(e,n,s)}),a}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var p="suspendedStart",f="suspendedYield",d="executing",y="completed",m={};function v(){}function g(){}function b(){}var w={};u(w,a,(function(){return this}));var _=Object.getPrototypeOf,S=_&&_(_(R([])));S&&S!==n&&r.call(S,a)&&(w=S);var P=b.prototype=v.prototype=Object.create(w);function k(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){function n(i,o,a,s){var c=h(e[i],e,o);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==br(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return n("throw",e,a,s)}))}s(c.arg)}var o;i(this,"_invoke",{value:function(e,r){function i(){return new t((function(t,i){n(e,r,t,i)}))}return o=o?o.then(i,i):i()}})}function C(t,n,r){var i=p;return function(o,a){if(i===d)throw Error("Generator is already running");if(i===y){if("throw"===o)throw a;return{value:e,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var c=T(s,r);if(c){if(c===m)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===p)throw i=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=d;var u=h(t,n,r);if("normal"===u.type){if(i=r.done?y:f,u.arg===m)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=y,r.method="throw",r.arg=u.arg)}}}function T(t,n){var r=n.method,i=t.iterator[r];if(i===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,T(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var o=h(i,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,m;var a=o.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function R(t){if(t||""===t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}throw new TypeError(br(t)+" is not iterable")}return g.prototype=b,i(P,"constructor",{value:b,configurable:!0}),i(b,"constructor",{value:g,configurable:!0}),g.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create(P),e},t.awrap=function(e){return{__await:e}},k(E.prototype),u(E.prototype,s,(function(){return this})),t.AsyncIterator=E,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new E(l(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},k(P),u(P,c,"Generator"),u(P,a,(function(){return this})),u(P,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=R,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(I),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return s.type="throw",s.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),I(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;I(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:R(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),m}},t}function _r(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function Sr(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){_r(o,r,i,a,s,"next",e)}function s(e){_r(o,r,i,a,s,"throw",e)}a(void 0)}))}}function Pr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,kr(r.key),r)}}function kr(e){var t=function(e){if("object"!=br(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=br(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==br(t)?t:t+""}var Er=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.peer=null,this.eventHandler=t,this.gameState=null,this.settings=null,this.ownedPlayers=[],this.connections=[]},t=[{key:"initPeer",value:(r=Sr(wr().mark((function e(){var t=this;return wr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.peer=new gr,e.abrupt("return",new Promise((function(e,n){t.peer.on("open",(function(t){console.log("Peer ID:",t),e(t)})),t.peer.on("error",(function(e){console.error("Peer error:",e),t.eventHandler.handlePeerError(e),n(e)}))})));case 2:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"initializeGameState",value:(n=Sr(wr().mark((function e(){var t;return wr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Se,e.next=3,t.loadDefaultBoard();case 3:this.gameState=new le(t.board),console.log("GameState initialized",this.gameState);case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"addPlayer",value:function(e){this.gameState.players.some((function(t){return t.playerId===e.playerId}))?console.log("Player already exists:",e):(e.setTurnsTaken(this.gameState.getTurnNumber()-1),this.gameState.addPlayer(e),e.peerId===this.peer.id&&this.ownedPlayers.push(e),this.eventHandler.updateGameState())}},{key:"removePlayer",value:function(e){this.ownedPlayers=this.ownedPlayers.filter((function(t){return t.playerId!==e})),this.gameState.removePlayer(e),this.eventHandler.updateGameState()}},{key:"broadcastGameState",value:function(){}}],t&&Pr(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r}();function Cr(e){return Cr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Cr(e)}function Tr(){Tr=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var o=t&&t.prototype instanceof v?t:v,a=Object.create(o.prototype),s=new x(r||[]);return i(a,"_invoke",{value:C(e,n,s)}),a}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var p="suspendedStart",f="suspendedYield",d="executing",y="completed",m={};function v(){}function g(){}function b(){}var w={};u(w,a,(function(){return this}));var _=Object.getPrototypeOf,S=_&&_(_(R([])));S&&S!==n&&r.call(S,a)&&(w=S);var P=b.prototype=v.prototype=Object.create(w);function k(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){function n(i,o,a,s){var c=h(e[i],e,o);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==Cr(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return n("throw",e,a,s)}))}s(c.arg)}var o;i(this,"_invoke",{value:function(e,r){function i(){return new t((function(t,i){n(e,r,t,i)}))}return o=o?o.then(i,i):i()}})}function C(t,n,r){var i=p;return function(o,a){if(i===d)throw Error("Generator is already running");if(i===y){if("throw"===o)throw a;return{value:e,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var c=T(s,r);if(c){if(c===m)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===p)throw i=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=d;var u=h(t,n,r);if("normal"===u.type){if(i=r.done?y:f,u.arg===m)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=y,r.method="throw",r.arg=u.arg)}}}function T(t,n){var r=n.method,i=t.iterator[r];if(i===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,T(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var o=h(i,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,m;var a=o.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function R(t){if(t||""===t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}throw new TypeError(Cr(t)+" is not iterable")}return g.prototype=b,i(P,"constructor",{value:b,configurable:!0}),i(b,"constructor",{value:g,configurable:!0}),g.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create(P),e},t.awrap=function(e){return{__await:e}},k(E.prototype),u(E.prototype,s,(function(){return this})),t.AsyncIterator=E,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new E(l(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},k(P),u(P,c,"Generator"),u(P,a,(function(){return this})),u(P,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=R,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(I),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return s.type="throw",s.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),I(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;I(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:R(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),m}},t}function Or(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function Ir(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,xr(r.key),r)}}function xr(e){var t=function(e){if("object"!=Cr(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Cr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Cr(t)?t:t+""}function Rr(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Rr=function(){return!!e})()}function Lr(e){return Lr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Lr(e)}function jr(e,t){return jr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},jr(e,t)}var Ar=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t,n){return t=Lr(t),function(e,t){if(t&&("object"==Cr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Rr()?Reflect.construct(t,n||[],Lr(e).constructor):t.apply(e,n))}(this,t,[n])).originalName=e,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&jr(e,t)}(t,e),n=t,r=[{key:"init",value:(i=Tr().mark((function e(){var t,n,r=this;return Tr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initPeer();case 2:return t=e.sent,console.log("Host ID:",t),this.hostId=t,this.eventHandler.initManagers(t,t),e.next=8,this.initializeGameState();case 8:this.setupUI(),n=new j(t,this.originalName,!0),this.addPlayer(n),this.peer.on("connection",(function(e){return r.handleConnection(e)}));case 12:case"end":return e.stop()}}),e,this)})),o=function(){var e=this,t=arguments;return new Promise((function(n,r){var o=i.apply(e,t);function a(e){Or(o,n,r,a,s,"next",e)}function s(e){Or(o,n,r,a,s,"throw",e)}a(void 0)}))},function(){return o.apply(this,arguments)})},{key:"setupUI",value:function(){console.log("Setting up UI"),this.eventHandler.displayInviteCode(this.hostId),this.eventHandler.showPage("lobbyPage")}},{key:"handleConnection",value:function(e){var t=this;console.log("New connection from",e.peer),this.connections.push(e),this.sendConnectionPackage(e),e.on("data",(function(n){return t.handleData(e,n)})),e.on("close",(function(){return t.handleDisconnection(e.peer)}))}},{key:"sendGameState",value:function(e){if(this.gameState){var t=this.gameState.toJSON();e.send({type:"gameState",gameState:t})}}},{key:"sendConnectionPackage",value:function(e){if(this.gameState){var t=this.gameState.toJSON();e.send({type:"connectionPackage",gameState:t})}}},{key:"updateAndBroadcastGameState",value:function(e){var t=e.toJSON();this.gameState=le.fromJSON(t),this.broadcastGameState(),this.eventHandler.updateGameState()}},{key:"handleData",value:function(e,t){switch(t.type){case"proposeGameState":this.handleProposedGameState(e,t.gameState);break;case"join":this.handleJoin(e,t);break;case"nameChange":this.handleNameChange(t.playerId,t.newName);break;case"removePlayer":this.handleClientRemovePlayer(t.playerId);break;case"proposeAddPlayer":this.handleClientAddPlayer(e,t.player);break;default:console.log("Unknown data type:",t.type)}}},{key:"handleProposedGameState",value:function(e,t){var n=le.fromJSON(t);this.validateProposedGameState(e.peer,n)?(this.gameState=n,this.broadcastGameState(),this.eventHandler.updateGameState()):(console.error("Invalid game state proposed by peer:",e.peer),this.sendGameState(e))}},{key:"validateProposedGameState",value:function(e,t){return this.gameState.gamePhase!==Q.PAUSED||t.gamePhase===Q.PAUSED}},{key:"handleJoin",value:function(e,t){var n=this,r=t.players;if(this.gameState.players.length+r.length>this.gameState.settings.playerLimit)return e.send({type:"joinRejected",reason:"Lobby is full. The maximum player limit of ".concat(this.gameState.settings.playerLimit," has been reached.")}),void console.log("Join request rejected. Player limit of ".concat(this.gameState.settings.playerLimit," reached."));r.forEach((function(e){var t=new j.fromJSON(e);n.addPlayer(t)})),this.broadcastGameState()}},{key:"handleNameChange",value:function(e,t){console.log("recieved name change");var n=this.gameState.players.find((function(t){return t.playerId===e}));n&&(n.nickname=t,this.updateAndBroadcastGameState(this.gameState))}},{key:"handleClientRemovePlayer",value:function(e){this.removePlayer(e),this.broadcastGameState()}},{key:"handleClientAddPlayer",value:function(e,t){var n=e.peer,r=this.gameState.players.filter((function(e){return e.peerId===n})).length,i=this.gameState.players.length;if(r>=this.gameState.settings.playerLimitPerPeer)return e.send({type:"addPlayerRejected",reason:"Local player limit reached for your client. You can only create up to ".concat(this.gameState.settings.playerLimitPerPeer," players."),player:t}),void console.log("Player addition rejected for peerId ".concat(n," due to player limit."));if(i>=this.gameState.settings.playerLimit)return e.send({type:"addPlayerRejected",reason:"Total player limit reached. The game can only have up to ".concat(this.gameState.settings.playerLimit," players."),player:t}),void console.log("Player addition rejected for peerId ".concat(n," due to total player limit."));var o=j.fromJSON(t);this.addPlayer(o),this.broadcastGameState(),console.log("Player added successfully for peerId ".concat(n,". Player ID: ").concat(o.playerId))}},{key:"handleDisconnection",value:function(e){console.log("Connection closed with ".concat(e)),this.removePeer(e),this.broadcastGameState()}},{key:"removePeer",value:function(e){var t=this;this.gameState.players.filter((function(t){return t.peerId===e})).forEach((function(e){return t.removePlayer(e.playerId)}))}},{key:"broadcastGameState",value:function(){var e=this.gameState.toJSON();this.connections.forEach((function(t){t.send({type:"gameState",gameState:e})}))}},{key:"broadcastStartGame",value:function(){this.gameState.startGame(),this.broadcastGameState(),console.log("Sending start game signal to all clients..."),this.connections.forEach((function(e){e.send({type:"startGame"})}))}},{key:"kickPlayer",value:function(e){console.log("Kicking player with peerId: ".concat(e));var t=this.connections.find((function(t){return t.peer===e}));t&&(t.send({type:"kick"}),t.close(),this.removePeer(e),this.broadcastGameState())}},{key:"addNewOwnedPlayer",value:function(e){if(this.gameState.players.length>=this.gameState.settings.playerLimit)alert("Cannot add more players. The maximum limit of ".concat(this.gameState.settings.playerLimit," players has been reached."));else if(this.ownedPlayers.length>=this.gameState.settings.playerLimitPerPeer)alert("Cannot add more players. The maximum limit of ".concat(this.gameState.settings.playerLimitPerPeer," players for this peer has been reached."));else{var t=new j(this.peer.id,e,!1);this.addPlayer(t),this.eventHandler.updateGameState(),this.broadcastGameState()}}}],r&&Ir(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,i,o}(Er);function Mr(e){return Mr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Mr(e)}function Dr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Br(r.key),r)}}function Br(e){var t=function(e){if("object"!=Mr(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Mr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Mr(t)?t:t+""}var Nr=function(){return e=function e(){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),(this instanceof e?this.constructor:void 0)===e)throw new TypeError("Cannot instantiate abstract class Animation directly.")},(t=[{key:"init",value:function(){throw new Error("init() must be implemented by subclass")}},{key:"start",value:function(){throw new Error("start() must be implemented by subclass")}},{key:"cleanup",value:function(){throw new Error("cleanup() must be implemented by subclass")}}])&&Dr(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function Ur(e){return Ur="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ur(e)}function Gr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Fr(r.key),r)}}function Fr(e){var t=function(e){if("object"!=Ur(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Ur(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ur(t)?t:t+""}function Hr(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Hr=function(){return!!e})()}function zr(e){return zr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},zr(e)}function Jr(e,t){return Jr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Jr(e,t)}var Vr=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t,n){return t=zr(t),function(e,t){if(t&&("object"==Ur(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Hr()?Reflect.construct(t,n||[],zr(e).constructor):t.apply(e,n))}(this,t)).canvas=null,e.ctx=null,e.particles=[],e.animationFrameId=null,e.animationDuration=4e3,e.startTime=null,e.resultText="",e.callback=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Jr(e,t)}(t,e),n=t,r=[{key:"init",value:function(){}},{key:"start",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this.resultText=e.resultText||"",this.callback=t,this.initCanvas(),this.createParticles(),this.startTime=performance.now(),this.animate()}},{key:"initCanvas",value:function(){this.canvas||(this.canvas=document.createElement("canvas"),this.canvas.style.position="fixed",this.canvas.style.top="0",this.canvas.style.left="0",this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.zIndex="1000",this.canvas.style.pointerEvents="none",document.body.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d")),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.particles=[]}},{key:"createParticles",value:function(){for(var e=0;e<200;e++)this.particles.push({x:Math.random()*this.canvas.width,y:Math.random()*this.canvas.height,vx:2*(Math.random()-.5),vy:2*(Math.random()-.5),targetX:null,targetY:null})}},{key:"animate",value:function(){var e=this,t=performance.now()-this.startTime;this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),t<this.animationDuration?(t<this.animationDuration/2?this.updateParticlesChaos():(this.particles[0].targetX||this.setParticleTargets(),this.updateParticlesConverge()),this.drawParticles(),this.animationFrameId=requestAnimationFrame((function(){return e.animate()}))):(this.drawResultText(),setTimeout((function(){e.cleanup(),e.callback&&e.callback()}),2e3))}},{key:"updateParticlesChaos",value:function(){var e=this;this.particles.forEach((function(t){t.x+=5*t.vx,t.y+=5*t.vy,(t.x<=0||t.x>=e.canvas.width)&&(t.vx*=-1),(t.y<=0||t.y>=e.canvas.height)&&(t.vy*=-1)}))}},{key:"setParticleTargets",value:function(){var e=document.createElement("canvas");e.width=this.canvas.width,e.height=this.canvas.height;var t=e.getContext("2d");t.font="bold ".concat(100,"px Arial"),t.fillStyle="#ffffff",t.textAlign="center",t.textBaseline="middle",t.fillText(this.resultText,e.width/2,e.height/2);for(var n=t.getImageData(0,0,e.width,e.height).data,r=0,i=0;i<e.height;i+=4)for(var o=0;o<e.width;o+=4)if(n[4*(i*e.width+o)+3]>128){if(!(r<this.particles.length))break;this.particles[r].targetX=o,this.particles[r].targetY=i,r++}for(var a=r;a<this.particles.length;a++)this.particles[a].targetX=this.canvas.width/2+200*(Math.random()-.5),this.particles[a].targetY=this.canvas.height/2+200*(Math.random()-.5)}},{key:"updateParticlesConverge",value:function(){this.particles.forEach((function(e){var t=e.targetX-e.x,n=e.targetY-e.y;e.x+=.05*t,e.y+=.05*n}))}},{key:"drawParticles",value:function(){var e=this;this.ctx.fillStyle="#000000",this.particles.forEach((function(t){e.ctx.beginPath(),e.ctx.arc(t.x,t.y,2,0,2*Math.PI),e.ctx.fill()}))}},{key:"drawResultText",value:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.font="bold 100px Arial",this.ctx.fillStyle="#000000",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(this.resultText,this.canvas.width/2,this.canvas.height/2)}},{key:"cleanup",value:function(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.canvas&&this.canvas.parentElement&&(this.canvas.parentElement.removeChild(this.canvas),this.canvas=null,this.ctx=null)}}],r&&Gr(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Nr);function Wr(e){return Wr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Wr(e)}function Yr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,$r(r.key),r)}}function $r(e){var t=function(e){if("object"!=Wr(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Wr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Wr(t)?t:t+""}var Kr=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.rollButton=null,this.animation=t,this.onRollDiceCallback=null,this.onRollCompleteCallback=null},(t=[{key:"init",value:function(e,t,n){var r=this;this.rollButton=e||this.createRollButton(),this.onRollDiceCallback=t,this.onRollCompleteCallback=n,this.rollButton.addEventListener("click",(function(){r.rollButton.classList.contains("active")&&(r.deactivate(),r.handleRoll())}))}},{key:"handleRoll",value:function(){var e=this,t=this.onRollDiceCallback();this.animation.start({resultText:t.toString()},(function(){e.onRollCompleteCallback&&e.onRollCompleteCallback(t)}))}},{key:"createRollButton",value:function(){var e=document.createElement("button");return e.id="rollButton",e.textContent="Roll Dice",e.classList.add("roll-button"),document.body.appendChild(e),e}},{key:"activate",value:function(){this.rollButton.classList.add("active"),this.rollButton.style.cursor="pointer",this.rollButton.disabled=!1}},{key:"deactivate",value:function(){this.rollButton.classList.remove("active"),this.rollButton.style.cursor="not-allowed",this.rollButton.disabled=!0}},{key:"cleanup",value:function(){this.rollButton&&(this.rollButton.removeEventListener("click",this.onClickCallback),this.rollButton.remove(),this.rollButton=null)}}])&&Yr(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function qr(e){return qr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qr(e)}function Xr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Zr(r.key),r)}}function Zr(e){var t=function(e){if("object"!=qr(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=qr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==qr(t)?t:t+""}var Qr=function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.animation=t,this.gameState=n,this.onTimerEndCallback=null,this.pausedMessage=null},t=[{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.onTimerEndCallback=e,this.animation.init(t),this.createPausedMessage(),this.hidePausedMessage()}},{key:"startTimer",value:function(){var e=this;if(this.gameState.settings.isTurnTimerEnabled()){this.stopTimer();var t=this.gameState.settings.getTurnTimer();this.animation.start({duration:t},(function(){e.onTimerEndCallback&&e.onTimerEndCallback()}))}}},{key:"stopTimer",value:function(){this.animation.cleanup()}},{key:"pauseTimer",value:function(){this.gameState.settings.isTurnTimerEnabled()&&(this.animation.pause(),this.showPausedMessage())}},{key:"resumeTimer",value:function(){this.gameState.settings.isTurnTimerEnabled()&&(this.animation.resume(),this.hidePausedMessage())}},{key:"createPausedMessage",value:function(){if(!this.pausedMessage){var e=document.createElement("div");e.id="pausedMessage",e.textContent="Game Paused",e.classList.add("paused-message");var t=document.getElementById("pausedMessageContainer");if(t)t.appendChild(e);else{var n=document.getElementById("gameSidebar");n&&n.insertBefore(e,n.firstChild)}this.pausedMessage=e}}},{key:"showPausedMessage",value:function(){this.pausedMessage&&(this.pausedMessage.style.display="block")}},{key:"hidePausedMessage",value:function(){this.pausedMessage&&(this.pausedMessage.style.display="none")}}],t&&Xr(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function ei(e){return ei="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ei(e)}function ti(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ni(r.key),r)}}function ni(e){var t=function(e){if("object"!=ei(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=ei(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ei(t)?t:t+""}function ri(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(ri=function(){return!!e})()}function ii(e){return ii=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ii(e)}function oi(e,t){return oi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},oi(e,t)}var ai=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t,n){return t=ii(t),function(e,t){if(t&&("object"==ei(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ri()?Reflect.construct(t,n||[],ii(e).constructor):t.apply(e,n))}(this,t)).canvas=null,e.ctx=null,e.duration=0,e.remainingTime=0,e.animationFrameId=null,e.callback=null,e.startTime=null,e.paused=!1,e.pauseTime=null,e.isHost=n,e.pauseButton=null,e.pauseCallback=null,e.SOFT_GREEN="#90EE90",e.SOFT_YELLOW="#FFFF99",e.SOFT_RED="#FF9999",e.BACKGROUND_COLOR="#f0f0f0",e.CRITICAL_TIME_PERCENTAGE=.1,e.FADE_FREQUENCY=2,e.MIN_ALPHA=.5,e.MAX_ALPHA=1,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&oi(e,t)}(t,e),n=t,r=[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.timerContainer=document.querySelector(".timer-container"),!this.timerContainer){this.timerContainer=document.createElement("div"),this.timerContainer.classList.add("timer-container");var t=document.getElementById("gameSidebar");t?t.insertBefore(this.timerContainer,t.firstChild):document.body.appendChild(this.timerContainer)}this.canvas=document.getElementById("timerCanvas"),this.canvas||(this.canvas=document.createElement("canvas"),this.canvas.id="timerCanvas",this.canvas.width=100,this.canvas.height=100,this.canvas.classList.add("timer-canvas"),this.timerContainer.appendChild(this.canvas)),this.ctx=this.canvas.getContext("2d"),this.isHost&&(this.pauseCallback=e,this.createPauseButton())}},{key:"createPauseButton",value:function(){var e=this;this.pauseButton=document.createElement("button"),this.pauseButton.id="pauseButton",this.pauseButton.classList.add("button","button-pause","pause-icon"),this.timerContainer.style.position="relative",this.pauseButton.style.position="absolute",this.pauseButton.style.top="50%",this.pauseButton.style.left="50%",this.pauseButton.style.transform="translate(-50%, -50%)",this.pauseButton.style.display="none",this.timerContainer.appendChild(this.pauseButton),this.timerContainer.addEventListener("mouseenter",(function(){e.pauseButton.style.display="block"})),this.timerContainer.addEventListener("mouseleave",(function(){e.pauseButton.style.display="none"})),this.pauseButton.addEventListener("click",(function(){e.pauseCallback&&e.pauseCallback()}))}},{key:"togglePauseButton",value:function(){this.paused?(this.pauseButton.classList.remove("pause-icon"),this.pauseButton.classList.add("play-icon"),this.pauseButton.setAttribute("aria-label","Play")):(this.pauseButton.classList.remove("play-icon"),this.pauseButton.classList.add("pause-icon"),this.pauseButton.setAttribute("aria-label","Pause"))}},{key:"start",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this.cleanup(),this.duration=e.duration||30,void 0!==e.remainingTime?(this.remainingTime=e.remainingTime,this.startTime=Date.now()-1e3*(this.duration-this.remainingTime)):(this.remainingTime=this.duration,this.startTime=Date.now()),this.callback=t,this.paused=!1,this.pauseTime=null,this.animate()}},{key:"animate",value:function(){var e=this;if(!this.paused){var t=(Date.now()-this.startTime)/1e3;this.remainingTime=Math.max(this.duration-t,0),this.drawTimer(),this.remainingTime>0?this.animationFrameId=requestAnimationFrame((function(){return e.animate()})):(this.callback&&this.callback(),this.cleanup())}}},{key:"drawTimer",value:function(){var e,t=this.ctx,n=this.remainingTime/this.duration,r=2*Math.PI*n;if(n>.5){var i=2*(1-n);e=(0,N.De)(this.SOFT_GREEN,this.SOFT_YELLOW,i)}else{var o=2*(.5-n);e=(0,N.De)(this.SOFT_YELLOW,this.SOFT_RED,o)}var a=1;if(n<=this.CRITICAL_TIME_PERCENTAGE){var s=(Date.now()-this.startTime)/1e3;a=this.MIN_ALPHA+(this.MAX_ALPHA-this.MIN_ALPHA)*Math.abs(Math.sin(s*this.FADE_FREQUENCY*Math.PI))}t.clearRect(0,0,this.canvas.width,this.canvas.height),t.globalAlpha=a,t.beginPath(),t.arc(50,50,45,0,2*Math.PI),t.fillStyle=this.BACKGROUND_COLOR,t.fill(),t.closePath(),t.beginPath(),t.moveTo(50,50),t.arc(50,50,45,-Math.PI/2,-Math.PI/2+r,!1),t.fillStyle=e,t.fill(),t.closePath(),t.globalAlpha=1,t.beginPath(),t.arc(50,50,35,0,2*Math.PI),t.fillStyle="#ffffff",t.fill(),t.closePath(),t.fillStyle="#000000",t.font="bold 16px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText("".concat(Math.ceil(this.remainingTime),"s"),50,50)}},{key:"pause",value:function(){this.paused||(this.paused=!0,this.pauseTime=Date.now(),this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.isHost&&this.togglePauseButton())}},{key:"resume",value:function(){if(this.paused){var e=Date.now()-this.pauseTime;this.startTime+=e,this.paused=!1,this.pauseTime=null,this.animate(),this.isHost&&this.togglePauseButton()}}},{key:"cleanup",value:function(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.paused=!1,this.pauseTime=null}}],r&&ti(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Nr);function si(e){return si="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},si(e)}function ci(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ui(r.key),r)}}function ui(e){var t=function(e){if("object"!=si(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=si(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==si(t)?t:t+""}var li=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pauseButton=null},(t=[{key:"init",value:function(e,t){var n=this;this.pauseButton=e||this.createPauseButton(),this.pauseButton.addEventListener("click",(function(){t(),n.toggleButton()}))}},{key:"createPauseButton",value:function(){var e=document.createElement("button");e.id="pauseButton",e.textContent="",e.classList.add("pause-button");var t=document.getElementById("timerCanvas");return t&&t.parentNode.insertBefore(e,t.nextSibling),e}},{key:"toggleButton",value:function(){""===this.pauseButton.textContent?(this.pauseButton.textContent="",this.pauseButton.classList.remove("pause-button"),this.pauseButton.classList.add("play-button")):(this.pauseButton.textContent="",this.pauseButton.classList.remove("play-button"),this.pauseButton.classList.add("pause-button"))}}])&&ci(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function hi(e){return hi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},hi(e)}function pi(e,t,n){return(t=di(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function fi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,di(r.key),r)}}function di(e){var t=function(e){if("object"!=hi(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=hi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==hi(t)?t:t+""}var yi=function(){return e=function e(t,n,r,i,o){var a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.gameState=t,this.peerId=n,this.eventBus=i,this.proposeGameState=r,this.registryManager=o,this.isHost=a,this.gameEventsWithSpaces=null,this.gameEVentWithSpace=null;var s=new Vr;this.rollButtonManager=new Kr(s);var c=new ai(this.isHost);this.timerManager=new Qr(c,this.gameState),a&&(this.pauseButtonManager=new li),this.stateHandlers=pi(pi(pi(pi({},Q.IN_LOBBY,this.handleInLobby.bind(this)),Q.IN_GAME,this.handleInGame.bind(this)),Q.PAUSED,this.handlePaused.bind(this)),Q.GAME_ENDED,this.handleGameEnded.bind(this)),this.turnPhaseHandlers=pi(pi(pi(pi(pi(pi(pi(pi({},Z.A.CHANGE_TURN,this.handleChangeTurn.bind(this)),Z.A.BEGIN_TURN,this.handleBeginTurn.bind(this)),Z.A.WAITING_FOR_MOVE,this.handleWaitingForMove.bind(this)),Z.A.PROCESSING_EVENTS,this.handleProcessingEvents.bind(this)),Z.A.PROCESSING_EVENT,this.handleProcessingEvent.bind(this)),Z.A.PROCESSING_MOVE,this.handleProcessingMove.bind(this)),Z.A.PLAYER_CHOOSING_DESTINATION,this.handlePlayerChoosingDestination.bind(this)),Z.A.END_TURN,this.handleEndTurn.bind(this))},t=[{key:"init",value:function(){var e=this,t=document.getElementById("rollButton");this.rollButtonManager.init(t,(function(){return e.rollDiceForCurrentPlayer()}),(function(t){return e.handleAfterDiceRoll(t)})),this.timerManager.init((function(){return e.handleTimerEnd()}),this.isHost?function(){return e.togglePauseGame()}:null)}},{key:"updateGameState",value:function(e){this.gameState=e,this.timerManager.gameState=e;var t=this.stateHandlers[this.gameState.gamePhase];t?t():console.error("No handler for game phase: ".concat(this.gameState.gamePhase))}},{key:"handleInLobby",value:function(){console.log("Game is in the lobby phase.")}},{key:"handleInGame",value:function(){var e=this.turnPhaseHandlers[this.gameState.turnPhase];e?(this.timerManager.resumeTimer(),e()):console.error("No handler for turn phase: ".concat(this.gameState.turnPhase))}},{key:"handlePaused",value:function(){this.timerManager.pauseTimer(),this.rollButtonManager.deactivate(),console.log("Game is currently paused.")}},{key:"handleGameEnded",value:function(){console.log("Game has ended.")}},{key:"handleChangeTurn",value:function(){this.eventBus.emit("changeTurn",{gamestate:this.gameState}),this.isClientTurn()&&(console.log(this.gameState.getCurrentPlayer()),console.log(this.gameState.getCurrentPlayer().isSpectator),this.gameState.getCurrentPlayer().isSpectator?this.changePhase({newTurnPhase:Z.A.END_TURN,delay:0}):this.changePhase({newTurnPhase:Z.A.BEGIN_TURN,delay:0}))}},{key:"handleBeginTurn",value:function(){this.eventBus.emit("beginTurn",{gamestate:this.gameState}),this.timerManager.startTimer(),this.isClientTurn()&&(console.log("It's your turn, ".concat(this.gameState.getCurrentPlayer().nickname,"!")),this.changePhase({newTurnPhase:Z.A.WAITING_FOR_MOVE,delay:0}))}},{key:"handleWaitingForMove",value:function(){this.eventBus.emit("waitingForMove",{gamestate:this.gameState}),this.isClientTurn()?this.rollButtonManager.activate():(console.log("Waiting for ".concat(this.gameState.getCurrentPlayer().nickname," to take their turn.")),this.rollButtonManager.deactivate())}},{key:"handleProcessingEvents",value:function(){document.getElementById("gamePromptModal").style.display="none";var e=this.gameState.getCurrentPlayer();console.log("Processing events for ".concat(e.nickname,"'s move.")),this.gameEventsWithSpaces=this.gameState.determineTriggeredEvents(this.eventBus,this.peerId),0===this.gameEventsWithSpaces.length?(this.gameState.resetEvents(),this.isClientTurn()&&this.changePhase({newTurnPhase:Z.A.PROCESSING_MOVE,delay:0})):this.isClientTurn()&&this.changePhase({newTurnPhase:Z.A.PROCESSING_EVENT,delay:0})}},{key:"handleProcessingEvent",value:function(){this.gameState.getCurrentPlayer(),this.gameEventsWithSpaces=this.gameState.determineTriggeredEvents(this.eventBus,this.peerId),this.gameEventWithSpace=this.gameEventsWithSpaces[0];var e=this.gameEventWithSpace,t=e.event,n=e.space;this.eventBus.emit("gameEventTriggered",{gameEvent:t,gamestate:this.gameState,eventSpace:n}),t.executeAction(this,!0)}},{key:"handlePlayerChoosingDestination",value:function(){var e=this.gameState.getCurrentPlayer(),t=e.getCurrentSpaceId(),n=this.gameState.board.getSpace(t).connections.map((function(e){return e.target}));console.log("".concat(e.nickname," is choosing a destination...")),console.log("".concat(e.nickname," has multiple choices to move to: ").concat(n.map((function(e){return e.id})).join(", "))),this.isClientTurn()&&this.waitForChoice(e,n)}},{key:"handleProcessingMove",value:function(){this.eventBus.emit("processingMove",{gamestate:this.gameState}),this.isClientTurn()&&(this.gameState.hasMovesLeft()?this.processSingleMove():this.changePhase({newTurnPhase:Z.A.END_TURN,delay:0}))}},{key:"handleEndTurn",value:function(){if(console.log("Ending turn for ".concat(this.gameState.getCurrentPlayer().nickname,".")),this.eventBus.emit("turnEnded",{gamestate:this.gameState}),this.timerManager.stopTimer(),this.gameState.players.every((function(e){return e.isSpectator})))return console.log("All players are spectators. Ending the game."),void this.changePhase({newGamePhase:Q.GAME_ENDED,newTurnPhase:Z.A.CHANGE_TURN,delay:0});this.isClientTurn()&&(this.gameState.nextPlayerTurn(),this.changePhase({newTurnPhase:Z.A.CHANGE_TURN,delay:0}))}},{key:"handleTimerEnd",value:function(){this.isClientTurn()&&(console.log("Time's up for ".concat(this.gameState.getCurrentPlayer().nickname,"! Ending turn.")),this.eventBus.emit("timerEnded",{gamestate:this.gameState}),this.rollButtonManager.deactivate(),this.changePhase({newTurnPhase:Z.A.END_TURN,delay:0}))}},{key:"rollDiceForCurrentPlayer",value:function(){var e=this.gameState.getCurrentPlayer(),t=e.rollDice();return console.log("".concat(e.nickname," rolled a ").concat(t)),this.rollButtonManager.deactivate(),t}},{key:"handleAfterDiceRoll",value:function(e){this.gameState.setRemainingMoves(e),this.eventBus.emit("playerRoll",{gamestate:this.gameState}),this.changePhase({newTurnPhase:Z.A.PROCESSING_EVENTS})}},{key:"processSingleMove",value:function(){var e=this.gameState.getCurrentPlayer(),t=e.getCurrentSpaceId(),n=this.gameState.board.getSpace(t).connections;if(0===n.length)this.gameState.setRemainingMoves(0),this.changePhase({newTurnPhase:Z.A.PROCESSING_EVENTS});else if(1===n.length){var r=n[0].target;this.gameState.movePlayer(r.id),console.log("".concat(e.nickname," moved to space ").concat(r.id)),this.changePhase({newTurnPhase:Z.A.PROCESSING_EVENTS})}else n.length>1&&this.changePhase({newTurnPhase:Z.A.PLAYER_CHOOSING_DESTINATION,delay:0})}},{key:"waitForChoice",value:function(e,t){var n=this;this.gameState.board.highlightSpaces(t);var r={};t.forEach((function(i){var o,a=document.getElementById("space-".concat(i.id)),s=(o=i,function(){n.gameState.movePlayer(o.id),console.log("".concat(e.nickname," chose to move to space ").concat(o.id)),n.gameState.board.removeHighlightFromSpaces(t),n.changePhase({newTurnPhase:Z.A.PROCESSING_EVENTS,delay:0}),t.forEach((function(e){document.getElementById("space-".concat(e.id)).removeEventListener("click",r[e.id])}))});r[i.id]=s,a.addEventListener("click",s)}))}},{key:"togglePauseGame",value:function(){this.gameState.gamePhase===Q.IN_GAME?(this.changePhase({newGamePhase:Q.PAUSED,delay:0}),this.timerManager.pauseTimer(),this.rollButtonManager.deactivate(),this.eventBus.emit("gamePaused",{gamestate:this.gameState}),console.log("Game paused.")):this.gameState.gamePhase===Q.PAUSED&&(this.changePhase({newGamePhase:Q.IN_GAME,delay:0}),this.timerManager.resumeTimer(),this.eventBus.emit("gameResumed",{gamestate:this.gameState}),console.log("Game resumed."))}},{key:"proposeGameStateWrapper",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,n=t>=0?t:this.gameState.settings.getMoveDelay();setTimeout((function(){e.proposeGameState(e.gameState)}),n)}},{key:"changePhase",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.newGamePhase,n=e.newTurnPhase,r=e.delay,i=void 0===r?-1:r;t&&this.gameState.setGamePhase(t),n&&this.gameState.setTurnPhase(n),console.log("Changing Phase to:",this.gameState.turnPhase,this.gameState.gamePhase,i),this.proposeGameStateWrapper(i)}},{key:"isClientTurn",value:function(){return this.gameState.getCurrentPlayer().peerId===this.peerId}},{key:"showPromptModal",value:function(e){var t=this,n=document.getElementById("gamePromptModal"),r=document.getElementById("gamePromptModalMessage"),i=document.getElementById("gamePromptModalDismissButton");r.textContent=e,n.style.display="block",this.isClientTurn()?(i.style.display="inline-block",i.onclick=function(){n.style.display="none",t.changePhase({newTurnPhase:Z.A.PROCESSING_EVENTS,delay:0})}):i.style.display="none"}}],t&&fi(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function mi(e){return mi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},mi(e)}function vi(){vi=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var o=t&&t.prototype instanceof v?t:v,a=Object.create(o.prototype),s=new x(r||[]);return i(a,"_invoke",{value:C(e,n,s)}),a}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var p="suspendedStart",f="suspendedYield",d="executing",y="completed",m={};function v(){}function g(){}function b(){}var w={};u(w,a,(function(){return this}));var _=Object.getPrototypeOf,S=_&&_(_(R([])));S&&S!==n&&r.call(S,a)&&(w=S);var P=b.prototype=v.prototype=Object.create(w);function k(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){function n(i,o,a,s){var c=h(e[i],e,o);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==mi(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return n("throw",e,a,s)}))}s(c.arg)}var o;i(this,"_invoke",{value:function(e,r){function i(){return new t((function(t,i){n(e,r,t,i)}))}return o=o?o.then(i,i):i()}})}function C(t,n,r){var i=p;return function(o,a){if(i===d)throw Error("Generator is already running");if(i===y){if("throw"===o)throw a;return{value:e,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var c=T(s,r);if(c){if(c===m)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===p)throw i=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=d;var u=h(t,n,r);if("normal"===u.type){if(i=r.done?y:f,u.arg===m)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=y,r.method="throw",r.arg=u.arg)}}}function T(t,n){var r=n.method,i=t.iterator[r];if(i===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,T(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var o=h(i,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,m;var a=o.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function R(t){if(t||""===t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}throw new TypeError(mi(t)+" is not iterable")}return g.prototype=b,i(P,"constructor",{value:b,configurable:!0}),i(b,"constructor",{value:g,configurable:!0}),g.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create(P),e},t.awrap=function(e){return{__await:e}},k(E.prototype),u(E.prototype,s,(function(){return this})),t.AsyncIterator=E,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new E(l(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},k(P),u(P,c,"Generator"),u(P,a,(function(){return this})),u(P,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=R,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(I),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return s.type="throw",s.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),I(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;I(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:R(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),m}},t}function gi(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function bi(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){gi(o,r,i,a,s,"next",e)}function s(e){gi(o,r,i,a,s,"throw",e)}a(void 0)}))}}function wi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_i(r.key),r)}}function _i(e){var t=function(e){if("object"!=mi(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=mi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==mi(t)?t:t+""}function Si(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Si=function(){return!!e})()}function Pi(e,t,n,r){var i=ki(Ei(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof i?function(e){return i.apply(n,e)}:i}function ki(){return ki="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=Ei(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},ki.apply(null,arguments)}function Ei(e){return Ei=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ei(e)}function Ci(e,t){return Ci=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ci(e,t)}var Ti=function(e){function t(e,n,r){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t,n){return t=Ei(t),function(e,t){if(t&&("object"==mi(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Si()?Reflect.construct(t,n||[],Ei(e).constructor):t.apply(e,n))}(this,t,[!0,e,n,r])}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ci(e,t)}(t,e),n=t,r=[{key:"init",value:function(){Pi(t,"init",this,3)([]),this.showPage("hostPage")}},{key:"setupEventListeners",value:function(){var e=this;Pi(t,"setupEventListeners",this,3)([]);var n=document.getElementById("startHostButton"),r=document.getElementById("copyInviteCodeButton"),i=document.getElementById("closeGameButton"),o=document.getElementById("startGameButton"),a=document.getElementById("addPlayerButton"),s=document.getElementById("uploadBoardButton"),c=document.getElementById("boardFileInput"),u=document.getElementById("uploadPluginButton"),l=document.getElementById("pluginFileInput"),h=document.getElementById("playerLimitPerPeerHost"),p=document.getElementById("totalPlayerLimitHost"),f=document.getElementById("turnTimerHost"),d=document.getElementById("moveDelayHost"),y=document.getElementById("turnTimerEnabledHost");n&&this.listenerRegistry.registerListener("startHostButton","click",(function(){return e.startHostGame()})),r&&this.listenerRegistry.registerListener("copyInviteCodeButton","click",(function(){return e.copyInviteCode()})),i&&this.listenerRegistry.registerListener("closeGameButton","click",(function(){return e.closeGame()})),o&&this.listenerRegistry.registerListener("startGameButton","click",(function(){return e.startGame()})),a&&this.listenerRegistry.registerListener("addPlayerButton","click",(function(){return e.addPlayer()})),s&&c&&(this.listenerRegistry.registerListener("uploadBoardButton","click",(function(){return c.click()})),this.listenerRegistry.registerListener("boardFileInput","change",function(){var t=bi(vi().mark((function t(n){var r;return vi().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r=n.target.files[0])){t.next=15;break}return t.prev=2,t.next=5,e.boardManager.loadBoardFromFile(r);case 5:e.peer.gameState.board=e.boardManager.board,e.peer.broadcastGameState(),e.updateGameBoard(!0),e.updatePieces(!0),n.target.value="",t.next=15;break;case 12:t.prev=12,t.t0=t.catch(2),alert("Error loading board file: ".concat(t.t0.message));case 15:case"end":return t.stop()}}),t,null,[[2,12]])})));return function(e){return t.apply(this,arguments)}}())),u&&l&&(this.listenerRegistry.registerListener("uploadPluginButton","click",(function(){return l.click()})),this.listenerRegistry.registerListener("pluginFileInput","change",function(){var t=bi(vi().mark((function t(n){var r;return vi().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r=n.target.files[0])){t.next=11;break}return t.prev=2,t.next=5,e.pluginManager.initializePluginFromFile(r);case 5:alert("Plugin uploaded and initialized successfully!"),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(2),alert("Error loading plugin: ".concat(t.t0.message));case 11:case"end":return t.stop()}}),t,null,[[2,8]])})));return function(e){return t.apply(this,arguments)}}()));var m=function(t,n){t&&(e.listenerRegistry.registerListener(t.id,"change",n),e.listenerRegistry.registerListener(t.id,"blur",n),e.listenerRegistry.registerListener(t.id,"keydown",(function(e){"Enter"===e.key&&(t.blur(),n())})))};h&&m(h,(function(){return e.onSettingsChanged()})),p&&m(p,(function(){return e.onSettingsChanged()})),f&&m(f,(function(){return e.onSettingsChanged()})),d&&m(d,(function(){return e.onSettingsChanged()})),y&&this.listenerRegistry.registerListener("turnTimerEnabledHost","change",(function(){return e.onSettingsChanged()}))}},{key:"startHostGame",value:(i=bi(vi().mark((function e(){var t,n,r=this;return vi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=document.getElementById("hostNameInput"),n=t.value.trim()){e.next=5;break}return alert("Please enter your name."),e.abrupt("return");case 5:return document.getElementById("startHostButton").disabled=!0,this.showPage("loadingPage"),this.peer=new Ar(n,this),e.next=10,this.peer.init();case 10:this.pluginManager.setPeer(this.peer.peer),this.gameEngine=new yi(this.peer.gameState,this.peer.peer.id,(function(e){return r.peer.updateAndBroadcastGameState(e)}),this.eventBus,!0),this.gameEngine.init(),this.showPage("lobbyPage"),this.displayLobbyControls();case 15:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"displayLobbyControls",value:function(){var e=document.getElementById("closeGameButton"),t=document.getElementById("startGameButton"),n=document.getElementById("uploadBoardButton"),r=document.getElementById("settingsSectionHost");e&&(e.style.display="inline"),t&&(t.style.display="inline"),n&&(n.style.display="inline"),r&&(r.style.display="inline"),this.updateAddPlayerButton()}},{key:"startGame",value:function(){console.log("Host is starting the game..."),this.peer&&this.peer.broadcastStartGame(),this.showPage("gamePage"),this.playerListManager.setListElement(document.getElementById("gamePlayerList")),this.boardManager.setBoardContainer(document.getElementById("gameBoardContent")),this.updateGameState(!0)}},{key:"addPlayerListListeners",value:function(){var e=this;document.querySelectorAll(".kick-button").forEach((function(t){var n=t.getAttribute("data-playerId");e.listenerRegistry.registerListener(t.id,"click",(function(){e.confirmAndKickPlayer(n)}))})),document.querySelectorAll(".edit-button").forEach((function(t){var n=t.getAttribute("data-playerId");e.listenerRegistry.registerListener(t.id,"click",(function(){e.editPlayerName(n)}))})),document.querySelectorAll(".remove-button").forEach((function(t){var n=t.getAttribute("data-playerId");e.listenerRegistry.registerListener(t.id,"click",(function(){e.removePlayer(n)}))}))}},{key:"confirmAndKickPlayer",value:function(e){var t=this.peer.gameState.players.find((function(t){return t.playerId===e}));t&&confirm("Are you sure you want to kick ".concat(t.nickname,"? This will disconnect all players associated with this player's client."))&&this.peer.kickPlayer(t.peerId)}},{key:"editPlayerName",value:function(e){var t=this.peer.ownedPlayers.find((function(t){return t.playerId===e}));if(t){var n=prompt("Enter new name:",t.nickname);n&&(t.nickname=n,this.updateGameState(),this.peer.broadcastGameState())}}},{key:"removePlayer",value:function(e){var t=this.peer.ownedPlayers.findIndex((function(t){return t.playerId===e}));if(-1!==t)if(1===this.peer.ownedPlayers.length)alert("You have removed your last player. Leaving the game."),this.leaveGame();else{var n=this.peer.ownedPlayers.splice(t,1)[0];this.peer.removePlayer(n.playerId),this.peer.broadcastGameState(),this.updateGameState(),this.updateAddPlayerButton()}else alert("Player not found.")}},{key:"addPlayer",value:function(){var e=prompt("Enter a new player name:");e&&""!==e.trim()&&this.peer.addNewOwnedPlayer(e.trim())}},{key:"onSettingsChanged",value:function(){console.log("Called"),this.settingsManager.updateGameStateFromInputs(this.peer.gameState),this.peer.broadcastGameState(),this.updateAddPlayerButton()}}],r&&wi(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,i}(Ue);function Oi(e){return Oi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Oi(e)}function Ii(){Ii=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var o=t&&t.prototype instanceof v?t:v,a=Object.create(o.prototype),s=new x(r||[]);return i(a,"_invoke",{value:C(e,n,s)}),a}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var p="suspendedStart",f="suspendedYield",d="executing",y="completed",m={};function v(){}function g(){}function b(){}var w={};u(w,a,(function(){return this}));var _=Object.getPrototypeOf,S=_&&_(_(R([])));S&&S!==n&&r.call(S,a)&&(w=S);var P=b.prototype=v.prototype=Object.create(w);function k(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){function n(i,o,a,s){var c=h(e[i],e,o);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==Oi(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return n("throw",e,a,s)}))}s(c.arg)}var o;i(this,"_invoke",{value:function(e,r){function i(){return new t((function(t,i){n(e,r,t,i)}))}return o=o?o.then(i,i):i()}})}function C(t,n,r){var i=p;return function(o,a){if(i===d)throw Error("Generator is already running");if(i===y){if("throw"===o)throw a;return{value:e,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var c=T(s,r);if(c){if(c===m)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===p)throw i=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=d;var u=h(t,n,r);if("normal"===u.type){if(i=r.done?y:f,u.arg===m)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=y,r.method="throw",r.arg=u.arg)}}}function T(t,n){var r=n.method,i=t.iterator[r];if(i===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,T(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var o=h(i,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,m;var a=o.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function R(t){if(t||""===t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}throw new TypeError(Oi(t)+" is not iterable")}return g.prototype=b,i(P,"constructor",{value:b,configurable:!0}),i(b,"constructor",{value:g,configurable:!0}),g.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create(P),e},t.awrap=function(e){return{__await:e}},k(E.prototype),u(E.prototype,s,(function(){return this})),t.AsyncIterator=E,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new E(l(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},k(P),u(P,c,"Generator"),u(P,a,(function(){return this})),u(P,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=R,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(I),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return s.type="throw",s.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),I(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;I(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:R(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),m}},t}function xi(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function Ri(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Li(r.key),r)}}function Li(e){var t=function(e){if("object"!=Oi(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Oi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Oi(t)?t:t+""}function ji(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(ji=function(){return!!e})()}function Ai(e){return Ai=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ai(e)}function Mi(e,t){return Mi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Mi(e,t)}var Di=function(e){function t(e,n,r){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=function(e,t,n){return t=Ai(t),function(e,t){if(t&&("object"==Oi(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ji()?Reflect.construct(t,n||[],Ai(e).constructor):t.apply(e,n))}(this,t,[r])).originalName=e,i.hostId=n,i.conn=null,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Mi(e,t)}(t,e),n=t,r=[{key:"init",value:(i=Ii().mark((function e(){var t,n;return Ii().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Initializing Client..."),e.next=3,this.initPeer();case 3:return t=e.sent,console.log("Peer connection open with ID:",t),this.eventHandler.initManagers(t,this.hostId),e.next=8,this.initializeGameState();case 8:n=new j(t,this.originalName),this.addPlayer(n),this.connectToHost();case 11:case"end":return e.stop()}}),e,this)})),o=function(){var e=this,t=arguments;return new Promise((function(n,r){var o=i.apply(e,t);function a(e){xi(o,n,r,a,s,"next",e)}function s(e){xi(o,n,r,a,s,"throw",e)}a(void 0)}))},function(){return o.apply(this,arguments)})},{key:"connectToHost",value:function(){var e=this;this.conn=this.peer.connect(this.hostId),this.conn.on("open",(function(){return e.handleOpenConnection()})),this.conn.on("data",(function(t){return e.handleData(t)})),this.conn.on("close",(function(){return e.handleDisconnection()})),this.conn.on("error",(function(t){return e.handleConnectionError(t)}))}},{key:"proposeGameState",value:function(e){this.conn&&this.conn.open?this.conn.send({type:"proposeGameState",gameState:e.toJSON()}):console.error("Cannot propose game state, not connected to host.")}},{key:"handleOpenConnection",value:function(){console.log("Connected to host");var e=this.ownedPlayers.map((function(e){return e.toJSON()}));this.conn.send({type:"join",peerId:this.peer.id,players:e}),this.eventHandler.displayInviteCode(this.hostId)}},{key:"handleData",value:function(e){switch(e.type){case"connectionPackage":this.handleConnectionPackage(e.gameState);case"gameState":this.handleGameStateUpdate(e.gameState);break;case"kick":this.handleKick();break;case"joinRejected":this.handleJoinRejected(e.reason);break;case"startGame":this.handleStartGame();break;case"addPlayerRejected":this.handleAddPlayerRejected(e.reason);default:console.log("Unknown data type:",e.type)}}},{key:"handleConnectionPackage",value:function(e){this.gameState=le.fromJSON(e),console.log("Game state updated:",this.gameState),this.gameState.isGameStarted()?this.eventHandler.showGamePage():this.eventHandler.showLobbyPage()}},{key:"handleGameStateUpdate",value:function(e){this.gameState=le.fromJSON(e),this.eventHandler.updateGameState()}},{key:"handleKick",value:function(){alert("You have been kicked from the game."),location.reload()}},{key:"handleJoinRejected",value:function(e){alert("Join request rejected: ".concat(e)),location.reload()}},{key:"handleStartGame",value:function(){this.eventHandler.showGamePage()}},{key:"handleDisconnection",value:function(){alert("Disconnected from the host."),location.reload()}},{key:"handleConnectionError",value:function(e){alert("Connection error: "+e),location.reload()}},{key:"handleAddPlayerRejected",value:function(e){alert(e)}}],r&&Ri(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,i,o}(Er);function Bi(e){return Bi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Bi(e)}function Ni(){Ni=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var o=t&&t.prototype instanceof v?t:v,a=Object.create(o.prototype),s=new x(r||[]);return i(a,"_invoke",{value:C(e,n,s)}),a}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var p="suspendedStart",f="suspendedYield",d="executing",y="completed",m={};function v(){}function g(){}function b(){}var w={};u(w,a,(function(){return this}));var _=Object.getPrototypeOf,S=_&&_(_(R([])));S&&S!==n&&r.call(S,a)&&(w=S);var P=b.prototype=v.prototype=Object.create(w);function k(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){function n(i,o,a,s){var c=h(e[i],e,o);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==Bi(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return n("throw",e,a,s)}))}s(c.arg)}var o;i(this,"_invoke",{value:function(e,r){function i(){return new t((function(t,i){n(e,r,t,i)}))}return o=o?o.then(i,i):i()}})}function C(t,n,r){var i=p;return function(o,a){if(i===d)throw Error("Generator is already running");if(i===y){if("throw"===o)throw a;return{value:e,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var c=T(s,r);if(c){if(c===m)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===p)throw i=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=d;var u=h(t,n,r);if("normal"===u.type){if(i=r.done?y:f,u.arg===m)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=y,r.method="throw",r.arg=u.arg)}}}function T(t,n){var r=n.method,i=t.iterator[r];if(i===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,T(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var o=h(i,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,m;var a=o.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function R(t){if(t||""===t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}throw new TypeError(Bi(t)+" is not iterable")}return g.prototype=b,i(P,"constructor",{value:b,configurable:!0}),i(b,"constructor",{value:g,configurable:!0}),g.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create(P),e},t.awrap=function(e){return{__await:e}},k(E.prototype),u(E.prototype,s,(function(){return this})),t.AsyncIterator=E,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new E(l(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},k(P),u(P,c,"Generator"),u(P,a,(function(){return this})),u(P,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=R,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(I),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return s.type="throw",s.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),I(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;I(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:R(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),m}},t}function Ui(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function Gi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Fi(r.key),r)}}function Fi(e){var t=function(e){if("object"!=Bi(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Bi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Bi(t)?t:t+""}function Hi(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Hi=function(){return!!e})()}function zi(e,t,n,r){var i=Ji(Vi(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof i?function(e){return i.apply(n,e)}:i}function Ji(){return Ji="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=Vi(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},Ji.apply(null,arguments)}function Vi(e){return Vi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Vi(e)}function Wi(e,t){return Wi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Wi(e,t)}var Yi=function(e){function t(e,n,r){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t,n){return t=Vi(t),function(e,t){if(t&&("object"==Bi(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Hi()?Reflect.construct(t,n||[],Vi(e).constructor):t.apply(e,n))}(this,t,[!1,e,n,r])}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Wi(e,t)}(t,e),n=t,r=[{key:"init",value:function(){zi(t,"init",this,3)([]),this.showPage("joinPage")}},{key:"setupEventListeners",value:function(){var e=this;zi(t,"setupEventListeners",this,3)([]),this.listenerRegistry.registerListener("startJoinButton","click",(function(){return e.startJoinGame()})),this.listenerRegistry.registerListener("copyInviteCodeButton","click",(function(){return e.copyInviteCode()})),this.listenerRegistry.registerListener("leaveGameButton","click",(function(){return e.leaveGame()})),this.listenerRegistry.registerListener("addPlayerButton","click",(function(){return e.addNewOwnedPlayer()}))}},{key:"startJoinGame",value:(i=Ni().mark((function e(){var t,n,r,i,o=this;return Ni().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=document.getElementById("joinNameInput"),n=document.getElementById("joinCodeInput"),r=t.value.trim(),i=n.value.trim(),r&&i){e.next=7;break}return alert("Please enter your name and a valid game code."),e.abrupt("return");case 7:return document.getElementById("startJoinButton").disabled=!0,this.showPage("loadingPage"),this.peer=new Di(r,i,this),e.next=12,this.peer.init();case 12:this.pluginManager.setPeer(this.peer.peer),this.gameEngine=new yi(this.peer.gameState,this.peer.peer.id,(function(e){return o.peer.proposeGameState(e)}),this.eventBus,!1),this.gameEngine.init(),this.showLobbyPage();case 16:case"end":return e.stop()}}),e,this)})),o=function(){var e=this,t=arguments;return new Promise((function(n,r){var o=i.apply(e,t);function a(e){Ui(o,n,r,a,s,"next",e)}function s(e){Ui(o,n,r,a,s,"throw",e)}a(void 0)}))},function(){return o.apply(this,arguments)})},{key:"displayLobbyControls",value:function(){var e=document.getElementById("leaveGameButton"),t=document.getElementById("settingsSectionClient");e&&(e.style.display="inline"),t&&(t.style.display="inline"),this.updateAddPlayerButton()}},{key:"showGamePage",value:function(){console.log("Client is switching to game page..."),this.showPage("gamePage"),this.playerListManager.setListElement(document.getElementById("gamePlayerList")),this.boardManager.setBoardContainer(document.getElementById("gameBoardContent")),this.updateGameState(!0)}},{key:"showLobbyPage",value:function(){this.showPage("lobbyPage"),this.displayLobbyControls(),this.updateGameState(!0)}},{key:"updateDisplayedSettings",value:function(){this.playerLimitPerPeerDisplay&&(this.playerLimitPerPeerDisplay.textContent=this.client.settings.playerLimitPerPeer),this.totalPlayerLimitDisplay&&(this.totalPlayerLimitDisplay.textContent=this.client.settings.playerLimit),this.turnTimerDisplay&&(this.turnTimerDisplay.textContent=this.client.settings.turnTimer),this.moveDelayDisplay&&(this.moveDelayDisplay.textContent=this.client.settings.moveDelay),this.updateAddPlayerButton()}},{key:"addPlayerListListeners",value:function(){var e=this;document.querySelectorAll(".edit-button").forEach((function(t){var n=t.getAttribute("data-playerId");e.listenerRegistry.registerListener(t.id,"click",(function(){e.editPlayerName(n)}))})),document.querySelectorAll(".remove-button").forEach((function(t){var n=t.getAttribute("data-playerId");e.listenerRegistry.registerListener(t.id,"click",(function(){e.removePlayer(n)}))}))}},{key:"editPlayerName",value:function(e){var t=this.peer.ownedPlayers.find((function(t){return t.playerId===e}));if(t){var n=prompt("Enter new name:",t.nickname);n&&(t.nickname=n,this.peer.conn.send({type:"nameChange",playerId:e,newName:n}))}}},{key:"addNewOwnedPlayer",value:function(){var e=prompt("Enter a new player name:");if(e&&""!==e.trim()){var t=new Player(this.peer.peer.id,e);this.peer.addOwnedPlayer(t)}}}],r&&Gi(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,i,o}(Ue);function $i(e){return $i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$i(e)}function Ki(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,qi(r.key),r)}}function qi(e){var t=function(e){if("object"!=$i(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=$i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==$i(t)?t:t+""}var Xi=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var t=e.loadFromLocalStorage();t?(this.theme=t.theme,this.soundVolume=t.soundVolume,this.showTips=t.showTips,this.autoRoll=t.autoRoll):(this.theme="light",this.soundVolume=1,this.showTips=!0,this.autoRoll=!1)}return t=e,r=[{key:"fromJSON",value:function(t){var n=new e;return n.theme=t.theme,n.soundVolume=t.soundVolume,n.showTips=t.showTips,n.autoRoll=t.autoRoll,n}},{key:"loadFromLocalStorage",value:function(){var e=localStorage.getItem("personalSettings");return e?JSON.parse(e):null}}],(n=[{key:"getTheme",value:function(){return this.theme}},{key:"setTheme",value:function(e){this.theme=e,this.saveToLocalStorage()}},{key:"getSoundVolume",value:function(){return this.soundVolume}},{key:"setSoundVolume",value:function(e){this.soundVolume=Math.min(Math.max(e,0),1),this.saveToLocalStorage()}},{key:"getShowTips",value:function(){return this.showTips}},{key:"setShowTips",value:function(e){this.showTips=e,this.saveToLocalStorage()}},{key:"getAutoRoll",value:function(){return this.autoRoll}},{key:"setAutoRoll",value:function(e){this.autoRoll=e,this.saveToLocalStorage()}},{key:"toJSON",value:function(){return{theme:this.theme,soundVolume:this.soundVolume,showTips:this.showTips,autoRoll:this.autoRoll}}},{key:"saveToLocalStorage",value:function(){localStorage.setItem("personalSettings",JSON.stringify(this.toJSON()))}}])&&Ki(t.prototype,n),r&&Ki(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,r}();function Zi(e){return Zi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Zi(e)}function Qi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,eo(r.key),r)}}function eo(e){var t=function(e){if("object"!=Zi(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Zi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Zi(t)?t:t+""}function to(e){return to="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},to(e)}function no(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ro(r.key),r)}}function ro(e){var t=function(e){if("object"!=to(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=to(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==to(t)?t:t+""}function io(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(io=function(){return!!e})()}function oo(){return oo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=ao(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},oo.apply(null,arguments)}function ao(e){return ao=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ao(e)}function so(e,t){return so=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},so(e,t)}var co=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t,n){return t=ao(t),function(e,t){if(t&&("object"==to(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,io()?Reflect.construct(t,n||[],ao(e).constructor):t.apply(e,n))}(this,t,[e])).personalSettings=n,r.availableThemes=["light","dark","retro"],r.themeSelect=document.getElementById("themeSelect"),r.soundVolume=document.getElementById("soundVolume"),r.showTips=document.getElementById("showTips"),r.autoRoll=document.getElementById("autoRoll"),r.initialize(),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&so(e,t)}(t,e),n=t,r=[{key:"initialize",value:function(){var e=this;this.populateThemeOptions(),this.loadSettingsIntoUI(),this.applyTheme(),document.getElementById("gearButton").addEventListener("click",(function(){e.toggle()})),document.getElementById("closeSettingsButton").addEventListener("click",(function(){e.hide()})),this.themeSelect.addEventListener("change",(function(t){e.personalSettings.setTheme(t.target.value),e.applyTheme()})),this.soundVolume.addEventListener("input",(function(t){e.personalSettings.setSoundVolume(parseFloat(t.target.value)),e.applySoundVolume()})),this.showTips.addEventListener("change",(function(t){e.personalSettings.setShowTips(t.target.checked),e.applyShowTips()})),this.autoRoll.addEventListener("change",(function(t){e.personalSettings.setAutoRoll(t.target.checked),e.applyAutoRoll()}))}},{key:"populateThemeOptions",value:function(){var e=this;this.themeSelect.innerHTML="",this.availableThemes.forEach((function(t){var n=document.createElement("option");n.value=t,n.textContent=t.charAt(0).toUpperCase()+t.slice(1),e.themeSelect.appendChild(n)}))}},{key:"loadSettingsIntoUI",value:function(){this.themeSelect.value=this.personalSettings.getTheme(),this.soundVolume.value=this.personalSettings.getSoundVolume(),this.showTips.checked=this.personalSettings.getShowTips(),this.autoRoll.checked=this.personalSettings.getAutoRoll()}},{key:"applyTheme",value:function(){var e=this.personalSettings.getTheme();document.body.className="",document.body.classList.add("".concat(e,"-theme")),console.log("Switched theme to",this.personalSettings.getTheme())}},{key:"applySoundVolume",value:function(){}},{key:"applyShowTips",value:function(){}},{key:"applyAutoRoll",value:function(){}},{key:"show",value:function(){var e,n,r;this.loadSettingsIntoUI(),(e=t,n=this,"function"==typeof(r=oo(ao(1&3?e.prototype:e),"show",n))?function(e){return r.apply(n,e)}:r)([])}}],r&&no(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(function(){return e=function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.modal=document.getElementById(t),!this.modal)throw new Error("Modal with ID ".concat(t," not found!"))},(t=[{key:"show",value:function(){this.modal.style.display="flex"}},{key:"hide",value:function(){this.modal.style.display="none"}},{key:"toggle",value:function(){"none"===this.modal.style.display||""===this.modal.style.display?this.show():this.hide()}}])&&Qi(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}());function uo(e){return uo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},uo(e)}function lo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ho(r.key),r)}}function ho(e){var t=function(e){if("object"!=uo(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=uo(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==uo(t)?t:t+""}var po=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.registry={}},(t=[{key:"register",value:function(e,t){t?this.registry[e]=t:console.warn("Item with ID ".concat(e," could not be registered."))}},{key:"unregister",value:function(e){this.registry[e]?(delete this.registry[e],console.log("Item with ID ".concat(e," unregistered."))):console.warn("Item with ID ".concat(e," not found."))}},{key:"clear",value:function(){this.registry={},console.log("All items have been unregistered.")}},{key:"get",value:function(e){return this.registry[e]||null}}])&&lo(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function fo(e){return fo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fo(e)}function yo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,mo(r.key),r)}}function mo(e){var t=function(e){if("object"!=fo(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=fo(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==fo(t)?t:t+""}function vo(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(vo=function(){return!!e})()}function go(e){return go=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},go(e)}function bo(e,t){return bo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},bo(e,t)}var wo=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t,n){return t=go(t),function(e,t){if(t&&("object"==fo(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,vo()?Reflect.construct(t,n||[],go(e).constructor):t.apply(e,n))}(this,t)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&bo(e,t)}(t,e),n=t,(r=[{key:"registerPage",value:function(e){var t=document.getElementById(e);this.register(e,t)}},{key:"showPage",value:function(e){Object.values(this.registry).forEach((function(e){return e.style.display="none"}));var t=this.get(e);t?t.style.display="block":console.warn("Page with ID ".concat(e," not found."))}},{key:"hideAllPages",value:function(){Object.values(this.registry).forEach((function(e){return e.style.display="none"}))}}])&&yo(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(po);function _o(e){return _o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_o(e)}function So(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Po(r.key),r)}}function Po(e){var t=function(e){if("object"!=_o(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=_o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==_o(t)?t:t+""}function ko(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(ko=function(){return!!e})()}function Eo(e){return Eo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Eo(e)}function Co(e,t){return Co=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Co(e,t)}var To=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t,n){return t=Eo(t),function(e,t){if(t&&("object"==_o(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ko()?Reflect.construct(t,n||[],Eo(e).constructor):t.apply(e,n))}(this,t)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Co(e,t)}(t,e),n=t,(r=[{key:"registerListener",value:function(e,t,n){var r=document.getElementById(e);r?(r.addEventListener(t,n),this.register("".concat(e,"_").concat(t),{element:r,eventType:t,callback:n})):console.warn("Element with ID ".concat(e," not found."))}},{key:"unregisterListener",value:function(e,t){var n="".concat(e,"_").concat(t),r=this.get(n);r?(r.element.removeEventListener(r.eventType,r.callback),this.unregister(n)):console.warn("Listener for ".concat(n," not found."))}},{key:"unregisterAllListeners",value:function(){var e=this;Object.keys(this.registry).forEach((function(t){var n=e.get(t),r=n.element,i=n.eventType,o=n.callback;r.removeEventListener(i,o)})),this.clear()}}])&&So(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(po);function Oo(e){return Oo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Oo(e)}function Io(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function xo(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Ro(e,t){if(e){if("string"==typeof e)return Lo(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Lo(e,t):void 0}}function Lo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function jo(e){if(Array.isArray(e))return e}function Ao(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Mo(r.key),r)}}function Mo(e){var t=function(e){if("object"!=Oo(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Oo(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Oo(t)?t:t+""}function Do(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Do=function(){return!!e})()}function Bo(e,t,n,r){var i=No(Uo(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof i?function(e){return i.apply(n,e)}:i}function No(){return No="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=Uo(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},No.apply(null,arguments)}function Uo(e){return Uo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Uo(e)}function Go(e,t){return Go=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Go(e,t)}var Fo=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t,n){return t=Uo(t),function(e,t){if(t&&("object"==Oo(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Do()?Reflect.construct(t,n||[],Uo(e).constructor):t.apply(e,n))}(this,t)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Go(e,t)}(t,e),n=t,(r=[{key:"register",value:function(e,n){if("function"!=typeof n)throw new Error("Generator function must be a function.");Bo(t,"register",this,3)([e,n])}},{key:"unregister",value:function(e){this.registry[e]?(Bo(t,"unregister",this,3)([e]),console.log("Placeholder '".concat(e,"' unregistered."))):console.warn("Placeholder '".concat(e,"' not found."))}},{key:"replacePlaceholders",value:function(e){var t=this;return e.replace(/{{(.*?)}}/g,(function(e,n){var r=function(e,t){return jo(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],c=!0,u=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){u=!0,i=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw i}}return s}}(e,t)||Ro(e,t)||xo()}(t._parseExpression(n),2),i=r[0],o=r[1],a=t.registry[i];if(!a)return console.warn("No generator found for placeholder: ".concat(i)),e;var s=o?t._parseArgs(o):[];return a.apply(void 0,function(e){return function(e){if(Array.isArray(e))return Lo(e)}(e)||Io(e)||Ro(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(s))}))}},{key:"_parseExpression",value:function(e){var t,n=jo(t=e.split(/\((.*?)\)/).filter(Boolean))||Io(t)||Ro(t)||xo(),r=n[0],i=n.slice(1);return[r.trim(),i.join("")]}},{key:"_parseArgs",value:function(e){return e.split(",").map((function(e){var t=e.trim(),n=Number(t);return isNaN(n)?t:n}))}}])&&Ao(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(po);function Ho(e){return Ho="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ho(e)}function zo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Jo(r.key),r)}}function Jo(e){var t=function(e){if("object"!=Ho(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Ho(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ho(t)?t:t+""}var Vo=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.registries={}},(t=[{key:"addRegistry",value:function(e,t){this.registries[e]=t}},{key:"getRegistry",value:function(e){return this.registries[e]}},{key:"getPageRegistry",value:function(){return this.getRegistry("pageRegistry")}},{key:"getListenerRegistry",value:function(){return this.getRegistry("listenerRegistry")}}])&&zo(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function Wo(e){return Wo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Wo(e)}function Yo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,$o(r.key),r)}}function $o(e){var t=function(e){if("object"!=Wo(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Wo(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Wo(t)?t:t+""}var Ko=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.listeners={}},(t=[{key:"on",value:function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}},{key:"off",value:function(e,t){this.listeners[e]&&(this.listeners[e]=this.listeners[e].filter((function(e){return e!==t})))}},{key:"emit",value:function(e,t){this.listeners[e]&&this.listeners[e].forEach((function(e){return e(t)}))}}])&&Yo(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}(),qo=__webpack_require__(942);function Xo(e){return Xo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xo(e)}function Zo(){Zo=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var o=t&&t.prototype instanceof v?t:v,a=Object.create(o.prototype),s=new x(r||[]);return i(a,"_invoke",{value:C(e,n,s)}),a}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var p="suspendedStart",f="suspendedYield",d="executing",y="completed",m={};function v(){}function g(){}function b(){}var w={};u(w,a,(function(){return this}));var _=Object.getPrototypeOf,S=_&&_(_(R([])));S&&S!==n&&r.call(S,a)&&(w=S);var P=b.prototype=v.prototype=Object.create(w);function k(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){function n(i,o,a,s){var c=h(e[i],e,o);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==Xo(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return n("throw",e,a,s)}))}s(c.arg)}var o;i(this,"_invoke",{value:function(e,r){function i(){return new t((function(t,i){n(e,r,t,i)}))}return o=o?o.then(i,i):i()}})}function C(t,n,r){var i=p;return function(o,a){if(i===d)throw Error("Generator is already running");if(i===y){if("throw"===o)throw a;return{value:e,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var c=T(s,r);if(c){if(c===m)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===p)throw i=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=d;var u=h(t,n,r);if("normal"===u.type){if(i=r.done?y:f,u.arg===m)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=y,r.method="throw",r.arg=u.arg)}}}function T(t,n){var r=n.method,i=t.iterator[r];if(i===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,T(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var o=h(i,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,m;var a=o.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function R(t){if(t||""===t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}throw new TypeError(Xo(t)+" is not iterable")}return g.prototype=b,i(P,"constructor",{value:b,configurable:!0}),i(b,"constructor",{value:g,configurable:!0}),g.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create(P),e},t.awrap=function(e){return{__await:e}},k(E.prototype),u(E.prototype,s,(function(){return this})),t.AsyncIterator=E,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new E(l(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},k(P),u(P,c,"Generator"),u(P,a,(function(){return this})),u(P,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=R,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(I),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return s.type="throw",s.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),I(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;I(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:R(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),m}},t}function Qo(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function ea(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ta(r.key),r)}}function ta(e){var t=function(e){if("object"!=Xo(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Xo(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Xo(t)?t:t+""}var na=function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.plugins=[],this.eventBus=t,this.registryManager=n},t=[{key:"registerPlugin",value:function(e){if(!(e instanceof qo.A))throw new Error("Plugin must extend the Plugin base class.");this.plugins.push(e),e.initialize(this.eventBus,this.registryManager,this.peer,this.isHost)}},{key:"initializePluginFromFile",value:(n=Zo().mark((function e(t){var n,r;return Zo().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(t,t.type),!t||"application/javascript"!==t.type&&"text/javascript"!==t.type){e.next=9;break}return e.next=4,this.readFile(t);case 4:n=e.sent,r=this.createPluginFromSource(n),this.registerPlugin(r),e.next=10;break;case 9:throw new Error("File must be a valid JavaScript file.");case 10:case"end":return e.stop()}}),e,this)})),r=function(){var e=this,t=arguments;return new Promise((function(r,i){var o=n.apply(e,t);function a(e){Qo(o,r,i,a,s,"next",e)}function s(e){Qo(o,r,i,a,s,"throw",e)}a(void 0)}))},function(e){return r.apply(this,arguments)})},{key:"readFile",value:function(e){return new Promise((function(t,n){var r=new FileReader;r.onload=function(e){return t(e.target.result)},r.onerror=function(e){return n(new Error("Failed to read file."))},r.readAsText(e)}))}},{key:"createPluginFromSource",value:function(e){var t=new Function("Plugin","\n            const pluginClass = ".concat(e,";\n            return new pluginClass();\n        "))(qo.A);if(!(t instanceof qo.A))throw new Error("Uploaded file must export a valid Plugin class.");return t}},{key:"setHost",value:function(e){this.isHost=e,this.plugins.forEach((function(t){return t.setHost(e)}))}},{key:"setPeer",value:function(e){this.peer=e,this.plugins.forEach((function(t){return t.setPeer(e)}))}}],t&&ea(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r}(),ra=new co("settingsModal",new Xi),ia=new Vo,oa=new wo,aa=new To,sa=new Fo;ia.addRegistry("pageRegistry",oa),ia.addRegistry("listenerRegistry",aa),ia.addRegistry("placeholderRegistry",sa),oa.registerPage("homePage"),oa.registerPage("joinPage"),oa.registerPage("lobbyPage"),oa.registerPage("gamePage"),oa.registerPage("hostPage"),oa.registerPage("loadingPage"),sa.register("randomNumber",(function(e,t){return Math.floor(Math.random()*(t-e+1))+e})),sa.register("randomWord",(function(){var e=["apple","banana","orange","pear","grape","plum"];return e[Math.floor(Math.random()*e.length)]})),sa.register("randomColor",(function(){var e=["#FF5733","#33FF57","#3357FF","#F3FF33","#33F3FF","#FF33F3"];return e[Math.floor(Math.random()*e.length)]}));var ca=new Ko,ua=new na(ca,ia),la=__webpack_require__(247);la.keys().forEach((function(e){var t=la(e),n=t.default||t;if(n&&"function"==typeof n){var r=new n;ua.registerPlugin(r)}})),aa.registerListener("hostButton","click",(function(){document.getElementById("hostButton").disabled=!0,ua.setHost(!0),new Ti(ia,ua,ca).init()})),aa.registerListener("joinButton","click",(function(){document.getElementById("joinButton").disabled=!0,ua.setHost(!1),new Yi(ia,ua,ca).init()})),aa.registerListener("gearButton","click",(function(){ra.show()}))})()})();